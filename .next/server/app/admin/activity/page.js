(()=>{var e={};e.id=6185,e.ids=[6185],e.modules={47849:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external")},72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},55403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},94749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},6113:e=>{"use strict";e.exports=require("crypto")},9523:e=>{"use strict";e.exports=require("dns")},82361:e=>{"use strict";e.exports=require("events")},57147:e=>{"use strict";e.exports=require("fs")},13685:e=>{"use strict";e.exports=require("http")},85158:e=>{"use strict";e.exports=require("http2")},41808:e=>{"use strict";e.exports=require("net")},22037:e=>{"use strict";e.exports=require("os")},71017:e=>{"use strict";e.exports=require("path")},77282:e=>{"use strict";e.exports=require("process")},12781:e=>{"use strict";e.exports=require("stream")},24404:e=>{"use strict";e.exports=require("tls")},57310:e=>{"use strict";e.exports=require("url")},73837:e=>{"use strict";e.exports=require("util")},59796:e=>{"use strict";e.exports=require("zlib")},1987:(e,t,r)=>{"use strict";r.r(t),r.d(t,{GlobalError:()=>n.a,__next_app__:()=>m,originalPathname:()=>u,pages:()=>c,routeModule:()=>x,tree:()=>d});var s=r(67096),a=r(16132),i=r(37284),n=r.n(i),l=r(32564),o={};for(let e in l)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(o[e]=()=>l[e]);r.d(t,o);let d=["",{children:["admin",{children:["activity",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,92281)),"/Users/brahimamzil/Downloads/DEV_APPS/----3arida/3arida-app/src/app/admin/activity/page.tsx"]}]},{}]},{}]},{layout:[()=>Promise.resolve().then(r.bind(r,46070)),"/Users/brahimamzil/Downloads/DEV_APPS/----3arida/3arida-app/src/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(r.t.bind(r,9291,23)),"next/dist/client/components/not-found-error"]}],c=["/Users/brahimamzil/Downloads/DEV_APPS/----3arida/3arida-app/src/app/admin/activity/page.tsx"],u="/admin/activity/page",m={require:r,loadChunk:()=>Promise.resolve()},x=new s.AppPageRouteModule({definition:{kind:a.x.APP_PAGE,page:"/admin/activity/page",pathname:"/admin/activity",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},9683:(e,t,r)=>{Promise.resolve().then(r.bind(r,41616))},41616:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>x});var s=r(53854),a=r(34218),i=r(75548),n=r.n(i),l=r(26422),o=r(49465),d=r(24844),c=r(59924),u=r(21663),m=r(34922);function x(){let{user:e,userProfile:t,loading:r,hasRequiredRole:i}=(0,u.Rc)(),[x,p]=(0,a.useState)([]),[h,g]=(0,a.useState)(!0),[f,v]=(0,a.useState)(""),[y,j]=(0,a.useState)("all"),[b,N]=(0,a.useState)("all");(0,a.useEffect)(()=>{!r&&i&&w()},[r,i]);let w=async()=>{try{g(!0),v("");let e=await (0,m.FA)({limitCount:200});p(e)}catch(e){console.error("Error loading audit logs:",e),v("Failed to load activity logs")}finally{g(!1)}};if(r)return(0,s.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[s.jsx(l.default,{}),s.jsx(o.Z,{}),s.jsx("div",{className:"flex items-center justify-center min-h-[calc(100vh-4rem)]",children:s.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-green-600"})})]});if(!i)return null;let q=Array.from(new Set(x.map(e=>e.actorName))).sort(),P=x.filter(e=>("all"===y||e.action===y)&&("all"===b||e.actorName===b)),A=e=>e.includes("approved")?"text-green-600 bg-green-50":e.includes("rejected")?"text-red-600 bg-red-50":e.includes("paused")?"text-orange-600 bg-orange-50":e.includes("deleted")?"text-gray-600 bg-gray-50":e.includes("promoted")?"text-blue-600 bg-blue-50":e.includes("demoted")?"text-purple-600 bg-purple-50":"text-gray-600 bg-gray-50",_=e=>e.split(".").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" ");return(0,s.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[s.jsx(l.default,{}),s.jsx(o.Z,{}),(0,s.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[(0,s.jsxs)("div",{className:"mb-8",children:[s.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Activity Log"}),s.jsx("p",{className:"text-lg text-gray-600",children:"Track all moderator and admin actions"})]}),s.jsx(d.Zb,{className:"mb-6",children:s.jsx(d.aY,{className:"p-6",children:(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,s.jsxs)("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Filter by Action"}),(0,s.jsxs)("select",{value:y,onChange:e=>j(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent",children:[s.jsx("option",{value:"all",children:"All Actions"}),s.jsx("option",{value:"petition.approved",children:"Petition Approved"}),s.jsx("option",{value:"petition.rejected",children:"Petition Rejected"}),s.jsx("option",{value:"petition.paused",children:"Petition Paused"}),s.jsx("option",{value:"petition.deleted",children:"Petition Deleted"}),s.jsx("option",{value:"petition.archived",children:"Petition Archived"}),s.jsx("option",{value:"user.promoted_to_moderator",children:"User Promoted"}),s.jsx("option",{value:"user.demoted_from_moderator",children:"User Demoted"})]})]}),(0,s.jsxs)("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Filter by Moderator"}),(0,s.jsxs)("select",{value:b,onChange:e=>N(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent",children:[s.jsx("option",{value:"all",children:"All Moderators"}),q.map(e=>s.jsx("option",{value:e,children:e},e))]})]}),s.jsx("div",{className:"flex items-end",children:s.jsx(c.z,{onClick:()=>{j("all"),N("all")},variant:"outline",className:"w-full",children:"Clear Filters"})})]})})}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8",children:[s.jsx(d.Zb,{children:(0,s.jsxs)(d.aY,{className:"p-6",children:[s.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Actions"}),s.jsx("p",{className:"text-3xl font-bold text-gray-900 mt-2",children:P.length})]})}),s.jsx(d.Zb,{children:(0,s.jsxs)(d.aY,{className:"p-6",children:[s.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Approvals"}),s.jsx("p",{className:"text-3xl font-bold text-green-600 mt-2",children:P.filter(e=>"petition.approved"===e.action).length})]})}),s.jsx(d.Zb,{children:(0,s.jsxs)(d.aY,{className:"p-6",children:[s.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Rejections"}),s.jsx("p",{className:"text-3xl font-bold text-red-600 mt-2",children:P.filter(e=>"petition.rejected"===e.action).length})]})}),s.jsx(d.Zb,{children:(0,s.jsxs)(d.aY,{className:"p-6",children:[s.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Active Moderators"}),s.jsx("p",{className:"text-3xl font-bold text-blue-600 mt-2",children:q.length})]})})]}),(0,s.jsxs)(d.Zb,{children:[s.jsx(d.Ol,{children:s.jsx(d.ll,{children:"Recent Activity"})}),s.jsx(d.aY,{children:h?s.jsx("div",{className:"flex items-center justify-center py-12",children:s.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-green-600"})}):f?(0,s.jsxs)("div",{className:"text-center py-12",children:[s.jsx("p",{className:"text-red-600 mb-4",children:f}),s.jsx(c.z,{onClick:w,variant:"outline",children:"Try Again"})]}):0===P.length?s.jsx("div",{className:"text-center py-12",children:s.jsx("p",{className:"text-gray-500",children:"No activity logs found"})}):s.jsx("div",{className:"space-y-3",children:P.map(e=>(0,s.jsxs)("div",{className:"flex items-start gap-4 p-4 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors",children:[s.jsx("div",{className:"flex-shrink-0 text-sm text-gray-500 w-32",children:e.timestamp instanceof Date?e.timestamp.toLocaleString():new Date(e.timestamp).toLocaleString()}),s.jsx("div",{className:"flex-shrink-0",children:s.jsx("span",{className:`inline-flex items-center px-3 py-1 rounded-full text-xs font-medium ${A(e.action)}`,children:_(e.action)})}),(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,s.jsxs)("p",{className:"text-sm font-medium text-gray-900",children:[e.actorName,(0,s.jsxs)("span",{className:"text-gray-500 font-normal ml-2",children:["(",e.actorRole,")"]})]}),(0,s.jsxs)("p",{className:"text-sm text-gray-600 mt-1",children:["petition"===e.targetType&&(0,s.jsxs)(s.Fragment,{children:["Petition:"," ",s.jsx(n(),{href:`/petitions/${e.targetId}`,className:"text-green-600 hover:underline",children:e.targetName||e.targetId})]}),"user"===e.targetType&&(0,s.jsxs)(s.Fragment,{children:["User: ",e.targetName||e.targetId]})]}),e.details?.reason&&(0,s.jsxs)("p",{className:"text-sm text-gray-500 mt-1 italic",children:["Reason: ",e.details.reason]}),e.details?.oldValue&&e.details?.newValue&&(0,s.jsxs)("p",{className:"text-xs text-gray-400 mt-1",children:["Changed from"," ",s.jsx("span",{className:"font-medium",children:e.details.oldValue})," ","to"," ",s.jsx("span",{className:"font-medium",children:e.details.newValue})]})]}),"petition"===e.targetType&&s.jsx("div",{className:"flex-shrink-0",children:s.jsx(c.z,{size:"sm",variant:"outline",asChild:!0,children:s.jsx(n(),{href:`/petitions/${e.targetId}`,children:"View"})})})]},e.id))})})]})]})]})}},26422:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>a});var s=r(8465);let a=r.n(s)()(async()=>{},{loadableGenerated:{modules:["/Users/brahimamzil/Downloads/DEV_APPS/----3arida/3arida-app/src/components/layout/HeaderWrapper.tsx -> ./Header"]},ssr:!1,loading:()=>null})},59924:(e,t,r)=>{"use strict";r.d(t,{z:()=>d});var s=r(53854),a=r(34218),i=r(48225),n=r(82457),l=r(68504);let o=(0,n.j)("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),d=a.forwardRef(({className:e,variant:t,size:r,asChild:a=!1,...n},d)=>{let c=a?i.g7:"button";return s.jsx(c,{className:(0,l.cn)(o({variant:t,size:r,className:e})),ref:d,...n})});d.displayName="Button"},34922:(e,t,r)=>{"use strict";r.d(t,{FA:()=>n,Lu:()=>i});var s=r(31489),a=r(1853);async function i(e){try{await (0,s.addDoc)((0,s.collection)(a.db,"auditLogs"),{...e,timestamp:(0,s.serverTimestamp)()})}catch(e){console.error("Failed to log audit action:",e)}}async function n(e){try{let t=(0,s.collection)(a.db,"auditLogs"),r=(0,s.query)(t,(0,s.orderBy)("timestamp","desc"));return e?.actorId&&(r=(0,s.query)(r,(0,s.where)("actorId","==",e.actorId))),e?.targetId&&(r=(0,s.query)(r,(0,s.where)("targetId","==",e.targetId))),e?.action&&(r=(0,s.query)(r,(0,s.where)("action","==",e.action))),e?.targetType&&(r=(0,s.query)(r,(0,s.where)("targetType","==",e.targetType))),r=e?.limitCount?(0,s.query)(r,(0,s.b9)(e.limitCount)):(0,s.query)(r,(0,s.b9)(100)),(await (0,s.getDocs)(r)).docs.map(e=>({id:e.id,...e.data(),timestamp:e.data().timestamp?.toDate?.()||new Date}))}catch(e){return console.error("Failed to fetch audit logs:",e),[]}}},21663:(e,t,r)=>{"use strict";r.d(t,{Rc:()=>o,fc:()=>u,u2:()=>d,xw:()=>n}),r(53854);var s=r(34218),a=r(51018),i=r(58198);let n=(e="/auth/login")=>{let{user:t,loading:r}=(0,i.useAuth)(),n=(0,a.useRouter)();return(0,s.useEffect)(()=>{if(!r&&!t){let t=window.location.pathname,r=`${e}?redirect=${encodeURIComponent(t)}`;n.push(r)}},[t,r,n,e]),{user:t,loading:r,isAuthenticated:!!t}},l=(e,t="/dashboard")=>{let{user:r,userProfile:n,loading:l}=(0,i.useAuth)(),o=(0,a.useRouter)();return(0,s.useEffect)(()=>{if(!l){if(r)n&&!e.includes(n.role)&&o.push(t);else{let e=window.location.pathname,t=`/auth/login?redirect=${encodeURIComponent(e)}`;o.push(t)}}},[r,n,l,o,e,t]),{user:r,userProfile:n,loading:l,isAuthenticated:!!r,hasRequiredRole:!!n&&e.includes(n.role)}},o=(e="/dashboard")=>l(["admin"],e),d=(e="/dashboard")=>l(["moderator","admin"],e),c=(e,t)=>!!e&&t.includes(e.role),u=e=>c(e,["moderator","admin"])},68504:(e,t,r)=>{"use strict";r.d(t,{cn:()=>i});var s=r(29395),a=r(1088);function i(...e){return(0,a.m6)((0,s.W)(e))}},92281:(e,t,r)=>{"use strict";r.r(t),r.d(t,{$$typeof:()=>i,__esModule:()=>a,default:()=>n});let s=(0,r(95153).createProxy)(String.raw`/Users/brahimamzil/Downloads/DEV_APPS/----3arida/3arida-app/src/app/admin/activity/page.tsx`),{__esModule:a,$$typeof:i}=s,n=s.default}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[3271,8025,6078,7490,580,3257],()=>r(1987));module.exports=s})();