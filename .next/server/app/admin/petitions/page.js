(()=>{var e={};e.id=3283,e.ids=[3283],e.modules={47849:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external")},72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},55403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},94749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},6113:e=>{"use strict";e.exports=require("crypto")},9523:e=>{"use strict";e.exports=require("dns")},82361:e=>{"use strict";e.exports=require("events")},57147:e=>{"use strict";e.exports=require("fs")},13685:e=>{"use strict";e.exports=require("http")},85158:e=>{"use strict";e.exports=require("http2")},41808:e=>{"use strict";e.exports=require("net")},22037:e=>{"use strict";e.exports=require("os")},71017:e=>{"use strict";e.exports=require("path")},77282:e=>{"use strict";e.exports=require("process")},12781:e=>{"use strict";e.exports=require("stream")},24404:e=>{"use strict";e.exports=require("tls")},57310:e=>{"use strict";e.exports=require("url")},73837:e=>{"use strict";e.exports=require("util")},59796:e=>{"use strict";e.exports=require("zlib")},98427:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>n.a,__next_app__:()=>m,originalPathname:()=>u,pages:()=>c,routeModule:()=>p,tree:()=>o});var r=s(67096),a=s(16132),i=s(37284),n=s.n(i),l=s(32564),d={};for(let e in l)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(d[e]=()=>l[e]);s.d(t,d);let o=["",{children:["admin",{children:["petitions",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,37042)),"/Users/brahimamzil/Downloads/DEV_APPS/----3arida/3arida-app/src/app/admin/petitions/page.tsx"]}]},{}]},{}]},{layout:[()=>Promise.resolve().then(s.bind(s,46070)),"/Users/brahimamzil/Downloads/DEV_APPS/----3arida/3arida-app/src/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,9291,23)),"next/dist/client/components/not-found-error"]}],c=["/Users/brahimamzil/Downloads/DEV_APPS/----3arida/3arida-app/src/app/admin/petitions/page.tsx"],u="/admin/petitions/page",m={require:s,loadChunk:()=>Promise.resolve()},p=new r.AppPageRouteModule({definition:{kind:a.x.APP_PAGE,page:"/admin/petitions/page",pathname:"/admin/petitions",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:o}})},88513:(e,t,s)=>{Promise.resolve().then(s.bind(s,79984))},33781:(e,t,s)=>{"use strict";s.d(t,{Z:()=>u});var r=s(34218);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),i=e=>e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,s)=>s?s.toUpperCase():t.toLowerCase()),n=e=>{let t=i(e);return t.charAt(0).toUpperCase()+t.slice(1)},l=(...e)=>e.filter((e,t,s)=>!!e&&""!==e.trim()&&s.indexOf(e)===t).join(" ").trim(),d=e=>{for(let t in e)if(t.startsWith("aria-")||"role"===t||"title"===t)return!0};/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var o={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let c=(0,r.forwardRef)(({color:e="currentColor",size:t=24,strokeWidth:s=2,absoluteStrokeWidth:a,className:i="",children:n,iconNode:c,...u},m)=>(0,r.createElement)("svg",{ref:m,...o,width:t,height:t,stroke:e,strokeWidth:a?24*Number(s)/Number(t):s,className:l("lucide",i),...!n&&!d(u)&&{"aria-hidden":"true"},...u},[...c.map(([e,t])=>(0,r.createElement)(e,t)),...Array.isArray(n)?n:[n]])),u=(e,t)=>{let s=(0,r.forwardRef)(({className:s,...i},d)=>(0,r.createElement)(c,{ref:d,iconNode:t,className:l(`lucide-${a(n(e))}`,`lucide-${e}`,s),...i}));return s.displayName=n(e),s}},66802:(e,t,s)=>{"use strict";s.d(t,{Z:()=>r});let r=(0,s(33781).Z)("check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]])},36407:(e,t,s)=>{"use strict";s.d(t,{Z:()=>r});let r=(0,s(33781).Z)("pause",[["rect",{x:"14",y:"3",width:"5",height:"18",rx:"1",key:"kaeet6"}],["rect",{x:"5",y:"3",width:"5",height:"18",rx:"1",key:"1wsw3u"}]])},39783:(e,t,s)=>{"use strict";s.d(t,{Z:()=>r});let r=(0,s(33781).Z)("trash-2",[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]])},74920:(e,t,s)=>{"use strict";s.d(t,{Z:()=>r});let r=(0,s(33781).Z)("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]])},79984:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>w});var r=s(53854),a=s(34218),i=s.n(a),n=s(75548),l=s.n(n),d=s(26422),o=s(49465),c=s(24844),u=s(59924),m=s(21663),p=s(66802),h=s(36407),x=s(74920),g=s(39783),j=s(31489),b=s(1853),f=s(98097),v=s(34922),y=s(24434);function N({petition:e,onUpdate:t,size:s="default",layout:i="horizontal",moderatorId:n}){let[l,d]=(0,a.useState)(""),o=async(s,r=!1,a=!1)=>{if(r&&!confirm(`Are you sure you want to ${s} this petition?`))return;let i="";if(a){let e="delete"===s?"Reason for deletion (required):":`Reason for ${s} (optional):`;if(i=prompt(e)||"","delete"===s&&!i.trim()){alert("A reason is required for deletion.");return}}d(s);try{let r=new Date,a={updatedAt:j.Timestamp.fromDate(r)};switch(s){case"approve":a.status="approved",a.approvedAt=j.Timestamp.fromDate(r);break;case"reject":a.status="rejected",a.rejectedAt=j.Timestamp.fromDate(r);break;case"pause":a.status="paused",a.pausedAt=j.Timestamp.fromDate(r);break;case"delete":a.status="deleted",a.deletedAt=j.Timestamp.fromDate(r),a.isActive=!1}if(n&&(a.moderatedBy=n),i&&(a.moderatorNotes=i),"reject"===s){let t=(e.resubmissionHistory||[]).map(e=>({rejectedAt:e.rejectedAt instanceof Date?j.Timestamp.fromDate(e.rejectedAt):e.rejectedAt,reason:e.reason,resubmittedAt:e.resubmittedAt?e.resubmittedAt instanceof Date?j.Timestamp.fromDate(e.resubmittedAt):e.resubmittedAt:null}));t.push({rejectedAt:j.Timestamp.fromDate(r),reason:i||"No reason provided",resubmittedAt:null}),a.resubmissionHistory=t}if(await (0,j.updateDoc)((0,j.doc)(b.db,"petitions",e.id),a),n){let t={approve:"petition.approved",reject:"petition.rejected",pause:"petition.paused",delete:"petition.deleted"};if(t[s])try{let r=await (0,y.GA)(n);await (0,v.Lu)({actorId:n,actorName:r?.name||"Unknown Admin",actorEmail:r?.email||"",actorRole:r?.role||"admin",action:t[s],targetType:"petition",targetId:e.id,targetName:e.title,details:{oldValue:e.status,newValue:a.status,reason:i}}),console.log("✅ Audit log created successfully")}catch(e){console.error("❌ Error logging audit action:",e)}}else console.warn("⚠️ No moderatorId provided for audit logging");let l={...e,status:a.status,updatedAt:r,moderatedBy:a.moderatedBy,moderationNotes:a.moderatorNotes,isActive:void 0!==a.isActive?a.isActive:e.isActive};a.approvedAt&&(l.approvedAt=r),a.rejectedAt&&(l.rejectedAt=r),a.pausedAt&&(l.pausedAt=r),a.deletedAt&&(l.deletedAt=r);try{await (0,f.t8)(e.id,e.creatorId,e.title,a.status,i)}catch(e){console.error("Error sending notification:",e)}t&&t(l);let d="delete"===s?"deleted":`${s}d`;alert(`Petition ${d} successfully!`)}catch(e){console.error(`Error ${s}ing petition:`,e),alert(`Error ${s}ing petition. Please try again.`)}finally{d("")}};return(0,r.jsxs)("div",{className:"vertical"===i?"flex flex-col gap-2":"flex flex-wrap gap-2",children:[(0,r.jsxs)(u.z,{size:s,onClick:()=>o("approve"),disabled:"approve"===l||""!==l||"approved"===e.status,className:"bg-green-600 hover:bg-green-700 text-white disabled:bg-gray-300 disabled:text-gray-500",children:[r.jsx(p.Z,{className:"w-4 h-4 mr-2"}),"approve"===l?"Approving...":"Approve"]}),(0,r.jsxs)(u.z,{size:s,onClick:()=>o("pause",!1,!0),disabled:"pause"===l||""!==l||"paused"===e.status||"deleted"===e.status,variant:"outline",className:"text-orange-600 border-orange-300 hover:bg-orange-50 disabled:text-gray-500 disabled:border-gray-300",children:[r.jsx(h.Z,{className:"w-4 h-4 mr-2"}),"pause"===l?"Pausing...":"Pause"]}),(0,r.jsxs)(u.z,{size:s,onClick:()=>o("reject",!0,!0),disabled:"reject"===l||""!==l||"rejected"===e.status||"deleted"===e.status,variant:"destructive",className:"disabled:bg-gray-300 disabled:text-gray-500",children:[r.jsx(x.Z,{className:"w-4 h-4 mr-2"}),"reject"===l?"Rejecting...":"Reject"]}),(0,r.jsxs)(u.z,{size:s,onClick:()=>o("delete",!0,!0),disabled:"delete"===l||""!==l||"deleted"===e.status,variant:"outline",className:"text-red-600 border-red-300 hover:bg-red-50 disabled:text-gray-500 disabled:border-gray-300",children:[r.jsx(g.Z,{className:"w-4 h-4 mr-2"}),"delete"===l?"Deleting...":"Delete"]}),l&&(0,r.jsxs)("div",{className:"flex items-center text-sm text-gray-600 mt-2",children:[r.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-green-600 mr-2"}),"Processing..."]})]})}function w(){let{user:e,userProfile:t,loading:n,hasRequiredRole:p}=(0,m.u2)(),[h,x]=(0,a.useState)([]),[g,f]=(0,a.useState)([]),[v,y]=(0,a.useState)(!0),[w,A]=(0,a.useState)(""),[k,q]=(0,a.useState)("pending"),[C,D]=(0,a.useState)(""),[P,z]=(0,a.useState)("all"),[R,S]=(0,a.useState)(1),[L]=(0,a.useState)(10),[E,M]=(0,a.useState)([]),[_,Z]=(0,a.useState)(0);(0,a.useEffect)(()=>{!n&&p&&(T(),B())},[n,p]),(0,a.useEffect)(()=>{g.length>0&&$(g,k,C,P)},[k,C,P]),(0,a.useEffect)(()=>{S(1)},[k,C,P]);let $=(e,t,s,r)=>{let a=e;if("all"!==t&&(a=a.filter(e=>e.status===t)),"all"!==r&&(a=a.filter(e=>e.category===r)),s.trim()){let e=s.toLowerCase(),t=s.toUpperCase();a=a.filter(s=>s.title.toLowerCase().includes(e)||s.description.toLowerCase().includes(e)||s.category.toLowerCase().includes(e)||s.publisherName?.toLowerCase().includes(e)||s.referenceCode?.toUpperCase().includes(t))}x(a)},T=async()=>{try{y(!0),A("");let e=(0,j.collection)(b.db,"petitions"),t=(0,j.query)(e,(0,j.orderBy)("createdAt","desc")),s=await (0,j.getDocs)(t),r=[];s.forEach(e=>{let t=e.data(),s={id:e.id,...t,createdAt:t.createdAt?.toDate?.()||new Date,updatedAt:t.updatedAt?.toDate?.()||new Date};r.push(s)}),f(r),$(r,k,C,P)}catch(e){console.error("Error loading petitions:",e),A("Failed to load petitions")}finally{y(!1)}},B=async()=>{try{let e=(0,j.collection)(b.db,"deletionRequests"),t=(0,j.query)(e,(0,j.where)("status","==","pending"),(0,j.orderBy)("createdAt","desc")),s=await (0,j.getDocs)(t),r=[];s.forEach(e=>{r.push({id:e.id,...e.data(),createdAt:e.data().createdAt?.toDate?.()||new Date})}),M(r),Z(r.length)}catch(e){console.error("Error loading deletion requests:",e)}},I=async(e,r)=>{if(confirm("Approve this deletion request? The petition will be deleted."))try{let{updateDoc:a,doc:i,Timestamp:n,getDoc:l}=await Promise.resolve().then(s.bind(s,31489)),{notifyDeletionRequestApproved:d}=await Promise.resolve().then(s.bind(s,98097)),o=(await l(i(b.db,"petitions",r))).data();if(await a(i(b.db,"petitions",r),{status:"deleted",deletedAt:n.now(),deletedBy:t?.id}),await a(i(b.db,"deletionRequests",e),{status:"approved",approvedAt:n.now(),approvedBy:t?.id}),o?.publisherId)try{await d(o.publisherId,o.title,r)}catch(e){console.error("Error sending notification:",e)}alert("Deletion request approved"),B(),T()}catch(e){console.error("Error approving deletion:",e),alert("Failed to approve deletion request")}},U=async e=>{let r=prompt("Reason for denying this deletion request (optional):");if(null!==r)try{let{updateDoc:a,doc:i,Timestamp:n,getDoc:l}=await Promise.resolve().then(s.bind(s,31489)),{notifyDeletionRequestDenied:d}=await Promise.resolve().then(s.bind(s,98097)),o=(await l(i(b.db,"deletionRequests",e))).data();if(await a(i(b.db,"deletionRequests",e),{status:"denied",deniedAt:n.now(),deniedBy:t?.id,denialReason:r||"No reason provided"}),o?.creatorId)try{await d(o.creatorId,o.petitionTitle,o.petitionId,r||"No reason provided")}catch(e){console.error("Error sending notification:",e)}alert("Deletion request denied"),B()}catch(e){console.error("Error denying deletion:",e),alert("Failed to deny deletion request")}};return n?(0,r.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[r.jsx(d.default,{}),r.jsx("div",{className:"flex items-center justify-center min-h-[calc(100vh-4rem)]",children:r.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-green-600"})})]}):p?(0,r.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[r.jsx(d.default,{}),r.jsx(o.Z,{}),(0,r.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[(0,r.jsxs)("div",{className:"mb-8",children:[r.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Petition Moderation"}),r.jsx("p",{className:"text-lg text-gray-600",children:"Review and manage petitions on the platform"})]}),r.jsx("div",{className:"mb-6",children:(0,r.jsxs)("div",{className:"flex gap-4",children:[(0,r.jsxs)("div",{className:"flex-1 relative",children:[r.jsx("input",{type:"text",placeholder:"Search by title, description, category, publisher, or reference code (e.g., AB1234)...",value:C,onChange:e=>D(e.target.value),className:"w-full px-4 py-2 pl-10 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500"}),r.jsx("svg",{className:"absolute left-3 top-2.5 w-5 h-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})]}),(0,r.jsxs)("select",{value:P,onChange:e=>z(e.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500",children:[r.jsx("option",{value:"all",children:"All Categories"}),Array.from(new Set(g.map(e=>e.category))).sort().map(e=>r.jsx("option",{value:e,children:e},e))]}),(C||"all"!==P)&&r.jsx(u.z,{variant:"outline",onClick:()=>{D(""),z("all")},children:"Clear"})]})}),r.jsx("div",{className:"mb-6",children:r.jsx("div",{className:"border-b border-gray-200",children:r.jsx("nav",{className:"-mb-px flex space-x-8",children:[{key:"pending",label:"Pending Review",count:g.filter(e=>"pending"===e.status).length},{key:"approved",label:"Approved",count:g.filter(e=>"approved"===e.status).length},{key:"rejected",label:"Rejected",count:g.filter(e=>"rejected"===e.status).length},{key:"paused",label:"Paused",count:g.filter(e=>"paused"===e.status).length},{key:"archived",label:"Archived",count:g.filter(e=>"archived"===e.status).length},{key:"deleted",label:"Deleted",count:g.filter(e=>"deleted"===e.status).length},{key:"deletion-requests",label:"Deletion Requests",count:_},{key:"all",label:"All Petitions",count:g.length}].map(e=>(0,r.jsxs)("button",{onClick:()=>q(e.key),className:`py-2 px-1 border-b-2 font-medium text-sm ${k===e.key?"border-green-500 text-green-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:[e.label,!v&&r.jsx("span",{className:"ml-2 bg-gray-100 text-gray-900 py-0.5 px-2.5 rounded-full text-xs",children:e.count})]},e.key))})})}),v?r.jsx("div",{className:"space-y-4",children:[void 0,void 0,void 0].map((e,t)=>r.jsx(c.Zb,{children:r.jsx(c.aY,{className:"p-6",children:(0,r.jsxs)("div",{className:"animate-pulse",children:[r.jsx("div",{className:"h-4 bg-gray-200 rounded mb-2"}),r.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4 mb-4"}),r.jsx("div",{className:"h-3 bg-gray-200 rounded w-1/2"})]})})},t))}):w?(0,r.jsxs)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6",children:[r.jsx("p",{className:"text-red-600",children:w}),r.jsx(u.z,{onClick:T,className:"mt-4",variant:"outline",children:"Try Again"})]}):"deletion-requests"===k?0===E.length?r.jsx(c.Zb,{children:(0,r.jsxs)(c.aY,{className:"py-12 text-center",children:[r.jsx("div",{className:"w-16 h-16 mx-auto mb-4 bg-gray-100 rounded-full flex items-center justify-center",children:r.jsx("svg",{className:"w-8 h-8 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})}),r.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No deletion requests"}),r.jsx("p",{className:"text-gray-600",children:"There are no pending deletion requests at this time."})]})}):r.jsx("div",{className:"space-y-4",children:E.map(e=>r.jsx(c.Zb,{className:"border-orange-200 bg-orange-50",children:r.jsx(c.aY,{className:"p-6",children:(0,r.jsxs)("div",{className:"flex items-start justify-between",children:[(0,r.jsxs)("div",{className:"flex-1",children:[r.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:e.petitionTitle}),(0,r.jsxs)("div",{className:"space-y-2 text-sm text-gray-600",children:[(0,r.jsxs)("p",{children:[r.jsx("span",{className:"font-medium",children:"Petition ID:"})," ",e.petitionId]}),(0,r.jsxs)("p",{children:[r.jsx("span",{className:"font-medium",children:"Current Signatures:"})," ",e.currentSignatures]}),(0,r.jsxs)("p",{children:[r.jsx("span",{className:"font-medium",children:"Requested:"})," ",e.createdAt.toLocaleDateString()]}),(0,r.jsxs)("div",{className:"mt-3 p-3 bg-white rounded border border-orange-200",children:[r.jsx("p",{className:"font-medium text-gray-900 mb-1",children:"Reason:"}),r.jsx("p",{className:"text-gray-700",children:e.reason})]})]})]}),(0,r.jsxs)("div",{className:"ml-4 flex flex-col gap-2",children:[r.jsx(u.z,{onClick:()=>I(e.id,e.petitionId),className:"bg-red-600 hover:bg-red-700",size:"sm",children:"Approve Deletion"}),r.jsx(u.z,{onClick:()=>U(e.id),variant:"outline",size:"sm",children:"Deny Request"}),r.jsx(u.z,{asChild:!0,variant:"outline",size:"sm",children:r.jsx(l(),{href:`/petitions/${e.petitionId}`,children:"View Petition"})})]})]})})},e.id))}):0===h.length?r.jsx(c.Zb,{children:(0,r.jsxs)(c.aY,{className:"py-12 text-center",children:[r.jsx("div",{className:"w-16 h-16 mx-auto mb-4 bg-gray-100 rounded-full flex items-center justify-center",children:r.jsx("svg",{className:"w-8 h-8 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})}),r.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No petitions found"}),r.jsx("p",{className:"text-gray-600",children:C||"all"!==P?"No petitions match your search criteria.":"pending"===k?"No petitions are pending review.":`No ${k} petitions found.`})]})}):(0,r.jsxs)(r.Fragment,{children:[r.jsx("div",{className:"space-y-6",children:h.slice((R-1)*L,R*L).map(e=>r.jsx(c.Zb,{children:r.jsx(c.aY,{className:"p-6",children:(0,r.jsxs)("div",{className:"flex gap-6",children:[r.jsx("div",{className:"flex-shrink-0",children:e.mediaUrls&&e.mediaUrls.length>0?r.jsx("img",{src:e.mediaUrls[0],alt:e.title,className:"w-48 h-32 object-cover rounded-lg"}):r.jsx("div",{className:"w-48 h-32 bg-gray-100 rounded-lg flex items-center justify-center",children:r.jsx("svg",{className:"w-12 h-12 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})})})}),r.jsx("div",{className:"flex-1 min-w-0",children:(0,r.jsxs)("div",{className:"flex items-start justify-between",children:[(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[r.jsx(l(),{href:`/admin/petitions/${e.id}`,children:r.jsx("h3",{className:"text-lg font-semibold text-gray-900 hover:text-green-600 cursor-pointer",children:e.title})}),r.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${"pending"===e.status?"bg-yellow-100 text-yellow-800":"approved"===e.status?"bg-green-100 text-green-800":"paused"===e.status?"bg-red-100 text-red-800":"deleted"===e.status?"bg-gray-800 text-white":"bg-gray-100 text-gray-800"}`,children:e.status})]}),r.jsx("p",{className:"text-gray-600 mb-4 line-clamp-2",children:e.description}),(0,r.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm text-gray-500",children:[(0,r.jsxs)("div",{children:[r.jsx("span",{className:"font-medium",children:"Category:"}),r.jsx("br",{}),e.category]}),(0,r.jsxs)("div",{children:[r.jsx("span",{className:"font-medium",children:"Signatures:"}),r.jsx("br",{}),e.currentSignatures," /"," ",e.targetSignatures]}),(0,r.jsxs)("div",{children:[r.jsx("span",{className:"font-medium",children:"Created:"}),r.jsx("br",{}),e.createdAt.toLocaleDateString()]}),(0,r.jsxs)("div",{children:[r.jsx("span",{className:"font-medium",children:"Tier:"}),r.jsx("br",{}),e.pricingTier]})]}),e.moderationNotes&&r.jsx("div",{className:"mt-4 p-3 bg-blue-50 border border-blue-200 rounded-md",children:(0,r.jsxs)("p",{className:"text-sm text-blue-800",children:[r.jsx("span",{className:"font-medium",children:"Moderator Notes:"})," ",e.moderationNotes]})}),"rejected"===e.status&&e.resubmissionHistory&&e.resubmissionHistory.length>0&&(0,r.jsxs)("div",{className:"mt-4 p-3 bg-red-50 border border-red-200 rounded-md",children:[(0,r.jsxs)("p",{className:"text-sm font-medium text-red-800 mb-2",children:["Rejection History (",e.resubmissionCount||0," ","resubmission",1!==(e.resubmissionCount||0)?"s":"","):"]}),r.jsx("div",{className:"space-y-2",children:e.resubmissionHistory.map((e,t)=>(0,r.jsxs)("div",{className:"text-xs text-red-700 border-l-2 border-red-300 pl-2",children:[r.jsx("p",{children:(0,r.jsxs)("strong",{children:["Attempt ",t+1,":"]})}),(0,r.jsxs)("p",{children:["Rejected:"," ",e.rejectedAt instanceof Date?e.rejectedAt.toLocaleDateString():new Date(e.rejectedAt).toLocaleDateString()]}),(0,r.jsxs)("p",{children:["Reason: ",e.reason]}),e.resubmittedAt&&(0,r.jsxs)("p",{children:["Resubmitted:"," ",e.resubmittedAt instanceof Date?e.resubmittedAt.toLocaleDateString():new Date(e.resubmittedAt).toLocaleDateString()]})]},t))})]})]}),(0,r.jsxs)("div",{className:"ml-6 flex flex-col gap-2",children:[r.jsx(u.z,{size:"sm",variant:"outline",asChild:!0,children:r.jsx(l(),{href:`/admin/petitions/${e.id}`,children:"Review"})}),r.jsx(N,{petition:e,onUpdate:t=>{x(s=>s.map(s=>s.id===e.id?t:s)),"all"!==k&&t.status!==e.status&&T()},size:"sm",layout:"vertical",moderatorId:t?.id})]})]})})]})})},e.id))}),h.length>L&&(0,r.jsxs)("div",{className:"mt-6 flex items-center justify-between border-t border-gray-200 pt-6",children:[(0,r.jsxs)("div",{className:"text-sm text-gray-700",children:["Showing"," ",r.jsx("span",{className:"font-medium",children:(R-1)*L+1})," ","to"," ",r.jsx("span",{className:"font-medium",children:Math.min(R*L,h.length)})," ","of ",r.jsx("span",{className:"font-medium",children:h.length})," ","results"]}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsxs)(u.z,{variant:"outline",size:"sm",onClick:()=>S(e=>Math.max(1,e-1)),disabled:1===R,children:[r.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})}),"Previous"]}),r.jsx("div",{className:"flex gap-1",children:Array.from({length:Math.ceil(h.length/L)},(e,t)=>t+1).filter(e=>{let t=Math.ceil(h.length/L);return 1===e||e===t||e>=R-1&&e<=R+1}).map((e,t,s)=>(0,r.jsxs)(i().Fragment,{children:[t>0&&s[t-1]!==e-1&&r.jsx("span",{className:"px-2 py-1 text-gray-500",children:"..."}),r.jsx(u.z,{variant:R===e?"default":"outline",size:"sm",onClick:()=>S(e),className:R===e?"bg-green-600 hover:bg-green-700":"",children:e})]},e))}),(0,r.jsxs)(u.z,{variant:"outline",size:"sm",onClick:()=>S(e=>Math.min(Math.ceil(h.length/L),e+1)),disabled:R===Math.ceil(h.length/L),children:["Next",r.jsx("svg",{className:"w-4 h-4 ml-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})]})]})]})]})]})]}):null}},21663:(e,t,s)=>{"use strict";s.d(t,{Rc:()=>d,fc:()=>u,u2:()=>o,xw:()=>n}),s(53854);var r=s(34218),a=s(51018),i=s(58198);let n=(e="/auth/login")=>{let{user:t,loading:s}=(0,i.useAuth)(),n=(0,a.useRouter)();return(0,r.useEffect)(()=>{if(!s&&!t){let t=window.location.pathname,s=`${e}?redirect=${encodeURIComponent(t)}`;n.push(s)}},[t,s,n,e]),{user:t,loading:s,isAuthenticated:!!t}},l=(e,t="/dashboard")=>{let{user:s,userProfile:n,loading:l}=(0,i.useAuth)(),d=(0,a.useRouter)();return(0,r.useEffect)(()=>{if(!l){if(s)n&&!e.includes(n.role)&&d.push(t);else{let e=window.location.pathname,t=`/auth/login?redirect=${encodeURIComponent(e)}`;d.push(t)}}},[s,n,l,d,e,t]),{user:s,userProfile:n,loading:l,isAuthenticated:!!s,hasRequiredRole:!!n&&e.includes(n.role)}},d=(e="/dashboard")=>l(["admin"],e),o=(e="/dashboard")=>l(["moderator","admin"],e),c=(e,t)=>!!e&&t.includes(e.role),u=e=>c(e,["moderator","admin"])},37042:(e,t,s)=>{"use strict";s.r(t),s.d(t,{$$typeof:()=>i,__esModule:()=>a,default:()=>n});let r=(0,s(95153).createProxy)(String.raw`/Users/brahimamzil/Downloads/DEV_APPS/----3arida/3arida-app/src/app/admin/petitions/page.tsx`),{__esModule:a,$$typeof:i}=r,n=r.default}};var t=require("../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[3271,8025,6078,7490,580,6183,3257],()=>s(98427));module.exports=r})();