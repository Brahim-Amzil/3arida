(()=>{var e={};e.id=1864,e.ids=[1864],e.modules={47849:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external")},72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},55403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},94749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},39491:e=>{"use strict";e.exports=require("assert")},14300:e=>{"use strict";e.exports=require("buffer")},6113:e=>{"use strict";e.exports=require("crypto")},9523:e=>{"use strict";e.exports=require("dns")},82361:e=>{"use strict";e.exports=require("events")},57147:e=>{"use strict";e.exports=require("fs")},13685:e=>{"use strict";e.exports=require("http")},85158:e=>{"use strict";e.exports=require("http2")},41808:e=>{"use strict";e.exports=require("net")},22037:e=>{"use strict";e.exports=require("os")},71017:e=>{"use strict";e.exports=require("path")},77282:e=>{"use strict";e.exports=require("process")},12781:e=>{"use strict";e.exports=require("stream")},24404:e=>{"use strict";e.exports=require("tls")},57310:e=>{"use strict";e.exports=require("url")},73837:e=>{"use strict";e.exports=require("util")},59796:e=>{"use strict";e.exports=require("zlib")},18805:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>l.a,__next_app__:()=>x,originalPathname:()=>m,pages:()=>d,routeModule:()=>h,tree:()=>c});var r=s(50482),a=s(69108),i=s(62563),l=s.n(i),n=s(68300),o={};for(let e in n)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(o[e]=()=>n[e]);s.d(t,o);let c=["",{children:["petitions",{children:["[id]",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,16569)),"/Users/brahimamzil/Downloads/DEV_APPS/----3arida/3arida-app/src/app/petitions/[id]/page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(s.bind(s,66714)),"/Users/brahimamzil/Downloads/DEV_APPS/----3arida/3arida-app/src/app/petitions/layout.tsx"]}]},{layout:[()=>Promise.resolve().then(s.bind(s,33990)),"/Users/brahimamzil/Downloads/DEV_APPS/----3arida/3arida-app/src/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,69361,23)),"next/dist/client/components/not-found-error"]}],d=["/Users/brahimamzil/Downloads/DEV_APPS/----3arida/3arida-app/src/app/petitions/[id]/page.tsx"],m="/petitions/[id]/page",x={require:s,loadChunk:()=>Promise.resolve()},h=new r.AppPageRouteModule({definition:{kind:a.x.APP_PAGE,page:"/petitions/[id]/page",pathname:"/petitions/[id]",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},48541:(e,t,s)=>{Promise.resolve().then(s.bind(s,85925))},97075:(e,t,s)=>{"use strict";s.d(t,{Z:()=>m});var r=s(3729);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),i=e=>e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,s)=>s?s.toUpperCase():t.toLowerCase()),l=e=>{let t=i(e);return t.charAt(0).toUpperCase()+t.slice(1)},n=(...e)=>e.filter((e,t,s)=>!!e&&""!==e.trim()&&s.indexOf(e)===t).join(" ").trim(),o=e=>{for(let t in e)if(t.startsWith("aria-")||"role"===t||"title"===t)return!0};/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var c={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let d=(0,r.forwardRef)(({color:e="currentColor",size:t=24,strokeWidth:s=2,absoluteStrokeWidth:a,className:i="",children:l,iconNode:d,...m},x)=>(0,r.createElement)("svg",{ref:x,...c,width:t,height:t,stroke:e,strokeWidth:a?24*Number(s)/Number(t):s,className:n("lucide",i),...!l&&!o(m)&&{"aria-hidden":"true"},...m},[...d.map(([e,t])=>(0,r.createElement)(e,t)),...Array.isArray(l)?l:[l]])),m=(e,t)=>{let s=(0,r.forwardRef)(({className:s,...i},o)=>(0,r.createElement)(d,{ref:o,iconNode:t,className:n(`lucide-${a(l(e))}`,`lucide-${e}`,s),...i}));return s.displayName=l(e),s}},62312:(e,t,s)=>{"use strict";s.d(t,{Z:()=>r});let r=(0,s(97075).Z)("check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]])},95269:(e,t,s)=>{"use strict";s.d(t,{Z:()=>r});let r=(0,s(97075).Z)("circle-alert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]])},66262:(e,t,s)=>{"use strict";s.d(t,{Z:()=>r});let r=(0,s(97075).Z)("circle-check-big",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]])},48001:(e,t,s)=>{"use strict";s.d(t,{Z:()=>r});let r=(0,s(97075).Z)("pause",[["rect",{x:"14",y:"3",width:"5",height:"18",rx:"1",key:"kaeet6"}],["rect",{x:"5",y:"3",width:"5",height:"18",rx:"1",key:"1wsw3u"}]])},38271:(e,t,s)=>{"use strict";s.d(t,{Z:()=>r});let r=(0,s(97075).Z)("trash-2",[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]])},14513:(e,t,s)=>{"use strict";s.d(t,{Z:()=>r});let r=(0,s(97075).Z)("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]])},20783:(e,t,s)=>{e.exports=s(61476)},85925:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>I});var r=s(95344),a=s(3729),i=s(22254),l=s(41223),n=s.n(l),o=s(20783),c=s.n(o),d=s(49151),m=s(75590),x=s(27007),h=s(56654),u=s(5094),p=s(23673),g=s(16471);function j({petition:e,onClose:t}){let[s,i]=(0,a.useState)(!1),l=`https://3arida.ma/petitions/${e.id}`,n=`Support this petition: ${e.title}`,o=encodeURIComponent(l),c=encodeURIComponent(n),d=async()=>{try{await navigator.clipboard.writeText(l),i(!0),setTimeout(()=>i(!1),2e3),await (0,g.$l)(e.id)}catch(e){console.error("Failed to copy link:",e)}},m=async(t,s)=>{window.open(s,"_blank","width=600,height=400");try{await (0,g.$l)(e.id)}catch(e){console.error("Failed to track share:",e)}},x=[{name:"Facebook",icon:r.jsx("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{d:"M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"})}),url:`https://www.facebook.com/sharer/sharer.php?u=${o}`,color:"bg-blue-600 hover:bg-blue-700"},{name:"X",icon:r.jsx("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{d:"M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"})}),url:`https://twitter.com/intent/tweet?text=${c}&url=${o}`,color:"bg-black hover:bg-gray-900"},{name:"WhatsApp",icon:r.jsx("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{d:"M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893A11.821 11.821 0 0020.885 3.488"})}),url:`https://wa.me/?text=${c}%20${o}`,color:"bg-green-500 hover:bg-green-600"},{name:"LinkedIn",icon:r.jsx("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{d:"M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"})}),url:`https://www.linkedin.com/sharing/share-offsite/?url=${o}`,color:"bg-blue-700 hover:bg-blue-800"},{name:"Telegram",icon:r.jsx("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{d:"M11.944 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0a12 12 0 0 0-.056 0zm4.962 7.224c.1-.002.321.023.465.14a.506.506 0 0 1 .171.325c.016.093.036.306.02.472-.18 1.898-.962 6.502-1.36 8.627-.168.9-.499 1.201-.82 1.23-.696.065-1.225-.46-1.9-.902-1.056-.693-1.653-1.124-2.678-1.8-1.185-.78-.417-1.21.258-1.91.177-.184 3.247-2.977 3.307-3.23.007-.032.014-.15-.056-.212s-.174-.041-.249-.024c-.106.024-1.793 1.14-5.061 3.345-.48.33-.913.49-1.302.48-.428-.008-1.252-.241-1.865-.44-.752-.245-1.349-.374-1.297-.789.027-.216.325-.437.893-.663 3.498-1.524 5.83-2.529 6.998-3.014 3.332-1.386 4.025-1.627 4.476-1.635z"})}),url:`https://t.me/share/url?url=${o}&text=${c}`,color:"bg-blue-500 hover:bg-blue-600"}];return(0,r.jsxs)(p.Zb,{className:"w-full max-w-md",children:[r.jsx(p.Ol,{children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[r.jsx(p.ll,{children:"Share Petition"}),t&&r.jsx("button",{onClick:t,className:"text-gray-400 hover:text-gray-600 p-1",children:r.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})}),(0,r.jsxs)(p.aY,{className:"space-y-6",children:[(0,r.jsxs)("div",{className:"p-4 bg-gray-50 rounded-lg",children:[r.jsx("h4",{className:"font-medium text-gray-900 mb-2 line-clamp-2",children:e.title}),(0,r.jsxs)("div",{className:"flex items-center gap-4 text-sm text-gray-600",children:[(0,r.jsxs)("span",{children:[e.currentSignatures.toLocaleString()," signatures"]}),r.jsx("span",{children:e.category})]})]}),(0,r.jsxs)("button",{onClick:()=>m("WhatsApp",`https://wa.me/?text=${c}%20${o}`),className:"w-full bg-green-500 hover:bg-green-600 text-white p-3 rounded-lg flex items-center justify-center gap-2 transition-colors",children:[r.jsx("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{d:"M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893A11.821 11.821 0 0020.885 3.488"})}),r.jsx("span",{className:"text-sm font-medium",children:"WhatsApp"})]}),(0,r.jsxs)("div",{children:[r.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-3",children:"Share on social media"}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[x.filter(e=>"WhatsApp"!==e.name).map(e=>(0,r.jsxs)("button",{onClick:()=>m(e.name,e.url),className:`${e.color} text-white p-3 rounded-lg flex items-center justify-center gap-2 transition-colors`,children:[e.icon,r.jsx("span",{className:"text-sm font-medium",children:e.name})]},e.name)),!1]})]}),(0,r.jsxs)("div",{children:[r.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-3",children:"Copy link"}),(0,r.jsxs)("div",{className:"flex gap-2",children:[r.jsx("input",{type:"text",value:l,readOnly:!0,className:"flex-1 px-3 py-2 border border-gray-300 rounded-md bg-gray-50 text-sm"}),r.jsx(u.z,{onClick:d,variant:"outline",className:s?"bg-green-50 border-green-300 text-green-700":"",children:s?(0,r.jsxs)(r.Fragment,{children:[r.jsx("svg",{className:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),"Copied"]}):(0,r.jsxs)(r.Fragment,{children:[r.jsx("svg",{className:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})}),"Copy"]})})]})]}),r.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:(0,r.jsxs)("div",{className:"flex items-start",children:[r.jsx("svg",{className:"w-5 h-5 text-blue-600 mr-2 mt-0.5 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),(0,r.jsxs)("div",{children:[r.jsx("h5",{className:"text-sm font-medium text-blue-800 mb-1",children:"Sharing Tips"}),(0,r.jsxs)("ul",{className:"text-xs text-blue-700 space-y-1",children:[r.jsx("li",{children:"• Add a personal message when sharing"}),r.jsx("li",{children:"• Share with friends who care about this cause"}),r.jsx("li",{children:"• Post in relevant groups and communities"}),r.jsx("li",{children:"• Use relevant hashtags on social media"})]})]})]})})]})]})}var b=s(87382),f=s(87097),y=s(81012);function v({petitionId:e,className:t="",onCommentsCountChange:s}){let{user:i,userProfile:l}=(0,b.useAuth)(),[n,o]=(0,a.useState)([]),[c,d]=(0,a.useState)(!0),[m,x]=(0,a.useState)(!1),[h,g]=(0,a.useState)(""),[j,v]=(0,a.useState)(!1),[N,w]=(0,a.useState)(!1),[k,C]=(0,a.useState)("latest"),[S,A]=(0,a.useState)(new Set);(0,a.useEffect)(()=>{P()},[e]);let P=async()=>{try{d(!0),console.log("\uD83D\uDD0D Loading comments for petition:",e);let t=(0,f.collection)(y.db,"comments"),r=(0,f.query)(t,(0,f.where)("petitionId","==",e),(0,f.orderBy)("createdAt","desc")),a=await (0,f.getDocs)(r),l=[];console.log("\uD83D\uDCCA Found comments:",a.size),a.forEach(e=>{let t=e.data(),s=t.likedBy||[];i&&s.includes(i.uid)&&A(t=>new Set(t).add(e.id)),l.push({id:e.id,petitionId:t.petitionId,authorId:t.authorId,authorName:t.authorName,content:t.content,createdAt:t.createdAt?.toDate()||new Date,isAnonymous:t.isAnonymous||!1,likes:t.likes||0,likedBy:s,replies:[]})}),console.log("✅ Loaded comments:",l.length);let n=D(l,k);o(n),s?.(l.length)}catch(e){console.error("❌ Error loading comments:",e),alert("Failed to load comments. Check console for details.")}finally{d(!1)}},D=(e,t)=>"mostLiked"===t?[...e].sort((e,t)=>t.likes-e.likes):[...e].sort((e,t)=>t.createdAt.getTime()-e.createdAt.getTime());(0,a.useEffect)(()=>{n.length>0&&o(D(n,k))},[k]);let z=async t=>{if(t.preventDefault(),i&&l&&h.trim())try{x(!0);let t={petitionId:e,authorId:i.uid,authorName:j?"Anonymous":l.name,content:h.trim(),createdAt:f.Timestamp.fromDate(new Date),isAnonymous:j,likes:0},r={id:(await (0,f.addDoc)((0,f.collection)(y.db,"comments"),t)).id,...t,createdAt:new Date,replies:[]};o(e=>{let t=[r,...e];return s?.(t.length),t}),g(""),w(!1)}catch(e){console.error("Error submitting comment:",e),alert("Failed to submit comment. Please try again.")}finally{x(!1)}},L=async e=>{if(!i){alert("Please sign in to like comments");return}try{let t=(0,f.doc)(y.db,"comments",e);if(S.has(e))await (0,f.updateDoc)(t,{likes:(0,f.nP)(-1),likedBy:n.find(t=>t.id===e)?.likedBy?.filter(e=>e!==i.uid)||[]}),A(t=>{let s=new Set(t);return s.delete(e),s}),o(t=>t.map(t=>t.id===e?{...t,likes:t.likes-1,likedBy:t.likedBy?.filter(e=>e!==i.uid)}:t));else{let s=n.find(t=>t.id===e)?.likedBy||[];await (0,f.updateDoc)(t,{likes:(0,f.nP)(1),likedBy:[...s,i.uid]}),A(t=>new Set(t).add(e)),o(t=>t.map(t=>t.id===e?{...t,likes:t.likes+1,likedBy:[...t.likedBy||[],i.uid]}:t))}}catch(e){console.error("Error liking comment:",e),alert("Failed to like comment. Please try again.")}},M=e=>{let t=Math.floor((new Date().getTime()-e.getTime())/1e3);return t<60?"just now":t<3600?`${Math.floor(t/60)}m ago`:t<86400?`${Math.floor(t/3600)}h ago`:t<604800?`${Math.floor(t/86400)}d ago`:e.toLocaleDateString()};return(0,r.jsxs)(p.Zb,{className:t,children:[(0,r.jsxs)(p.Ol,{children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,r.jsxs)(p.ll,{children:["Discussion (",n.length,")"]}),i&&!N&&r.jsx(u.z,{onClick:()=>w(!0),size:"sm",children:"Add Comment"})]}),n.length>0&&(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[r.jsx("span",{className:"text-sm text-gray-600",children:"Sort by:"}),(0,r.jsxs)("div",{className:"flex gap-2",children:[r.jsx("button",{onClick:()=>C("latest"),className:`px-3 py-1.5 text-sm rounded-md transition-colors ${"latest"===k?"bg-green-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:"Latest"}),r.jsx("button",{onClick:()=>C("mostLiked"),className:`px-3 py-1.5 text-sm rounded-md transition-colors ${"mostLiked"===k?"bg-green-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:"Most Liked"})]})]})]}),(0,r.jsxs)(p.aY,{className:"space-y-6",children:[N&&i&&r.jsx("div",{className:"border border-gray-200 rounded-lg p-4 bg-gray-50",children:(0,r.jsxs)("form",{onSubmit:z,className:"space-y-4",children:[(0,r.jsxs)("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Share your thoughts"}),r.jsx("textarea",{value:h,onChange:e=>g(e.target.value),placeholder:"Why do you support this petition?",rows:4,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent resize-none",disabled:m,required:!0})]}),(0,r.jsxs)("div",{className:"flex items-center",children:[r.jsx("input",{type:"checkbox",id:"anonymous",checked:j,onChange:e=>v(e.target.checked),className:"mr-2"}),r.jsx("label",{htmlFor:"anonymous",className:"text-sm text-gray-600",children:"Comment anonymously"})]}),(0,r.jsxs)("div",{className:"flex gap-3",children:[r.jsx(u.z,{type:"submit",disabled:m||!h.trim(),size:"sm",children:m?(0,r.jsxs)(r.Fragment,{children:[r.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Posting..."]}):"Post Comment"}),r.jsx(u.z,{type:"button",variant:"outline",onClick:()=>{w(!1),g(""),v(!1)},size:"sm",children:"Cancel"})]})]})}),!i&&(0,r.jsxs)("div",{className:"text-center py-8 bg-gray-50 rounded-lg",children:[r.jsx("svg",{className:"w-12 h-12 mx-auto mb-4 text-gray-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})}),r.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Join the Discussion"}),r.jsx("p",{className:"text-gray-600 mb-4",children:"Sign in to share your thoughts and support this petition."}),r.jsx(u.z,{asChild:!0,children:r.jsx("a",{href:`/auth/login?redirect=${encodeURIComponent(window.location.pathname)}`,children:"Sign In to Comment"})})]}),c?r.jsx("div",{className:"space-y-4",children:[void 0,void 0,void 0].map((e,t)=>r.jsx("div",{className:"animate-pulse",children:(0,r.jsxs)("div",{className:"flex items-start space-x-3",children:[r.jsx("div",{className:"w-10 h-10 bg-gray-200 rounded-full"}),(0,r.jsxs)("div",{className:"flex-1",children:[r.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/4 mb-2"}),r.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4 mb-1"}),r.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/2"})]})]})},t))}):0===n.length?(0,r.jsxs)("div",{className:"text-center py-8",children:[r.jsx("svg",{className:"w-12 h-12 mx-auto mb-4 text-gray-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})}),r.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No comments yet"}),r.jsx("p",{className:"text-gray-600",children:"Be the first to share your thoughts on this petition."})]}):r.jsx("div",{className:"space-y-6",children:n.map(e=>(0,r.jsxs)("div",{className:"flex items-start space-x-3",children:[r.jsx("div",{className:"w-10 h-10 bg-green-100 rounded-full flex items-center justify-center flex-shrink-0",children:r.jsx("span",{className:"text-green-600 font-medium text-sm",children:e.isAnonymous?"?":e.authorName.charAt(0).toUpperCase()})}),(0,r.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[r.jsx("span",{className:"font-medium text-gray-900",children:e.authorName}),e.isAnonymous&&r.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-600",children:"Anonymous"}),r.jsx("span",{className:"text-sm text-gray-500",children:M(e.createdAt)})]}),r.jsx("p",{className:"text-gray-700 whitespace-pre-wrap mb-3",children:e.content}),(0,r.jsxs)("div",{className:"flex items-center gap-4",children:[(0,r.jsxs)("button",{onClick:()=>L(e.id),className:`flex items-center gap-1 text-sm transition-colors ${S.has(e.id)?"text-red-500 hover:text-red-600":"text-gray-500 hover:text-gray-700"}`,disabled:!i,children:[r.jsx("svg",{className:`w-4 h-4 ${S.has(e.id)?"fill-current":""}`,fill:S.has(e.id)?"currentColor":"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"})}),e.likes>0&&r.jsx("span",{className:"font-medium",children:e.likes})]}),r.jsx("button",{className:"text-sm text-gray-500 hover:text-gray-700",children:"Reply"}),e.authorId===i?.uid&&r.jsx("button",{className:"text-sm text-red-500 hover:text-red-700",children:"Delete"})]})]})]},e.id))}),n.length>0&&n.length%10==0&&r.jsx("div",{className:"text-center",children:r.jsx(u.z,{variant:"outline",size:"sm",children:"Load More Comments"})})]})]})}var N=s(38271),w=s(97075);let k=(0,w.Z)("archive",[["rect",{width:"20",height:"5",x:"2",y:"3",rx:"1",key:"1wp1u1"}],["path",{d:"M4 8v11a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8",key:"1s80jp"}],["path",{d:"M10 12h4",key:"a56b0p"}]]);var C=s(95269);function S({petition:e,onDelete:t,onArchive:s,onRequestDeletion:i}){let[l,n]=(0,a.useState)(!1),[o,c]=(0,a.useState)(!1),[d,m]=(0,a.useState)(!1),[x,h]=(0,a.useState)(""),[g,j]=(0,a.useState)(!1),b=async()=>{try{j(!0),await t(),n(!1)}catch(e){console.error("Error deleting petition:",e),alert("Failed to delete petition. Please try again.")}finally{j(!1)}},f=async()=>{try{j(!0),await s(),c(!1)}catch(e){console.error("Error archiving petition:",e),alert("Failed to archive petition. Please try again.")}finally{j(!1)}},y=async()=>{if(!x.trim()){alert("Please provide a reason for deletion");return}try{j(!0),await i(x),m(!1),h(""),alert("Deletion request submitted. An admin will review it shortly.")}catch(e){console.error("Error requesting deletion:",e),alert("Failed to submit deletion request. Please try again.")}finally{j(!1)}},v=(()=>{let t=e.createdAt.getTime(),s=Date.now();return e.currentSignatures<=10||"pending"===e.status||(s-t)/36e5<24})();return(0,r.jsxs)(r.Fragment,{children:[l&&r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,r.jsxs)("div",{className:"bg-white rounded-lg max-w-md w-full p-6",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3 mb-4",children:[r.jsx("div",{className:"w-12 h-12 bg-red-100 rounded-full flex items-center justify-center",children:r.jsx(N.Z,{className:"w-6 h-6 text-red-600"})}),(0,r.jsxs)("div",{children:[r.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Delete Petition?"}),r.jsx("p",{className:"text-sm text-gray-600",children:"This action cannot be undone"})]})]}),r.jsx("p",{className:"text-gray-700 mb-6",children:"Are you sure you want to permanently delete this petition? All signatures, comments, and data will be removed from public view."}),(0,r.jsxs)("div",{className:"flex gap-3 justify-end",children:[r.jsx(u.z,{variant:"outline",onClick:()=>n(!1),disabled:g,children:"Cancel"}),r.jsx(u.z,{variant:"destructive",onClick:b,disabled:g,children:g?"Deleting...":"Delete Petition"})]})]})}),o&&r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,r.jsxs)("div",{className:"bg-white rounded-lg max-w-md w-full p-6",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3 mb-4",children:[r.jsx("div",{className:"w-12 h-12 bg-yellow-100 rounded-full flex items-center justify-center",children:r.jsx(k,{className:"w-6 h-6 text-yellow-600"})}),(0,r.jsxs)("div",{children:[r.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Archive Petition?"}),r.jsx("p",{className:"text-sm text-gray-600",children:"You can restore it later"})]})]}),r.jsx("p",{className:"text-gray-700 mb-6",children:"Archiving will hide this petition from public view, but you can restore it anytime from your dashboard. All data will be preserved."}),(0,r.jsxs)("div",{className:"flex gap-3 justify-end",children:[r.jsx(u.z,{variant:"outline",onClick:()=>c(!1),disabled:g,children:"Cancel"}),r.jsx(u.z,{className:"bg-yellow-600 hover:bg-yellow-700",onClick:f,disabled:g,children:g?"Archiving...":"Archive Petition"})]})]})}),d&&r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,r.jsxs)("div",{className:"bg-white rounded-lg max-w-md w-full p-6",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3 mb-4",children:[r.jsx("div",{className:"w-12 h-12 bg-orange-100 rounded-full flex items-center justify-center",children:r.jsx(C.Z,{className:"w-6 h-6 text-orange-600"})}),(0,r.jsxs)("div",{children:[r.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Request Deletion"}),r.jsx("p",{className:"text-sm text-gray-600",children:"Admin will review your request"})]})]}),r.jsx("p",{className:"text-gray-700 mb-4",children:"Your petition has significant support. Please explain why you want to delete it, and an admin will review your request."}),r.jsx("textarea",{value:x,onChange:e=>h(e.target.value),placeholder:"Reason for deletion request...",rows:4,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-transparent resize-none mb-4",disabled:g}),(0,r.jsxs)("div",{className:"flex gap-3 justify-end",children:[r.jsx(u.z,{variant:"outline",onClick:()=>{m(!1),h("")},disabled:g,children:"Cancel"}),r.jsx(u.z,{className:"bg-orange-600 hover:bg-orange-700",onClick:y,disabled:g||!x.trim(),children:g?"Submitting...":"Submit Request"})]})]})}),(0,r.jsxs)(p.Zb,{className:"border-orange-200 bg-orange-50",children:[r.jsx(p.Ol,{children:(0,r.jsxs)(p.ll,{className:"text-lg flex items-center gap-2",children:[r.jsx(C.Z,{className:"w-5 h-5 text-orange-600"}),"Petition Management"]})}),(0,r.jsxs)(p.aY,{className:"space-y-3",children:[r.jsx("p",{className:"text-sm text-gray-700 mb-4",children:"As the creator, you can manage this petition."}),v?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(u.z,{variant:"destructive",onClick:()=>n(!0),className:"w-full flex items-center justify-center gap-2",children:[r.jsx(N.Z,{className:"w-4 h-4"}),"Delete Petition"]}),r.jsx("p",{className:"text-xs text-gray-600",children:"You can delete this petition because it has ≤10 signatures, is pending approval, or was created within 24 hours."})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(u.z,{className:"w-full flex items-center justify-center gap-2 bg-yellow-600 hover:bg-yellow-700",onClick:()=>c(!0),children:[r.jsx(k,{className:"w-4 h-4"}),"Archive Petition"]}),(0,r.jsxs)(u.z,{variant:"outline",onClick:()=>m(!0),className:"w-full flex items-center justify-center gap-2 border-orange-300 text-orange-700 hover:bg-orange-100",children:[r.jsx(C.Z,{className:"w-4 h-4"}),"Request Deletion"]}),r.jsx("p",{className:"text-xs text-gray-600",children:"This petition has significant support. You can archive it or request admin approval for deletion."})]})]})]})]})}let A=(0,w.Z)("plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]),P=(0,w.Z)("clock",[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);function D({petitionId:e,isCreator:t}){let[i,l]=(0,a.useState)([]),[n,o]=(0,a.useState)(!0),[c,d]=(0,a.useState)(!1),[m,x]=(0,a.useState)({title:"",content:""}),[h,g]=(0,a.useState)(!1),[j,b]=(0,a.useState)(null),[f,y]=(0,a.useState)({title:"",content:""}),[v,N]=(0,a.useState)(null),[w,k]=(0,a.useState)(!1);(0,a.useEffect)(()=>{C()},[e]);let C=async()=>{try{let{collection:t,query:r,where:a,orderBy:i,getDocs:n}=await Promise.resolve().then(s.bind(s,87097)),{db:o}=await Promise.resolve().then(s.bind(s,81012)),c=t(o,"petitionUpdates"),d=r(c,a("petitionId","==",e),i("createdAt","desc")),m=(await n(d)).docs.map(e=>{let t=e.data();return{id:e.id,...t,createdAt:t.createdAt?.toDate()||new Date}});l(m)}catch(e){console.error("Error fetching updates:",e)}finally{o(!1)}},S=async t=>{if(t.preventDefault(),!m.title.trim()||!m.content.trim()){alert("Please fill in all fields");return}g(!0);try{let{collection:t,addDoc:r,serverTimestamp:a}=await Promise.resolve().then(s.bind(s,87097)),{db:i,auth:l}=await Promise.resolve().then(s.bind(s,81012)),n=l.currentUser;if(!n){alert("You must be logged in to post updates");return}await r(t(i,"petitionUpdates"),{petitionId:e,title:m.title.trim(),content:m.content.trim(),createdAt:a(),createdBy:n.uid,createdByName:n.displayName||"Anonymous"}),x({title:"",content:""}),d(!1),await C()}catch(e){console.error("Error adding update:",e),alert("Failed to add update. Please try again.")}finally{g(!1)}},D=e=>{b(e.id),y({title:e.title,content:e.content})},z=async e=>{if(!f.title.trim()||!f.content.trim()){alert("Please fill in all fields");return}g(!0);try{let{doc:t,updateDoc:r,serverTimestamp:a}=await Promise.resolve().then(s.bind(s,87097)),{db:i}=await Promise.resolve().then(s.bind(s,81012)),l=t(i,"petitionUpdates",e);await r(l,{title:f.title.trim(),content:f.content.trim(),editedAt:a(),editedOnce:!0}),b(null),y({title:"",content:""}),await C()}catch(e){console.error("Error updating:",e),alert("Failed to update. Please try again.")}finally{g(!1)}},L=e=>{N(e)},M=async()=>{if(v){k(!0);try{let{doc:e,deleteDoc:t}=await Promise.resolve().then(s.bind(s,87097)),{db:r}=await Promise.resolve().then(s.bind(s,81012)),a=e(r,"petitionUpdates",v);await t(a),N(null),await C()}catch(e){console.error("Error deleting update:",e),alert("Failed to delete update. Please try again.")}finally{k(!1)}}},T=e=>new Intl.DateTimeFormat("en-US",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}).format(e);return n?r.jsx(p.Zb,{children:r.jsx(p.aY,{className:"py-8 text-center",children:r.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-green-600 mx-auto"})})}):(0,r.jsxs)(r.Fragment,{children:[v&&r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,r.jsxs)("div",{className:"bg-white rounded-lg max-w-md w-full p-6 shadow-xl",children:[(0,r.jsxs)("div",{className:"flex items-start mb-4",children:[r.jsx("div",{className:"flex-shrink-0 w-10 h-10 bg-red-100 rounded-full flex items-center justify-center",children:r.jsx("svg",{className:"w-6 h-6 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),(0,r.jsxs)("div",{className:"ml-4 flex-1",children:[r.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Delete Update?"}),r.jsx("p",{className:"text-sm text-gray-600",children:"Are you sure you want to delete this update? This action cannot be undone."})]})]}),(0,r.jsxs)("div",{className:"flex gap-3 justify-end",children:[r.jsx(u.z,{variant:"outline",onClick:()=>{N(null)},disabled:w,children:"Cancel"}),r.jsx(u.z,{variant:"destructive",onClick:M,disabled:w,children:w?"Deleting...":"Delete"})]})]})}),r.jsx(p.Zb,{children:(0,r.jsxs)(p.aY,{className:"p-6",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[r.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Updates"}),t&&!c&&(0,r.jsxs)(u.z,{onClick:()=>d(!0),size:"sm",className:"flex items-center gap-2",children:[r.jsx(A,{className:"w-4 h-4"}),"Post Update"]})]}),c&&(0,r.jsxs)("form",{onSubmit:S,className:"mb-6 space-y-4",children:[(0,r.jsxs)("div",{children:[r.jsx("label",{htmlFor:"update-title",className:"block text-sm font-medium text-gray-700 mb-1",children:"Update Title"}),r.jsx("input",{id:"update-title",type:"text",value:m.title,onChange:e=>x({...m,title:e.target.value}),placeholder:"e.g., We reached 1,000 signatures!",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500",maxLength:100,disabled:h})]}),(0,r.jsxs)("div",{children:[r.jsx("label",{htmlFor:"update-content",className:"block text-sm font-medium text-gray-700 mb-1",children:"Update Content"}),r.jsx("textarea",{id:"update-content",value:m.content,onChange:e=>x({...m,content:e.target.value}),placeholder:"Share progress, news, or thank supporters...",rows:4,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500",maxLength:1e3,disabled:h}),(0,r.jsxs)("p",{className:"text-xs text-gray-500 mt-1",children:[m.content.length,"/1000 characters"]})]}),(0,r.jsxs)("div",{className:"flex gap-2",children:[r.jsx(u.z,{type:"submit",disabled:h,children:h?"Posting...":"Post Update"}),r.jsx(u.z,{type:"button",variant:"outline",onClick:()=>{d(!1),x({title:"",content:""})},disabled:h,children:"Cancel"})]})]}),i.length>0?r.jsx("div",{className:"space-y-6",children:i.map((e,s)=>(0,r.jsxs)("div",{className:"relative",children:[s<i.length-1&&r.jsx("div",{className:"absolute left-4 top-10 bottom-0 w-0.5 bg-gray-200"}),(0,r.jsxs)("div",{className:"flex gap-4",children:[r.jsx("div",{className:"flex-shrink-0 w-8 h-8 bg-green-100 rounded-full flex items-center justify-center relative z-10",children:r.jsx(P,{className:"w-4 h-4 text-green-600"})}),r.jsx("div",{className:"flex-1 pb-6",children:j===e.id?(0,r.jsxs)("div",{className:"bg-white border border-gray-300 rounded-lg p-4 shadow-sm space-y-3",children:[r.jsx("div",{children:r.jsx("input",{type:"text",value:f.title,onChange:e=>y({...f,title:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500",maxLength:100,disabled:h})}),(0,r.jsxs)("div",{children:[r.jsx("textarea",{value:f.content,onChange:e=>y({...f,content:e.target.value}),rows:4,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500",maxLength:1e3,disabled:h}),(0,r.jsxs)("p",{className:"text-xs text-gray-500 mt-1",children:[f.content.length,"/1000 characters"]})]}),(0,r.jsxs)("div",{className:"flex gap-2",children:[r.jsx(u.z,{size:"sm",onClick:()=>z(e.id),disabled:h,children:h?"Saving...":"Save Changes"}),r.jsx(u.z,{size:"sm",variant:"outline",onClick:()=>{b(null),y({title:"",content:""})},disabled:h,children:"Cancel"})]}),(0,r.jsxs)("p",{className:"text-xs text-amber-600 flex items-center gap-1",children:[r.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),"You can only edit this update once"]})]}):(0,r.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 shadow-sm",children:[(0,r.jsxs)("div",{className:"flex items-start justify-between mb-1",children:[r.jsx("h3",{className:"font-semibold text-gray-900 flex-1",children:e.title}),t&&(0,r.jsxs)("div",{className:"flex gap-1 ml-2",children:[!e.editedOnce&&r.jsx("button",{onClick:()=>D(e),className:"p-1 text-blue-600 hover:bg-blue-100 rounded transition-colors",title:"Edit update (one time only)",children:r.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})}),r.jsx("button",{onClick:()=>L(e.id),className:"p-1 text-red-600 hover:bg-red-100 rounded transition-colors",title:"Delete update",children:r.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]}),(0,r.jsxs)("p",{className:"text-xs text-blue-600 mb-3",children:[T(e.createdAt)," • by"," ",e.createdByName,e.editedAt&&(0,r.jsxs)("span",{className:"ml-2 text-amber-600",children:["• Edited ",T(e.editedAt)]})]}),r.jsx("p",{className:"text-gray-700 whitespace-pre-wrap",children:e.content})]})})]})]},e.id))}):(0,r.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[r.jsx("svg",{className:"w-12 h-12 mx-auto mb-4 text-gray-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 20H5a2 2 0 01-2-2V6a2 2 0 012-2h10a2 2 0 012 2v1m2 13a2 2 0 01-2-2V7m2 13a2 2 0 002-2V9a2 2 0 00-2-2h-2m-4-3H9M7 16h6M7 8h6v4H7V8z"})}),r.jsx("p",{className:"font-medium",children:"No updates yet"}),r.jsx("p",{className:"text-sm",children:t?"Post your first update to keep supporters informed":"The petition creator hasn't posted any updates"})]})]})})]})}function z({petitionId:e}){let[t,s]=(0,a.useState)([]),[i,l]=(0,a.useState)(!0),[n,o]=(0,a.useState)(!1),[c,d]=(0,a.useState)(null),[m,x]=(0,a.useState)(!0),[h,u]=(0,a.useState)(0);(0,a.useEffect)(()=>{p()},[e]);let p=async(t=!1)=>{try{t?o(!0):l(!0);let r=(0,f.collection)(y.db,"signatures"),a=(0,f.query)(r,(0,f.where)("petitionId","==",e),(0,f.orderBy)("signedAt","desc"),(0,f.b9)(20));t&&c&&(a=(0,f.query)(r,(0,f.where)("petitionId","==",e),(0,f.orderBy)("signedAt","desc"),(0,f.TQ)(c),(0,f.b9)(20)));let i=await (0,f.getDocs)(a);if(i.empty){x(!1);return}let n=i.docs.map(e=>{let t=e.data();return{id:e.id,name:t.name||"Anonymous",location:t.location,comment:t.comment,signedAt:t.signedAt?.toDate()||new Date}});t?s(e=>[...e,...n]):(s(n),u(n.length)),d(i.docs[i.docs.length-1]),x(20===i.docs.length)}catch(e){console.error("Error fetching signatures:",e)}finally{l(!1),o(!1)}};return i?r.jsx("div",{className:"flex items-center justify-center py-12",children:r.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-green-600"})}):0===t.length?(0,r.jsxs)("div",{className:"text-center py-12",children:[r.jsx("svg",{className:"w-12 h-12 mx-auto mb-4 text-gray-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"})}),r.jsx("p",{className:"text-gray-500 font-medium",children:"No signatures yet"}),r.jsx("p",{className:"text-sm text-gray-400 mt-1",children:"Be the first to sign this petition!"})]}):(0,r.jsxs)("div",{className:"space-y-4",children:[r.jsx("div",{className:"flex items-center justify-between mb-4",children:(0,r.jsxs)("h3",{className:"text-lg font-semibold text-gray-900",children:[t.length.toLocaleString()," Supporters"]})}),r.jsx("div",{className:"space-y-3",children:t.map(e=>r.jsx("div",{className:"bg-white border border-gray-200 rounded-lg p-4 hover:shadow-sm transition-shadow",children:(0,r.jsxs)("div",{className:"flex items-start justify-between",children:[(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[r.jsx("div",{className:"w-8 h-8 rounded-full bg-green-100 flex items-center justify-center",children:r.jsx("span",{className:"text-green-700 font-medium text-sm",children:e.name.charAt(0).toUpperCase()})}),(0,r.jsxs)("div",{children:[r.jsx("p",{className:"font-medium text-gray-900",children:e.name}),e.location&&r.jsx("p",{className:"text-sm text-gray-500",children:[e.location.city,e.location.country].filter(Boolean).join(", ")})]})]}),e.comment&&(0,r.jsxs)("p",{className:"mt-2 text-sm text-gray-700 italic",children:['"',e.comment,'"']})]}),r.jsx("span",{className:"text-xs text-gray-400 whitespace-nowrap ml-4",children:e.signedAt.toLocaleDateString()})]})},e.id))}),m&&r.jsx("div",{className:"flex justify-center pt-4",children:r.jsx("button",{onClick:()=>{!n&&m&&p(!0)},disabled:n,className:"px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:n?(0,r.jsxs)("span",{className:"flex items-center gap-2",children:[r.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Loading..."]}):"Load More"})})]})}let L=e=>{let[t,s]=(0,a.useState)(null),[r,i]=(0,a.useState)(!0),[l,n]=(0,a.useState)("");return(0,a.useEffect)(()=>{if(!e){i(!1);return}let t=null;return(async()=>{try{let r=e;if(e.includes("-")&&e.length<=15){console.log("\uD83D\uDD0D Looking up petition by reference code:",e);let t=(0,f.query)((0,f.collection)(y.db,"petitions"),(0,f.where)("referenceCode","==",e)),a=await (0,f.getDocs)(t);if(a.empty){console.log("❌ No petition found with reference code:",e),n("Petition not found"),s(null),i(!1);return}r=a.docs[0].id,console.log("✅ Found petition ID:",r)}let a=(0,f.doc)(y.db,"petitions",r);t=(0,f.cf)(a,e=>{if(e.exists()){let t=e.data();s({id:e.id,...t,createdAt:t.createdAt?.toDate?.()||new Date,updatedAt:t.updatedAt?.toDate?.()||new Date}),n("")}else n("Petition not found"),s(null);i(!1)},e=>{console.error("❌ Error listening to petition:",e),n("Failed to load petition"),s(null),i(!1)})}catch(e){console.error("❌ Error setting up petition listener:",e),n("Failed to load petition"),s(null),i(!1)}})(),()=>{t&&t()}},[e]),{petition:t,loading:r,error:l}};var M=s(78653),T=s(3913),B=s(14513),E=s(48001),q=s(62312);let Z=(0,w.Z)("play",[["path",{d:"M5 5a2 2 0 0 1 3.008-1.728l11.997 6.998a2 2 0 0 1 .003 3.458l-12 7A2 2 0 0 1 5 19z",key:"10ikf1"}]]);var U=s(51133),$=s(66262);let H=(0,w.Z)("circle-x",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);function F({data:e,onClose:t}){let s=(()=>{switch(e.type){case"approved":return{bg:"bg-green-50 border-green-200",icon:r.jsx($.Z,{className:"w-6 h-6 text-green-600"}),iconBg:"bg-green-100",textColor:"text-green-900",titleColor:"text-green-800"};case"rejected":return{bg:"bg-red-50 border-red-200",icon:r.jsx(H,{className:"w-6 h-6 text-red-600"}),iconBg:"bg-red-100",textColor:"text-red-900",titleColor:"text-red-800"};case"paused":return{bg:"bg-orange-50 border-orange-200",icon:r.jsx(E.Z,{className:"w-6 h-6 text-orange-600"}),iconBg:"bg-orange-100",textColor:"text-orange-900",titleColor:"text-orange-800"};case"deleted":return{bg:"bg-gray-50 border-gray-300",icon:r.jsx(N.Z,{className:"w-6 h-6 text-gray-600"}),iconBg:"bg-gray-100",textColor:"text-gray-900",titleColor:"text-gray-800"};case"archived":return{bg:"bg-blue-50 border-blue-200",icon:r.jsx(C.Z,{className:"w-6 h-6 text-blue-600"}),iconBg:"bg-blue-100",textColor:"text-blue-900",titleColor:"text-blue-800"};case"deletion_approved":return{bg:"bg-red-50 border-red-200",icon:r.jsx($.Z,{className:"w-6 h-6 text-red-600"}),iconBg:"bg-red-100",textColor:"text-red-900",titleColor:"text-red-800"};case"deletion_denied":return{bg:"bg-yellow-50 border-yellow-200",icon:r.jsx(H,{className:"w-6 h-6 text-yellow-600"}),iconBg:"bg-yellow-100",textColor:"text-yellow-900",titleColor:"text-yellow-800"};default:return{bg:"bg-gray-50 border-gray-200",icon:r.jsx(C.Z,{className:"w-6 h-6 text-gray-600"}),iconBg:"bg-gray-100",textColor:"text-gray-900",titleColor:"text-gray-800"}}})();return r.jsx("div",{className:`relative rounded-lg border-2 ${s.bg} p-4 mb-6 shadow-md animate-in slide-in-from-top duration-300`,role:"alert",children:(0,r.jsxs)("div",{className:"flex items-start gap-4",children:[r.jsx("div",{className:`flex-shrink-0 ${s.iconBg} rounded-full p-2`,children:s.icon}),(0,r.jsxs)("div",{className:"flex-1 min-w-0",children:[r.jsx("h3",{className:`text-lg font-semibold ${s.titleColor} mb-1`,children:e.title}),r.jsx("p",{className:`text-sm ${s.textColor} mb-2`,children:e.message}),e.reason&&(0,r.jsxs)("div",{className:"mt-3 p-3 bg-white bg-opacity-60 rounded-md border border-current border-opacity-20",children:[r.jsx("p",{className:"text-xs font-medium text-gray-700 mb-1",children:"Admin's Reason:"}),(0,r.jsxs)("p",{className:`text-sm ${s.textColor} italic`,children:['"',e.reason,'"']})]}),e.timestamp&&r.jsx("p",{className:"text-xs text-gray-500 mt-2",children:e.timestamp.toLocaleString()})]}),r.jsx("button",{onClick:t,className:"flex-shrink-0 text-gray-400 hover:text-gray-600 transition-colors","aria-label":"Close notification",children:r.jsx(B.Z,{className:"w-5 h-5"})})]})})}function I(){let e=(0,i.useParams)(),t=(0,i.useRouter)(),l=(0,i.useSearchParams)(),o=e?.id,{user:f,userProfile:y}=(0,b.useAuth)(),{petition:w,loading:C,error:A}=L(o),[P,$]=(0,a.useState)(!1),[H,I]=(0,a.useState)(!1),[R,_]=(0,a.useState)(!1),[V,W]=(0,a.useState)(!1),[Y,O]=(0,a.useState)(!1),[X,G]=(0,a.useState)(null),[Q,J]=(0,a.useState)(null),[K,ee]=(0,a.useState)(!1),[et,es]=(0,a.useState)("petition"),[er,ea]=(0,a.useState)(0),ei=y&&("admin"===y.role||"moderator"===y.role);(0,a.useEffect)(()=>{(async()=>{if(w?.creatorId&&!Q&&!K){ee(!0);try{let e=await (0,g.GA)(w.creatorId);J(e)}catch(e){console.error("Error fetching creator:",e)}finally{ee(!1)}}})()},[w?.creatorId,Q,K]),(0,a.useEffect)(()=>{(async()=>{if(w?.id)try{let{collection:e,query:t,where:r,getCountFromServer:a}=await Promise.resolve().then(s.bind(s,87097)),{db:i}=await Promise.resolve().then(s.bind(s,81012)),l=e(i,"comments"),n=t(l,r("petitionId","==",w.id)),o=await a(n);ea(o.data().count)}catch(e){console.error("Error fetching comments count:",e)}})()},[w?.id]),(0,a.useEffect)(()=>{if(!w)return;let e=l.get("notif"),t=l.get("reason");if(console.log("\uD83D\uDD0D Checking for notification parameters:",{notifType:e,notifReason:t,hasSearchParams:!!l,allParams:Object.fromEntries(l.entries())}),e){console.log("✅ Found notification type:",e);let s=null;switch(e){case"approved":s={type:"approved",title:"Petition Approved!",message:"Your petition has been approved by our moderation team and is now live on the platform.",reason:t||void 0,timestamp:new Date};break;case"rejected":s={type:"rejected",title:"Petition Rejected",message:"Your petition has been rejected by our moderation team.",reason:t||void 0,timestamp:new Date};break;case"paused":s={type:"paused",title:"Petition Paused",message:"Your petition has been temporarily paused by our moderation team.",reason:t||void 0,timestamp:new Date};break;case"deleted":s={type:"deleted",title:"Petition Deleted",message:"Your petition has been removed from the platform.",reason:t||void 0,timestamp:new Date};break;case"archived":s={type:"archived",title:"Petition Archived",message:"Your petition has been archived.",reason:t||void 0,timestamp:new Date};break;case"deletion_approved":s={type:"deletion_approved",title:"Deletion Request Approved",message:"Your deletion request has been approved. The petition has been removed.",reason:t||void 0,timestamp:new Date};break;case"deletion_denied":s={type:"deletion_denied",title:"Deletion Request Denied",message:"Your deletion request has been denied by our moderation team.",reason:t||void 0,timestamp:new Date}}if(s){console.log("✅ Setting notification alert:",s),G(s);let e=window.location.pathname;window.history.replaceState({},"",e)}else console.log("❌ No alert data created for notification type:",e)}else console.log("ℹ️ No notification type found in URL")},[w,l]);let el=async e=>{if(w&&f)try{if(W(!0),console.log("\uD83D\uDCF1 Phone verified, updating user profile...",{userId:f.uid,phoneNumber:e,currentVerifiedStatus:y?.verifiedPhone}),y&&!y.verifiedPhone){let{doc:t,updateDoc:r}=await Promise.resolve().then(s.bind(s,87097)),{db:a}=await Promise.resolve().then(s.bind(s,81012));console.log("\uD83D\uDD04 Updating Firestore document..."),await r(t(a,"users",f.uid),{phone:e,verifiedPhone:!0,updatedAt:new Date}),console.log("✅ User profile updated successfully")}else console.log("ℹ️ Skipping update - already verified or no profile");await (0,g.Qq)(w.id,{name:y?.name||f.displayName||"Anonymous",phone:e,location:{country:"Morocco"},comment:""}),$(!1),alert("شكرًا لتوقيعك على هذه العريضة!")}catch(e){console.error("Error signing petition:",e),alert(e.message||"فشل التوقيع على العريضة. يرجى المحاولة مرة أخرى.")}finally{W(!1)}},en=()=>{_(!0)},eo=async e=>{if((0,U.fc)(y)&&w&&y){O(!0);try{await (0,g.Sp)(w.id,e,y.id);try{await (0,T.t8)(w.id,w.creatorId,w.title,e)}catch(e){console.warn("Failed to send notification, but status updated:",e)}alert(`Petition ${e} successfully!`),window.location.reload()}catch(e){console.error("Error updating petition:",e),alert("Error updating petition status"),O(!1)}}},ec=async()=>{(0,U.fc)(y)&&confirm("Are you sure you want to archive this petition?")&&await eo("archived")},ed=async()=>{(0,U.fc)(y)&&confirm("Are you sure you want to delete this petition? This action cannot be undone.")&&await eo("deleted")},em=async()=>{if(f&&w)try{await (0,g.Ee)(w.id,f.uid),alert("Petition deleted successfully"),t.push("/dashboard")}catch(e){console.error("Error deleting petition:",e),alert(e.message||"Failed to delete petition")}},ex=async()=>{if(f&&w)try{await (0,g.Ue)(w.id,f.uid),alert("Petition archived successfully"),t.push("/dashboard")}catch(e){console.error("Error archiving petition:",e),alert(e.message||"Failed to archive petition")}},eh=async e=>{if(f&&w)try{await (0,g.at)(w.id,f.uid,e);try{let{notifyAdminsOfDeletionRequest:t}=await Promise.resolve().then(s.bind(s,3913));await t(w.id,w.title,f.uid,e,w.currentSignatures)}catch(e){console.error("Error sending notification to admins:",e)}}catch(e){throw console.error("Error requesting deletion:",e),e}};if(C)return(0,r.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[r.jsx(d.default,{}),r.jsx("div",{className:"flex items-center justify-center min-h-[calc(100vh-4rem)]",children:r.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-green-600"})})]});if(A||!w)return(0,r.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[r.jsx(d.default,{}),r.jsx("div",{className:"max-w-2xl mx-auto px-4 py-12",children:r.jsx(p.Zb,{children:(0,r.jsxs)(p.aY,{className:"py-12 text-center",children:[r.jsx("div",{className:"w-16 h-16 mx-auto mb-4 bg-red-100 rounded-full flex items-center justify-center",children:r.jsx("svg",{className:"w-8 h-8 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),r.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Petition Not Found"}),r.jsx("p",{className:"text-gray-600 mb-6",children:A||"The petition you are looking for does not exist."}),r.jsx(u.z,{asChild:!0,children:r.jsx(c(),{href:"/petitions",children:"Browse Petitions"})})]})})})]});let eu=(0,M.SB)(w.currentSignatures,w.targetSignatures),ep=(0,M.kC)(w.status),eg=(0,M.AN)(w.status);return(0,r.jsxs)("div",{className:"min-h-screen bg-gray-50 flex flex-col",children:[r.jsx(d.default,{}),P&&r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:r.jsx("div",{className:"bg-white rounded-lg max-w-md w-full",children:r.jsx(x.Z,{onVerified:el,onCancel:()=>$(!1)})})}),H&&r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,r.jsxs)("div",{className:"bg-white rounded-lg max-w-md w-full p-6",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[r.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Share QR Code"}),r.jsx("button",{onClick:()=>I(!1),className:"text-gray-400 hover:text-gray-600 p-1",children:r.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),r.jsx(h.Z,{petition:w,size:250,branded:!0,downloadable:!0,shareable:!0})]})}),R&&r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:r.jsx(j,{petition:w,onClose:()=>_(!1)})}),(0,r.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[r.jsx("div",{className:"mb-6",children:(0,r.jsxs)("nav",{className:"flex items-center space-x-2 text-sm text-gray-500",children:[r.jsx(c(),{href:"/",className:"hover:text-gray-700",children:"Home"}),r.jsx("span",{children:"/"}),r.jsx(c(),{href:"/petitions",className:"hover:text-gray-700",children:"Petitions"}),r.jsx("span",{children:"/"}),r.jsx("span",{className:"text-gray-900",children:w.title})]})}),(0,r.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-[1fr_340px] gap-8",children:[(0,r.jsxs)("div",{className:"w-full min-w-0 space-y-6",children:[X&&r.jsx(F,{data:X,onClose:()=>G(null)}),r.jsx(p.Zb,{className:"w-full",style:{width:"100%",maxWidth:"100%"},children:(0,r.jsxs)(p.aY,{className:"p-6",style:{width:"100%"},children:[r.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-3",children:w.title}),(0,r.jsxs)("div",{className:"flex items-center gap-3 mb-6 w-full",children:[r.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-${ep}-100 text-${ep}-800`,children:eg}),r.jsx("span",{className:"text-sm text-gray-500",children:w.category}),r.jsx("span",{className:"text-sm text-gray-500",children:"•"}),(0,r.jsxs)("span",{className:"text-sm text-gray-600",children:["By"," ",r.jsx("span",{className:"font-medium",children:K?"Loading...":Q?.name||"Unknown User"})]}),r.jsx("span",{className:"text-sm text-gray-500",children:"•"}),r.jsx("span",{className:"text-sm text-gray-500",children:w.createdAt.toLocaleDateString()})]}),r.jsx("div",{className:"mb-4 bg-gray-50 border border-gray-300 rounded-md p-3",children:(0,r.jsxs)("div",{className:"space-y-1.5",children:[(0,r.jsxs)("div",{className:"flex items-start",children:[r.jsx("span",{className:"text-sm font-normal text-gray-600 min-w-[90px]",children:"Publisher:"}),r.jsx("span",{className:"text-sm text-gray-900 font-medium",children:w.publisherName||(K?"Loading...":Q?.name||"Unknown User")})]}),(w.addressedToSpecific||w.addressedToType)&&(0,r.jsxs)("div",{className:"flex items-start",children:[r.jsx("span",{className:"text-sm font-normal text-gray-600 min-w-[90px]",children:"Target:"}),r.jsx("span",{className:"text-sm text-gray-900 font-medium",children:w.addressedToSpecific||w.addressedToType})]}),(0,r.jsxs)("div",{className:"flex items-start",children:[r.jsx("span",{className:"text-sm font-normal text-gray-600 min-w-[90px]",children:"Subject:"}),r.jsx("span",{className:"text-sm text-gray-900 font-medium",children:w.title})]})]})}),w.mediaUrls&&w.mediaUrls.length>0&&r.jsx("div",{className:"mb-6 space-y-4",children:w.mediaUrls.map((e,t)=>e.includes(".mp4")||e.includes(".webm")||e.includes(".ogg")||e.includes("video")?(0,r.jsxs)("video",{controls:!0,className:"w-full rounded-lg",children:[r.jsx("source",{src:e,type:"video/mp4"}),"Your browser does not support the video tag."]},t):r.jsx("div",{className:"relative w-full h-80 bg-gray-100 rounded-lg overflow-hidden",children:r.jsx(n(),{src:e,alt:w.title,fill:!0,className:"object-cover",sizes:"(max-width: 768px) 100vw, (max-width: 1200px) 66vw, 50vw"})},t))}),"rejected"===w.status&&r.jsx("div",{className:"mb-6 bg-red-50 border-l-4 border-red-500 p-4 rounded-r-lg",children:(0,r.jsxs)("div",{className:"flex items-start",children:[r.jsx("div",{className:"flex-shrink-0",children:r.jsx(B.Z,{className:"h-5 w-5 text-red-500"})}),(0,r.jsxs)("div",{className:"ml-3 flex-1",children:[r.jsx("h3",{className:"text-sm font-medium text-red-800",children:"Petition Rejected"}),r.jsx("p",{className:"mt-1 text-sm text-red-700",children:"This petition has been rejected by our moderation team and cannot accept signatures."}),(w.moderationNotes||w.resubmissionHistory&&w.resubmissionHistory.length>0)&&(0,r.jsxs)("div",{className:"mt-2 p-2 bg-red-100 rounded",children:[r.jsx("p",{className:"text-sm font-medium text-red-800",children:"Reason:"}),r.jsx("p",{className:"text-sm text-red-700",children:w.moderationNotes||(w.resubmissionHistory&&w.resubmissionHistory.length>0?w.resubmissionHistory[w.resubmissionHistory.length-1].reason:"No reason provided")})]}),f&&w.creatorId===f.uid&&3>(w.resubmissionCount||0)&&r.jsx("div",{className:"mt-3",children:(0,r.jsxs)(u.z,{size:"sm",onClick:()=>t.push(`/petitions/${w.id}/edit`),className:"bg-blue-600 hover:bg-blue-700",children:["Edit & Resubmit (",3-(w.resubmissionCount||0)," attempts left)"]})}),f&&w.creatorId===f.uid&&(w.resubmissionCount||0)>=3&&r.jsx("div",{className:"mt-3",children:r.jsx("p",{className:"text-sm text-red-600 font-medium",children:"Maximum resubmission attempts reached (3/3)"})})]})]})}),"paused"===w.status&&r.jsx("div",{className:"mb-6 bg-orange-50 border-l-4 border-orange-500 p-4 rounded-r-lg",children:(0,r.jsxs)("div",{className:"flex items-start",children:[r.jsx("div",{className:"flex-shrink-0",children:r.jsx(E.Z,{className:"h-5 w-5 text-orange-500"})}),(0,r.jsxs)("div",{className:"ml-3",children:[r.jsx("h3",{className:"text-sm font-medium text-orange-800",children:"Petition Temporarily Paused"}),r.jsx("p",{className:"mt-1 text-sm text-orange-700",children:"This petition is currently paused and cannot accept new signatures at this time. It may be under review or temporarily suspended by moderators."}),w.moderationNotes&&(0,r.jsxs)("div",{className:"mt-2 p-2 bg-orange-100 rounded",children:[r.jsx("p",{className:"text-sm font-medium text-orange-800",children:"Reason:"}),r.jsx("p",{className:"text-sm text-orange-700",children:w.moderationNotes})]})]})]})}),(0,r.jsxs)("div",{className:"mb-6 w-full",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[r.jsx("span",{className:"text-2xl font-bold text-gray-900",children:w.currentSignatures.toLocaleString()}),(0,r.jsxs)("span",{className:"text-sm text-gray-600",children:[eu.toFixed(1),"% of"," ",w.targetSignatures.toLocaleString()," goal"]})]}),r.jsx("div",{className:"w-full bg-gray-200 rounded-full h-4",children:r.jsx("div",{className:`h-4 rounded-full transition-all duration-300 ${eu<30?"bg-gray-500":eu<60?"bg-yellow-600":"bg-blue-600"}`,style:{width:`${Math.min(eu,100)}%`}})}),r.jsx("p",{className:"text-sm text-gray-600 mt-2",children:w.targetSignatures-w.currentSignatures>0?`${(w.targetSignatures-w.currentSignatures).toLocaleString()} more signatures needed`:"Goal reached! \uD83C\uDF89"})]}),(0,r.jsxs)("div",{className:"flex gap-3 mb-6 w-full",children:[r.jsx(u.z,{onClick:()=>{if(!f){t.push(`/auth/login?redirect=${encodeURIComponent(window.location.pathname)}`);return}$(!0)},disabled:"approved"!==w.status||V,className:"flex-1",children:V?(0,r.jsxs)(r.Fragment,{children:[r.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Signing..."]}):"Sign This Petition"}),(0,r.jsxs)(u.z,{variant:"outline",onClick:en,className:"flex items-center gap-2",children:[r.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.367 2.684 3 3 0 00-5.367-2.684z"})}),"Share"]}),(0,r.jsxs)(u.z,{variant:"outline",onClick:()=>I(!0),className:"flex items-center gap-2",children:[r.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v1m6 11h2m-6 0h-2v4m0-11v3m0 0h.01M12 12h4.01M16 20h4M4 12h4m12 0h.01M5 8h2a1 1 0 001-1V5a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1zm12 0h2a1 1 0 001-1V5a1 1 0 00-1-1h-2a1 1 0 00-1 1v2a1 1 0 001 1zM5 20h2a1 1 0 001-1v-2a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1z"})}),"QR Code"]})]}),r.jsx("div",{className:"border-b border-gray-200 mb-6",children:(0,r.jsxs)("nav",{className:"flex space-x-8",children:[r.jsx("button",{onClick:()=>es("petition"),className:`pb-4 px-1 border-b-2 font-medium text-sm transition-colors ${"petition"===et?"border-green-600 text-green-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:"Petition"}),r.jsx("button",{onClick:()=>es("comments"),className:`pb-4 px-1 border-b-2 font-medium text-sm transition-colors relative ${"comments"===et?"border-green-600 text-green-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:(0,r.jsxs)("span",{className:"flex items-center gap-2",children:["Comments",er>0&&r.jsx("span",{className:"inline-flex items-center justify-center min-w-[20px] h-5 px-1.5 text-xs font-bold text-white bg-red-500 rounded-full",children:er>99?"99+":er})]})}),r.jsx("button",{onClick:()=>es("signees"),className:`pb-4 px-1 border-b-2 font-medium text-sm transition-colors ${"signees"===et?"border-green-600 text-green-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:"Signees"}),r.jsx("button",{onClick:()=>es("publisher"),className:`pb-4 px-1 border-b-2 font-medium text-sm transition-colors ${"publisher"===et?"border-green-600 text-green-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:"Publisher"})]})}),(0,r.jsxs)("div",{className:"min-h-[400px] w-full",children:["petition"===et&&(0,r.jsxs)("div",{className:"space-y-6 w-full",children:[(0,r.jsxs)("div",{className:"w-full",children:[r.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-3",children:"About this petition"}),r.jsx("div",{className:"text-gray-700 whitespace-pre-wrap leading-relaxed",children:w.description})]}),w.youtubeVideoUrl&&r.jsx("div",{className:"relative w-full pb-[56.25%] rounded-lg overflow-hidden",children:r.jsx("iframe",{className:"absolute top-0 left-0 w-full h-full",src:w.youtubeVideoUrl.includes("embed")?w.youtubeVideoUrl:`https://www.youtube.com/embed/${w.youtubeVideoUrl.split("v=")[1]?.split("&")[0]||w.youtubeVideoUrl.split("/").pop()}`,title:"YouTube video",frameBorder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0})}),w.tags&&"string"==typeof w.tags&&w.tags.trim()&&r.jsx("div",{className:"flex flex-wrap gap-2",children:w.tags.split(",").map(e=>e.trim()).filter(e=>e.length>0).map((e,t)=>(0,r.jsxs)("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-gray-100 text-gray-700 hover:bg-gray-200 transition-colors",children:["#",e]},t))})]}),"publisher"===et&&(0,r.jsxs)("div",{className:"space-y-6 w-full",children:[(0,r.jsxs)("div",{className:"flex items-start justify-between",children:[(0,r.jsxs)("div",{className:"flex items-start space-x-4 flex-1",children:[Q?.photoURL?r.jsx("div",{className:"w-16 h-16 rounded-full overflow-hidden bg-gray-200 flex-shrink-0",children:r.jsx(n(),{src:Q.photoURL,alt:Q.name||"User",width:64,height:64,className:"object-cover"})}):r.jsx("div",{className:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center flex-shrink-0",children:r.jsx("span",{className:"text-green-600 font-bold text-2xl",children:Q?.name?.charAt(0).toUpperCase()||"U"})}),(0,r.jsxs)("div",{className:"flex-1",children:[r.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:Q?.name||"Unknown User"}),r.jsx("p",{className:"text-sm text-gray-600 mb-2",children:Q?.email}),r.jsx("div",{className:"text-sm text-gray-500",children:(0,r.jsxs)("p",{children:["Member since"," ",Q?.createdAt?"string"==typeof Q.createdAt?new Date(Q.createdAt).toLocaleDateString():Q.createdAt.toDate?Q.createdAt.toDate().toLocaleDateString():new Date(Q.createdAt).toLocaleDateString():"N/A"]})})]})]}),f&&w.creatorId===f.uid&&r.jsx(c(),{href:"/profile?tab=profile",children:(0,r.jsxs)(u.z,{variant:"outline",size:"sm",className:"flex items-center gap-2",children:[r.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})}),"Edit Bio"]})})]}),(0,r.jsxs)("div",{className:"border-t border-gray-200 pt-4",children:[r.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"About the Publisher"}),Q?.bio?r.jsx("p",{className:"text-gray-700 whitespace-pre-wrap",children:Q.bio}):r.jsx("p",{className:"text-gray-500 italic",children:f&&w.creatorId===f.uid?'You haven\'t added a bio yet. Click "Edit Bio" to add one.':`${Q?.name||"This user"} hasn't added a bio yet.`})]}),(w.publisherType||w.publisherName)&&(0,r.jsxs)("div",{className:"w-full bg-blue-50 border border-blue-200 rounded-lg p-4",children:[r.jsx("h3",{className:"text-base font-bold text-blue-700 mb-3",children:"Publisher Information"}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[w.publisherType&&(0,r.jsxs)("div",{children:[r.jsx("p",{className:"text-xs text-blue-700",children:"Type"}),r.jsx("p",{className:"text-sm font-medium text-blue-900",children:w.publisherType})]}),w.publisherName&&(0,r.jsxs)("div",{children:[r.jsx("p",{className:"text-xs text-blue-700",children:"Name"}),r.jsx("p",{className:"text-sm font-medium text-blue-900",children:w.publisherName})]})]})]}),(w.petitionType||w.addressedToType||w.addressedToSpecific||w.referenceCode)&&(0,r.jsxs)("div",{className:"w-full bg-purple-50 border border-purple-200 rounded-lg p-4",children:[r.jsx("h3",{className:"text-base font-bold text-purple-700 mb-3",children:"Petition Details"}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[w.petitionType&&(0,r.jsxs)("div",{children:[r.jsx("p",{className:"text-xs text-purple-700 mb-1",children:"Type"}),r.jsx("p",{className:"text-sm font-medium text-purple-900",children:w.petitionType})]}),w.addressedToType&&(0,r.jsxs)("div",{children:[r.jsx("p",{className:"text-xs text-purple-700 mb-1",children:"Addressed To"}),r.jsx("p",{className:"text-sm font-medium text-purple-900",children:w.addressedToType})]}),w.addressedToSpecific&&(0,r.jsxs)("div",{className:"col-span-1",children:[r.jsx("p",{className:"text-xs text-purple-700 mb-1",children:"Specific Target"}),r.jsx("p",{className:"text-sm font-medium text-purple-900",children:w.addressedToSpecific})]}),w.referenceCode&&(0,r.jsxs)("div",{className:w.addressedToSpecific?"":"col-start-2",children:[r.jsx("p",{className:"text-xs text-purple-700 mb-1",children:"Reference Code"}),r.jsx("p",{className:"text-lg font-bold text-purple-900 font-mono tracking-wider",children:w.referenceCode}),r.jsx("p",{className:"text-xs text-purple-600 mt-1",children:"Use this code for support inquiries"})]})]})]})]}),"comments"===et&&r.jsx("div",{className:"w-full",children:r.jsx(v,{petitionId:w.id,onCommentsCountChange:e=>ea(e)})}),"signees"===et&&r.jsx(z,{petitionId:w.id})]})]})}),r.jsx(D,{petitionId:w.id,isCreator:f?.uid===w.creatorId})]}),(0,r.jsxs)("div",{className:"w-full space-y-6",children:[(0,r.jsxs)(p.Zb,{children:[r.jsx(p.Ol,{children:r.jsx(p.ll,{children:"Petition Stats"})}),r.jsx(p.aY,{children:(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"flex justify-between",children:[r.jsx("span",{className:"text-gray-600",children:"Signatures"}),r.jsx("span",{className:"font-medium",children:w.currentSignatures.toLocaleString()})]}),(0,r.jsxs)("div",{className:"flex justify-between",children:[r.jsx("span",{className:"text-gray-600",children:"Goal"}),r.jsx("span",{className:"font-medium",children:w.targetSignatures.toLocaleString()})]}),(0,r.jsxs)("div",{className:"flex justify-between",children:[r.jsx("span",{className:"text-gray-600",children:"Progress"}),(0,r.jsxs)("span",{className:"font-medium",children:[eu.toFixed(1),"%"]})]}),(0,r.jsxs)("div",{className:"flex justify-between",children:[r.jsx("span",{className:"text-gray-600",children:"Views"}),r.jsx("span",{className:"font-medium",children:w.viewCount.toLocaleString()})]}),(0,r.jsxs)("div",{className:"flex justify-between",children:[r.jsx("span",{className:"text-gray-600",children:"Shares"}),r.jsx("span",{className:"font-medium",children:w.shareCount.toLocaleString()})]})]})})]}),f&&w.creatorId===f.uid&&"deleted"!==w.status&&r.jsx(S,{petition:w,onDelete:em,onArchive:ex,onRequestDeletion:eh}),ei&&w.resubmissionHistory&&w.resubmissionHistory.length>0&&(0,r.jsxs)(p.Zb,{children:[r.jsx(p.Ol,{children:r.jsx(p.ll,{className:"text-orange-600",children:"Resubmission History"})}),r.jsx(p.aY,{children:(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsxs)("p",{className:"text-sm text-gray-600",children:["This petition has been resubmitted"," ",r.jsx("strong",{children:w.resubmissionCount||0})," ","time(s)."]}),w.resubmissionHistory.map((e,t)=>(0,r.jsxs)("div",{className:"border-l-2 border-orange-300 pl-3 py-2",children:[(0,r.jsxs)("p",{className:"text-xs text-gray-500 mb-1",children:["Attempt ",t+1]}),(0,r.jsxs)("p",{className:"text-sm text-gray-700",children:[r.jsx("strong",{children:"Rejected:"})," ",new Date(e.rejectedAt).toLocaleDateString()]}),(0,r.jsxs)("p",{className:"text-sm text-gray-700",children:[r.jsx("strong",{children:"Reason:"})," ",e.reason]}),e.resubmittedAt&&(0,r.jsxs)("p",{className:"text-sm text-gray-700",children:[r.jsx("strong",{children:"Resubmitted:"})," ",new Date(e.resubmittedAt).toLocaleDateString()]})]},t))]})})]}),ei&&(0,r.jsxs)(p.Zb,{children:[r.jsx(p.Ol,{children:r.jsx(p.ll,{children:"Admin Actions"})}),r.jsx(p.aY,{children:(0,r.jsxs)("div",{className:"space-y-3",children:[("pending"===w.status||"rejected"===w.status)&&(0,r.jsxs)(u.z,{onClick:()=>eo("approved"),disabled:Y,className:"w-full bg-green-600 hover:bg-green-700",children:[r.jsx(q.Z,{className:"w-4 h-4 mr-2"}),"rejected"===w.status?"Approve (Reverse Rejection)":"Approve Petition"]}),("pending"===w.status||"approved"===w.status||"paused"===w.status)&&(0,r.jsxs)(u.z,{onClick:()=>eo("rejected"),disabled:Y,variant:"destructive",className:"w-full",children:[r.jsx(B.Z,{className:"w-4 h-4 mr-2"}),"Reject Petition"]}),"approved"===w.status&&(0,r.jsxs)(u.z,{onClick:()=>eo("paused"),disabled:Y,variant:"outline",className:"w-full",children:[r.jsx(E.Z,{className:"w-4 h-4 mr-2"}),"Pause Petition"]}),"paused"===w.status&&(0,r.jsxs)(u.z,{onClick:()=>eo("approved"),disabled:Y,className:"w-full bg-blue-600 hover:bg-blue-700",children:[r.jsx(Z,{className:"w-4 h-4 mr-2"}),"Resume Petition"]}),("approved"===w.status||"paused"===w.status||"rejected"===w.status)&&(0,r.jsxs)(u.z,{onClick:ec,disabled:Y,variant:"outline",className:"w-full border-blue-300 text-blue-600 hover:bg-blue-50",children:[r.jsx(k,{className:"w-4 h-4 mr-2"}),"Archive Petition"]}),"archived"===w.status&&(0,r.jsxs)(u.z,{onClick:()=>eo("approved"),disabled:Y,className:"w-full bg-blue-600 hover:bg-blue-700",children:[r.jsx(Z,{className:"w-4 h-4 mr-2"}),"Unarchive & Approve"]}),"deleted"!==w.status&&(0,r.jsxs)(u.z,{onClick:ed,disabled:Y,variant:"destructive",className:"w-full",children:[r.jsx(N.Z,{className:"w-4 h-4 mr-2"}),"Delete Petition"]})]})})]}),r.jsx("div",{onClick:()=>I(!0),className:"cursor-pointer hover:opacity-90 transition-opacity",children:r.jsx(h.Z,{petition:w,size:200,variant:"card",branded:!1,downloadable:!0,shareable:!1})}),(0,r.jsxs)(u.z,{onClick:en,className:"w-full bg-green-600 hover:bg-green-700 text-white",children:[r.jsx("svg",{className:"w-5 h-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.367 2.684 3 3 0 00-5.367-2.684z"})}),"Share This Petition"]})]})]})]}),r.jsx(m.Z,{})]})}},27007:(e,t,s)=>{"use strict";s.d(t,{Z:()=>o});var r=s(95344),a=s(3729),i=s(5094),l=s(81012),n=s(50815);function o({onVerified:e,onCancel:t}){let[s,o]=(0,a.useState)(""),[c,d]=(0,a.useState)(""),[m,x]=(0,a.useState)("phone"),[h,u]=(0,a.useState)(!1),[p,g]=(0,a.useState)(""),[j,b]=(0,a.useState)(null),f=(0,a.useRef)(null);(0,a.useEffect)(()=>((()=>{try{f.current||(f.current=new n.lI(l.auth,"recaptcha-container",{size:"invisible",callback:()=>{console.log("✅ reCAPTCHA solved")},"expired-callback":()=>{console.log("⚠️ reCAPTCHA expired"),g("انتهت صلاحية التحقق. يرجى المحاولة مرة أخرى")}}))}catch(e){console.error("Error initializing reCAPTCHA:",e)}})(),()=>{if(f.current){try{f.current.clear()}catch(e){console.error("Error clearing reCAPTCHA:",e)}f.current=null}}),[]);let y=async()=>{if(!s.trim()){g("الرجاء إدخال رقم هاتف صحيح");return}let e=s.replace(/\s/g,"");if(!/^\+?[1-9]\d{1,14}$/.test(e)){g("رقم الهاتف غير صحيح. يجب أن يبدأ بـ + ورمز الدولة");return}u(!0),g("");try{if(!f.current)throw Error("reCAPTCHA not initialized");console.log("\uD83D\uDCF1 Sending SMS to:",e);let t=await (0,n.$g)(l.auth,e,f.current);b(t),x("code"),console.log("✅ SMS sent successfully")}catch(e){if(console.error("❌ Error sending SMS:",e),"auth/invalid-phone-number"===e.code?g("رقم الهاتف غير صحيح"):"auth/too-many-requests"===e.code?g("تم تجاوز عدد المحاولات. يرجى المحاولة لاحقًا"):"auth/quota-exceeded"===e.code?g("تم تجاوز حد الرسائل اليومي"):"auth/invalid-app-credential"===e.code?g("خطأ في إعدادات التحقق. يرجى التواصل مع الدعم الفني"):g("فشل إرسال رمز التحقق. يرجى المحاولة مرة أخرى"),f.current)try{f.current.clear(),f.current=new n.lI(l.auth,"recaptcha-container",{size:"invisible"})}catch(e){console.error("Error resetting reCAPTCHA:",e)}}finally{u(!1)}},v=async()=>{if(!c.trim()){g("الرجاء إدخال رمز التحقق");return}if(!j){g("خطأ في التحقق. يرجى إعادة إرسال الرمز");return}u(!0),g("");try{console.log("\uD83D\uDD0D Verifying code:",c),await j.confirm(c),console.log("✅ Phone number verified successfully"),e(s)}catch(e){console.error("❌ Error verifying code:",e),"auth/invalid-verification-code"===e.code?g("رمز التحقق غير صحيح"):"auth/code-expired"===e.code?g("انتهت صلاحية الرمز. يرجى إعادة إرسال الرمز"):g("فشل التحقق من الرمز. يرجى المحاولة مرة أخرى")}finally{u(!1)}};return r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,r.jsxs)("div",{className:"bg-white rounded-lg p-6 max-w-md w-full mx-4",children:[r.jsx("h3",{className:"text-lg font-semibold mb-4",children:"التحقق من رقم الهاتف مطلوب"}),r.jsx("div",{id:"recaptcha-container"}),"phone"===m?(0,r.jsxs)("div",{className:"space-y-4",children:[r.jsx("p",{className:"text-gray-600",children:"الرجاء إدخال رقم هاتفك للتوقيع على هذه العريضة."}),(0,r.jsxs)("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"رقم الهاتف"}),r.jsx("input",{type:"tel",value:s,onChange:e=>o(e.target.value),placeholder:"+212 6XX XXX XXX",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500",dir:"ltr"}),r.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"مثال: +212612345678 أو +34613658220"})]}),p&&r.jsx("p",{className:"text-red-600 text-sm",children:p}),(0,r.jsxs)("div",{className:"flex gap-3",children:[r.jsx(i.z,{onClick:y,disabled:h,className:"flex-1",children:h?"جاري الإرسال...":"إرسال الرمز"}),r.jsx(i.z,{variant:"outline",onClick:t,disabled:h,children:"إلغاء"})]})]}):(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("p",{className:"text-gray-600",children:["أدخل الرمز المكون من 6 أرقام المرسل إلى ",s]}),(0,r.jsxs)("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"رمز التحقق"}),r.jsx("input",{type:"text",value:c,onChange:e=>{d(e.target.value.replace(/\D/g,""))},placeholder:"123456",maxLength:6,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500 text-center text-lg tracking-widest",dir:"ltr"})]}),p&&r.jsx("p",{className:"text-red-600 text-sm",children:p}),(0,r.jsxs)("div",{className:"flex gap-3",children:[r.jsx(i.z,{onClick:v,disabled:h,className:"flex-1",children:h?"جاري التحقق...":"تحقق"}),r.jsx(i.z,{variant:"outline",onClick:()=>{x("phone"),d(""),g(""),b(null)},disabled:h,children:"رجوع"})]}),r.jsx("button",{onClick:y,disabled:h,className:"w-full text-sm text-green-600 hover:text-green-700 underline",children:"إعادة إرسال الرمز"})]})]})})}},75590:(e,t,s)=>{"use strict";s.d(t,{Z:()=>l});var r=s(95344);s(3729);var a=s(20783),i=s.n(a);function l(){return r.jsx("footer",{className:"bg-gray-900 text-white py-12 mt-auto",children:(0,r.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-8",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"flex items-center space-x-2 mb-4",children:[r.jsx("div",{className:"w-8 h-8 bg-green-600 rounded-lg flex items-center justify-center",children:r.jsx("span",{className:"text-white font-bold text-lg",children:"3"})}),r.jsx("span",{className:"text-xl font-bold",children:"3arida"})]}),r.jsx("p",{className:"text-gray-400",children:"Empowering Moroccan citizens to create change through petitions."})]}),(0,r.jsxs)("div",{children:[r.jsx("h3",{className:"font-semibold mb-4",children:"Platform"}),(0,r.jsxs)("ul",{className:"space-y-2 text-gray-400",children:[r.jsx("li",{children:r.jsx(i(),{href:"/petitions",className:"hover:text-white",children:"Discover Petitions"})}),r.jsx("li",{children:r.jsx(i(),{href:"/petitions/create",className:"hover:text-white",children:"Start a Petition"})}),r.jsx("li",{children:r.jsx(i(),{href:"/about",className:"hover:text-white",children:"About Us"})})]})]}),(0,r.jsxs)("div",{children:[r.jsx("h3",{className:"font-semibold mb-4",children:"Support"}),(0,r.jsxs)("ul",{className:"space-y-2 text-gray-400",children:[r.jsx("li",{children:r.jsx(i(),{href:"/help",className:"hover:text-white",children:"Help Center"})}),r.jsx("li",{children:r.jsx(i(),{href:"/contact",className:"hover:text-white",children:"Contact Us"})}),r.jsx("li",{children:r.jsx(i(),{href:"/guidelines",className:"hover:text-white",children:"Community Guidelines"})})]})]}),(0,r.jsxs)("div",{children:[r.jsx("h3",{className:"font-semibold mb-4",children:"Legal"}),(0,r.jsxs)("ul",{className:"space-y-2 text-gray-400",children:[r.jsx("li",{children:r.jsx(i(),{href:"/privacy",className:"hover:text-white",children:"Privacy Policy"})}),r.jsx("li",{children:r.jsx(i(),{href:"/terms",className:"hover:text-white",children:"Terms of Service"})}),r.jsx("li",{children:r.jsx(i(),{href:"/cookies",className:"hover:text-white",children:"Cookie Policy"})})]})]})]}),r.jsx("div",{className:"border-t border-gray-800 mt-8 pt-8 text-center text-gray-400",children:r.jsx("p",{children:"\xa9 2024 3arida. All rights reserved. Made with ❤️ for Morocco."})})]})})}},16569:(e,t,s)=>{"use strict";s.r(t),s.d(t,{$$typeof:()=>i,__esModule:()=>a,default:()=>l});let r=(0,s(86843).createProxy)(String.raw`/Users/brahimamzil/Downloads/DEV_APPS/----3arida/3arida-app/src/app/petitions/[id]/page.tsx`),{__esModule:a,$$typeof:i}=r,l=r.default}};var t=require("../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[1638,322,4697,1476,5815,8415,4983,6180,8466],()=>s(18805));module.exports=r})();