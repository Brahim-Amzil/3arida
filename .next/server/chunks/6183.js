"use strict";exports.id=6183,exports.ids=[6183],exports.modules={26422:(e,t,r)=>{r.r(t),r.d(t,{default:()=>o});var a=r(8465);let o=r.n(a)()(async()=>{},{loadableGenerated:{modules:["/Users/brahimamzil/Downloads/DEV_APPS/----3arida/3arida-app/src/components/layout/HeaderWrapper.tsx -> ./Header"]},ssr:!1,loading:()=>null})},59924:(e,t,r)=>{r.d(t,{z:()=>d});var a=r(53854),o=r(34218),i=r(48225),n=r(82457),s=r(68504);let c=(0,n.j)("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),d=o.forwardRef(({className:e,variant:t,size:r,asChild:o=!1,...n},d)=>{let u=o?i.g7:"button";return a.jsx(u,{className:(0,s.cn)(c({variant:t,size:r,className:e})),ref:d,...n})});d.displayName="Button"},34922:(e,t,r)=>{r.d(t,{FA:()=>n,Lu:()=>i});var a=r(31489),o=r(1853);async function i(e){try{await (0,a.addDoc)((0,a.collection)(o.db,"auditLogs"),{...e,timestamp:(0,a.serverTimestamp)()})}catch(e){console.error("Failed to log audit action:",e)}}async function n(e){try{let t=(0,a.collection)(o.db,"auditLogs"),r=(0,a.query)(t,(0,a.orderBy)("timestamp","desc"));return e?.actorId&&(r=(0,a.query)(r,(0,a.where)("actorId","==",e.actorId))),e?.targetId&&(r=(0,a.query)(r,(0,a.where)("targetId","==",e.targetId))),e?.action&&(r=(0,a.query)(r,(0,a.where)("action","==",e.action))),e?.targetType&&(r=(0,a.query)(r,(0,a.where)("targetType","==",e.targetType))),r=e?.limitCount?(0,a.query)(r,(0,a.b9)(e.limitCount)):(0,a.query)(r,(0,a.b9)(100)),(await (0,a.getDocs)(r)).docs.map(e=>({id:e.id,...e.data(),timestamp:e.data().timestamp?.toDate?.()||new Date}))}catch(e){return console.error("Failed to fetch audit logs:",e),[]}}},98097:(e,t,r)=>{r.d(t,{V1:()=>s,notifyAdminsOfDeletionRequest:()=>c,notifyDeletionRequestApproved:()=>d,notifyDeletionRequestDenied:()=>u,t8:()=>n});var a=r(31489),o=r(1853);let i=async(e,t,r,i,n)=>{try{let s={userId:e,type:t,title:r,message:i,data:n||{},read:!1,createdAt:a.Timestamp.fromDate(new Date)};return(await (0,a.addDoc)((0,a.collection)(o.db,"notifications"),s)).id}catch(e){throw console.error("Error creating notification:",e),Error("Failed to create notification")}},n=async(e,t,r,a,o)=>{let n="",s="";switch(a){case"approved":n="\uD83C\uDF89 Petition Approved!",s=`Your petition "${r}" has been approved and is now live.`;break;case"paused":n="â¸ï¸ Petition Paused",s=`Your petition "${r}" has been paused by moderators.`;break;case"deleted":n="âŒ Petition Removed",s=`Your petition "${r}" has been removed.`;break;default:n="\uD83D\uDCDD Petition Status Updated",s=`Your petition "${r}" status has been updated to ${a}.`}o&&(s+=` Reason: ${o}`),await i(t,"petition_status_change",n,s,{petitionId:e,petitionTitle:r,newStatus:a,moderatorNotes:o})},s=async(e,t,r,a,o)=>{let n=`ðŸŽ¯ Milestone Reached!`,s=`Your petition "${r}" has reached ${o}% of its goal with ${a.toLocaleString()} signatures!`;await i(t,"signature_milestone",n,s,{petitionId:e,petitionTitle:r,currentSignatures:a,milestone:o})},c=async(e,t,r,n,s)=>{try{let c=(0,a.collection)(o.db,"users"),d=(0,a.query)(c,(0,a.where)("role","in",["admin","moderator"])),u=await (0,a.getDocs)(d),l=u.docs.map(a=>i(a.id,"petition_status_change","Deletion Request",`${r} requested deletion of "${t}" (${s} signatures). Reason: ${n}`,{petitionId:e,petitionTitle:t,creatorId:r,reason:n,signatureCount:s,actionType:"deletion_request"}));await Promise.all(l),console.log(`âœ… Notified ${u.size} admins of deletion request`)}catch(e){throw console.error("Error notifying admins of deletion request:",e),e}},d=async(e,t,r)=>{try{await i(r,"petition_status_change","Deletion Request Approved",`Your deletion request for "${t}" has been approved. The petition has been removed.`,{petitionId:e,petitionTitle:t,actionType:"deletion_approved"}),console.log("âœ… Notified creator of deletion approval")}catch(e){throw console.error("Error notifying creator of deletion approval:",e),e}},u=async(e,t,r,a)=>{try{await i(r,"petition_status_change","Deletion Request Denied",`Your deletion request for "${t}" has been denied. Reason: ${a}`,{petitionId:e,petitionTitle:t,reason:a,actionType:"deletion_denied"}),console.log("âœ… Notified creator of deletion denial")}catch(e){throw console.error("Error notifying creator of deletion denial:",e),e}}},27652:(e,t,r)=>{r.d(t,{AN:()=>d,DEFAULT_CATEGORIES:()=>o,QI:()=>i,S2:()=>a,SB:()=>n,kC:()=>c,ks:()=>p,xF:()=>u,xG:()=>s,yX:()=>l});let a={free:{name:"Free",maxSignatures:2500,price:0,features:["Up to 2,500 signatures","Basic petition page","Email sharing"]},basic:{name:"Basic",maxSignatures:5e3,price:49,features:["Up to 5,000 signatures","Enhanced petition page","Social media sharing","Basic analytics"]},premium:{name:"Premium",maxSignatures:1e4,price:79,features:["Up to 10,000 signatures","Premium petition page","Advanced sharing","Detailed analytics","Priority support"]},enterprise:{name:"Enterprise",maxSignatures:1e5,price:199,features:["Up to 100,000 signatures","Custom branding","API access","Advanced analytics","Dedicated support"]}},o=[{name:"Environment",description:"Environmental protection and sustainability",icon:"\uD83C\uDF31",color:"green",isActive:!0},{name:"Social Justice",description:"Human rights and social equality",icon:"âš–ï¸",color:"blue",isActive:!0},{name:"Politics",description:"Political reform and governance",icon:"\uD83C\uDFDBï¸",color:"purple",isActive:!0},{name:"Education",description:"Educational reform and access",icon:"\uD83D\uDCDA",color:"orange",isActive:!0},{name:"Healthcare",description:"Healthcare access and reform",icon:"\uD83C\uDFE5",color:"red",isActive:!0},{name:"Economy",description:"Economic policy and employment",icon:"\uD83D\uDCBC",color:"yellow",isActive:!0},{name:"Infrastructure",description:"Public infrastructure and transportation",icon:"\uD83D\uDEA7",color:"gray",isActive:!0},{name:"Culture",description:"Cultural preservation and arts",icon:"\uD83C\uDFAD",color:"pink",isActive:!0}],i=e=>{let t=[];return(!e.title||e.title.trim().length<10)&&t.push({field:"title",message:"Title must be at least 10 characters long"}),e.title&&e.title.length>200&&t.push({field:"title",message:"Title must not exceed 200 characters"}),(!e.description||e.description.trim().length<50)&&t.push({field:"description",message:"Description must be at least 50 characters long"}),e.description&&e.description.length>5e3&&t.push({field:"description",message:"Description must not exceed 5000 characters"}),e.category||t.push({field:"category",message:"Please select a category"}),(!e.targetSignatures||e.targetSignatures<100)&&t.push({field:"targetSignatures",message:"Target signatures must be at least 100"}),e.targetSignatures>1e5&&t.push({field:"targetSignatures",message:"Target signatures cannot exceed 100,000"}),t},n=(e,t)=>0===t?0:Math.min(e/t*100,100),s=e=>new Intl.NumberFormat("fr-MA",{style:"currency",currency:"MAD",minimumFractionDigits:0,maximumFractionDigits:0}).format(e),c=e=>{switch(e){case"draft":default:return"gray";case"pending":return"yellow";case"approved":return"green";case"paused":return"orange";case"deleted":return"red"}},d=e=>{switch(e){case"draft":return"Draft";case"pending":return"Pending Review";case"approved":return"Active";case"paused":return"Paused";case"deleted":return"Deleted";default:return"Unknown"}},u=e=>e<=a.free.maxSignatures?"free":e<=a.basic.maxSignatures?"basic":e<=a.premium.maxSignatures?"premium":"enterprise",l=e=>a[u(e)].price,p=e=>`/petitions/${e.id}`},24434:(e,t,r)=>{r.d(t,{Ue:()=>j,MY:()=>R,Ee:()=>z,CP:()=>H,Am:()=>$,I7:()=>N,O0:()=>L,GA:()=>Q,gt:()=>V,$l:()=>Y,at:()=>O,Qq:()=>F,Sp:()=>_});var a=r(31489),o=r(98097),i=r(1853);let n=async e=>{try{await (0,a.addDoc)((0,a.collection)(i.db,"signatureAttempts"),{...e,timestamp:a.Timestamp.fromDate(new Date)})}catch(e){console.error("Error tracking signature attempt:",e)}},s=async(e,t)=>{try{let r=(0,a.collection)(i.db,"signatures"),o=(0,a.query)(r,(0,a.where)("petitionId","==",e),(0,a.where)("signerPhone","==",t));return!(await (0,a.getDocs)(o)).empty}catch(e){return console.error("Error checking duplicate phone signature:",e),!1}},c=async(e,t,r=24,o=5)=>{try{let n=(0,a.collection)(i.db,"signatureAttempts"),s=new Date(Date.now()-36e5*r),c=(0,a.query)(n,(0,a.where)("petitionId","==",e),(0,a.where)("ipAddress","==",t),(0,a.where)("timestamp",">=",a.Timestamp.fromDate(s)),(0,a.where)("success","==",!0)),d=(await (0,a.getDocs)(c)).size;if(d>=o)return{allowed:!1,count:d,reason:`Too many signatures from this IP address. Maximum ${o} signatures per ${r} hours.`};return{allowed:!0,count:d}}catch(e){return console.error("Error checking IP signature limit:",e),{allowed:!0,count:0}}},d=async e=>{let t={ipAddress:e,riskScore:0,firstSeen:new Date,lastSeen:new Date,totalRequests:1,suspiciousActivity:[]};try{let r=(0,a.collection)(i.db,"ipTracking"),o=(0,a.query)(r,(0,a.where)("ipAddress","==",e)),n=await (0,a.getDocs)(o);if(!n.empty){let t=n.docs[0].data();return{ipAddress:e,country:t.country,city:t.city,isp:t.isp,isVPN:t.isVPN||!1,isProxy:t.isProxy||!1,riskScore:t.riskScore||0,firstSeen:t.firstSeen?.toDate()||new Date,lastSeen:new Date,totalRequests:(t.totalRequests||0)+1,suspiciousActivity:t.suspiciousActivity||[]}}let s=u(e);return{...t,riskScore:s,suspiciousActivity:s>50?["High risk IP range"]:[]}}catch(e){return console.error("Error analyzing IP address:",e),t}},u=e=>{let t=0;for(let r of[/^10\./,/^192\.168\./,/^172\.(1[6-9]|2[0-9]|3[0-1])\./,/^127\./,/^169\.254\./])if(r.test(e)){t+=30;break}for(let r of[/^185\./,/^46\./])if(r.test(e)){t+=20;break}return Math.min(t,100)},l=async(e,t,r,a)=>{if(await s(e,t))return{valid:!1,reason:"This phone number has already been used to sign this petition"};let o=await c(e,r);return o.allowed?(await d(r)).riskScore>80?{valid:!1,reason:"Signature blocked due to high-risk IP address"}:p(a)?{valid:!1,reason:"Signature blocked due to suspicious user agent"}:{valid:!0}:{valid:!1,reason:o.reason}},p=e=>[/bot/i,/crawler/i,/spider/i,/scraper/i,/curl/i,/wget/i,/python/i,/requests/i,/http/i].some(t=>t.test(e)),g=(e,t,a,o)=>{let i=r(6113),n=`${e}:${t}:${a}:${o.getTime()}`;return i.createHash("sha256").update(n).digest("hex")},m={};setInterval(()=>{let e=Date.now();Object.keys(m).forEach(t=>{m[t].resetTime<e&&delete m[t]})},6e4);let h=e=>{let{maxRequests:t,windowMs:r,message:a="Too many requests, please try again later."}=e;return e=>{let o=Date.now(),i=`rate_limit:${e}`,n=m[i];return((!n||n.resetTime<o)&&(n={count:0,resetTime:o+r},m[i]=n),n.count>=t)?{allowed:!1,remaining:0,resetTime:n.resetTime,message:a}:(n.count++,{allowed:!0,remaining:t-n.count,resetTime:n.resetTime})}};h({maxRequests:3,windowMs:36e5,message:"You can only create 3 petitions per hour. Please try again later."}),h({maxRequests:10,windowMs:36e5,message:"You can only sign 10 petitions per hour. Please try again later."}),h({maxRequests:20,windowMs:36e5,message:"You can only post 20 comments per hour. Please try again later."}),h({maxRequests:5,windowMs:9e5,message:"Too many authentication attempts. Please try again in 15 minutes."}),h({maxRequests:3,windowMs:36e5,message:"You can only request 3 password resets per hour."}),h({maxRequests:5,windowMs:36e5,message:"You can only request 5 email verifications per hour."}),h({maxRequests:5,windowMs:36e5,message:"You can only request 5 phone verifications per hour."}),h({maxRequests:100,windowMs:9e5,message:"Too many API requests. Please try again later."});let y=e=>{for(let t of[{pattern:/https?:\/\/[^\s]+/gi,threshold:3,reason:"Too many URLs"},{pattern:/\b\d{10,}\b/g,threshold:2,reason:"Suspicious phone numbers"},{pattern:/(.)\1{10,}/g,threshold:1,reason:"Repeated characters"},{pattern:/[A-Z]{20,}/g,threshold:1,reason:"Excessive caps"},{pattern:/\b(buy|sell|cheap|free|money|cash|prize|winner|congratulations)\b/gi,threshold:5,reason:"Spam keywords"}]){let r=e.match(t.pattern);if(r&&r.length>=t.threshold)return{isSpam:!0,reason:t.reason}}return{isSpam:!1}},f=["spam","scam","fake","fraud","cheat","lie","liar","arnaque","faux","mensonge","menteur","trompeur","ÙƒØ°Ø¨","Ø®Ø¯Ø§Ø¹","Ø§Ø­ØªÙŠØ§Ù„","Ù†ØµØ¨","click here","free money","get rich","make money fast","buy now","limited time","act now","urgent"],w=[/https?:\/\/[^\s]+/gi,/\b\d{10,}\b/g,/(.)\1{5,}/g,/[A-Z]{10,}/g,/\b(buy|sell|cheap|free|money|cash|prize|winner|congratulations)\b/gi,/\b(viagra|cialis|pharmacy|pills|medication)\b/gi,/\b(casino|gambling|poker|lottery|jackpot)\b/gi],D=[],b=(e,t={})=>{let{checkProfanity:r=!0,checkSpam:a=!0,checkHateSpeech:o=!0,strictMode:i=!1,language:n="auto"}=t,s=[],c=1,d=e.toLowerCase().trim();if(r){let e=A(d);e.found&&(s.push(`Contains inappropriate language: ${e.words.join(", ")}`),c-=.3)}if(a){let t=y(e);t.isSpam&&(s.push(`Detected as spam: ${t.reason}`),c-=.4);let r=v(e);r.found&&(s.push(`Contains suspicious patterns: ${r.patterns.join(", ")}`),c-=.2)}o&&T(d).found&&(s.push("Contains hate speech or offensive content"),c-=.5),i&&((e.match(/[A-Z]/g)||[]).length/e.length>.5&&e.length>20&&(s.push("Excessive use of capital letters"),c-=.1),(e.match(/[!?.,;:]/g)||[]).length/e.length>.2&&(s.push("Excessive punctuation"),c-=.1));let u=c>=(i?.8:.6);return{approved:u,confidence:Math.max(0,c),reasons:s,suggestions:u?void 0:P(s)}},A=e=>{let t=[];for(let r of f)e.includes(r.toLowerCase())&&t.push(r);return{found:t.length>0,words:t}},v=e=>{let t=[];for(let r of w)r.test(e)&&t.push(r.source);return{found:t.length>0,patterns:t}},T=e=>{let t=[];for(let r of D)r.test(e)&&t.push(r.source);return{found:t.length>0,patterns:t}},P=e=>{let t=[];return e.some(e=>e.includes("inappropriate language"))&&t.push("Please remove inappropriate language and use respectful terms"),e.some(e=>e.includes("spam"))&&t.push("Please remove promotional content, URLs, and phone numbers"),e.some(e=>e.includes("hate speech"))&&t.push("Please ensure your content is respectful and does not target any group"),e.some(e=>e.includes("capital letters"))&&t.push("Please use normal capitalization instead of ALL CAPS"),e.some(e=>e.includes("punctuation"))&&t.push("Please reduce excessive punctuation marks"),t},S=e=>b(e,{strictMode:!1,checkProfanity:!0,checkSpam:!0,checkHateSpeech:!0});var C=r(34922);r(62745);var E=r(27652);let q="petitions",x="signatures";async function I(e){try{let t=(0,a.query)((0,a.collection)(i.db,q),(0,a.where)("referenceCode","==",e),(0,a.b9)(1));return(await (0,a.getDocs)(t)).empty}catch(e){return console.error("Error checking reference code uniqueness:",e),!1}}async function U(){let e=0;for(;e<10;){let t=function(){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZ",t="0123456789",r="";r+=e.charAt(Math.floor(Math.random()*e.length))+e.charAt(Math.floor(Math.random()*e.length));for(let e=0;e<4;e++)r+=t.charAt(Math.floor(Math.random()*t.length));return r}();if(await I(t))return t;e++}let t=Date.now().toString().slice(-4);return`ZZ${t}`}let k="categories",R=async(e,t,r)=>{let o=(0,E.QI)(e);if(o.length>0)throw Error(`Validation failed: ${o.map(e=>e.message).join(", ")}`);try{let o=new Date,n=(0,E.xF)(e.targetSignatures),s=(0,E.yX)(e.targetSignatures),c=await U(),d={title:e.title.trim(),description:e.description.trim(),category:e.category,subcategory:e.subcategory,targetSignatures:e.targetSignatures,currentSignatures:0,status:s>0?"draft":"pending",creatorId:t,creatorName:r,mediaUrls:e.mediaUrls||[],qrCodeUrl:"",hasQrCode:!1,pricingTier:n,amountPaid:0,paymentStatus:s>0?"unpaid":"paid",publisherType:e.publisherType,publisherName:e.publisherName,petitionType:e.petitionType,addressedToType:e.addressedToType,addressedToSpecific:e.addressedToSpecific,referenceCode:c,youtubeVideoUrl:e.youtubeVideoUrl,tags:e.tags,location:e.location,createdAt:o,updatedAt:o,viewCount:0,shareCount:0,isPublic:!0,isActive:!0},u=await (0,a.addDoc)((0,a.collection)(i.db,q),{...d,createdAt:a.Timestamp.fromDate(d.createdAt),updatedAt:a.Timestamp.fromDate(d.updatedAt)}),l={...d,id:u.id};console.log("âœ… Petition created successfully with ID:",u.id),console.log("\uD83D\uDCC4 Created petition data:",l);try{let e=await (0,a.getDoc)(u);e.exists()?(console.log("âœ… Verification: Document exists in Firestore"),console.log("\uD83D\uDCC4 Verification data:",e.data())):console.log("âŒ Verification: Document does not exist immediately after creation")}catch(e){console.log("âŒ Verification error:",e)}return l}catch(e){throw console.error("Error creating petition:",e),Error("Failed to create petition. Please try again.")}},N=async e=>$(e),$=async(e,t=0)=>{try{console.log("\uD83D\uDD0D Getting petition with ID/Slug:",e,t>0?`(retry ${t})`:"");let r=(0,a.doc)(i.db,q,e),o=await (0,a.getDoc)(r);if(o.exists())console.log("âœ… Petition found by direct ID lookup");else{console.log("\uD83D\uDD0D Direct lookup failed, trying to find by ID suffix...");let r=e.split("-"),o=r[r.length-1];if(o&&o.length>=8){let e=(0,a.query)((0,a.collection)(i.db,q),(0,a.b9)(100)),t=await (0,a.getDocs)(e),r=null;if(t.forEach(e=>{e.id.endsWith(o)&&(r=e)}),r){console.log("âœ… Petition found by ID suffix:",r.id);let e=r.data();return{id:r.id,title:e.title,description:e.description,category:e.category,subcategory:e.subcategory,targetSignatures:e.targetSignatures,currentSignatures:e.currentSignatures||0,status:e.status,creatorId:e.creatorId,creatorPageId:e.creatorPageId,mediaUrls:e.mediaUrls||[],qrCodeUrl:e.qrCodeUrl,hasQrCode:e.hasQrCode||!1,pricingTier:e.pricingTier,amountPaid:e.amountPaid||0,paymentStatus:e.paymentStatus||"unpaid",location:e.location,createdAt:e.createdAt?.toDate()||new Date,updatedAt:e.updatedAt?.toDate()||new Date,viewCount:e.viewCount||0,shareCount:e.shareCount||0,isPublic:!1!==e.isPublic,isActive:!1!==e.isActive,publisherType:e.publisherType,publisherName:e.publisherName,petitionType:e.petitionType,addressedToType:e.addressedToType,addressedToSpecific:e.addressedToSpecific,referenceCode:e.referenceCode,youtubeVideoUrl:e.youtubeVideoUrl,tags:e.tags,moderatedBy:e.moderatedBy,moderationNotes:e.moderationNotes,resubmissionCount:e.resubmissionCount||0,resubmissionHistory:e.resubmissionHistory||[]}}}if(0===t)return console.log("âŒ Petition not found, retrying in 3 seconds..."),await new Promise(e=>setTimeout(e,3e3)),$(e,1);if(1===t)return console.log("âŒ Petition still not found, final retry in 5 seconds..."),await new Promise(e=>setTimeout(e,5e3)),$(e,2);return console.log("âŒ Petition not found in database after all retries"),null}console.log("âœ… Petition found, processing data...");let n=o.data(),s=n.referenceCode;if(!s){console.log("\uD83D\uDD04 Generating reference code for petition:",o.id);try{s=await U(),await (0,a.updateDoc)(r,{referenceCode:s,updatedAt:new Date}),console.log("âœ… Reference code generated and saved:",s)}catch(e){console.error("âŒ Failed to generate reference code:",e)}}let c={id:o.id,title:n.title,description:n.description,category:n.category,subcategory:n.subcategory,targetSignatures:n.targetSignatures,currentSignatures:n.currentSignatures||0,status:n.status,creatorId:n.creatorId,creatorPageId:n.creatorPageId,mediaUrls:n.mediaUrls||[],qrCodeUrl:n.qrCodeUrl,hasQrCode:n.hasQrCode||!1,pricingTier:n.pricingTier,amountPaid:n.amountPaid||0,paymentStatus:n.paymentStatus||"unpaid",location:n.location,createdAt:n.createdAt?.toDate?n.createdAt.toDate():n.createdAt||new Date,updatedAt:n.updatedAt?.toDate?n.updatedAt.toDate():n.updatedAt||new Date,approvedAt:n.approvedAt?.toDate?n.approvedAt.toDate():n.approvedAt,pausedAt:n.pausedAt?.toDate?n.pausedAt.toDate():n.pausedAt,deletedAt:n.deletedAt?.toDate?n.deletedAt.toDate():n.deletedAt,viewCount:n.viewCount||0,shareCount:n.shareCount||0,moderatedBy:n.moderatedBy,moderationNotes:n.moderationNotes,resubmissionCount:n.resubmissionCount||0,resubmissionHistory:n.resubmissionHistory||[],isPublic:!1!==n.isPublic,isActive:!1!==n.isActive,publisherType:n.publisherType,publisherName:n.publisherName,petitionType:n.petitionType,addressedToType:n.addressedToType,addressedToSpecific:n.addressedToSpecific,referenceCode:s,youtubeVideoUrl:n.youtubeVideoUrl,tags:n.tags};return console.log("âœ… Petition processed successfully:",c.id),c}catch(t){return console.error("âŒ Error getting petition:",t),console.error("âŒ Error details:",{petitionIdOrSlug:e,error:t instanceof Error?t.message:t}),null}},F=async(e,t,r,s="",c="")=>{let d=new Date;try{let u=await $(e);if(!u)throw await n({petitionId:e,ipAddress:s,userAgent:c,phoneNumber:t.phone,userId:r,success:!1,reason:"Petition not found"}),Error("Petition not found");if("approved"!==u.status)throw await n({petitionId:e,ipAddress:s,userAgent:c,phoneNumber:t.phone,userId:r,success:!1,reason:"Petition not approved"}),Error("This petition is not available for signing");if(u.currentSignatures>=u.targetSignatures)throw await n({petitionId:e,ipAddress:s,userAgent:c,phoneNumber:t.phone,userId:r,success:!1,reason:"Target reached"}),Error("This petition has reached its signature goal");let p=await l(e,t.phone,s,c);if(!p.valid)throw await n({petitionId:e,ipAddress:s,userAgent:c,phoneNumber:t.phone,userId:r,success:!1,reason:p.reason}),Error(p.reason||"Security validation failed");if(t.comment){let a=S(t.comment);if(!a.approved)throw await n({petitionId:e,ipAddress:s,userAgent:c,phoneNumber:t.phone,userId:r,success:!1,reason:`Comment moderation failed: ${a.reasons.join(", ")}`}),Error("Your comment contains inappropriate content. Please revise and try again.")}if(r&&await M(e,r))throw Error("You have already signed this petition");if(await B(e,t.phone))throw Error("This phone number has already been used to sign this petition");let m=g(t.phone,s,c,d),h={petitionId:e,signerName:t.isAnonymous?"Anonymous":t.name,signerPhone:t.phone,signerLocation:t.location,verificationMethod:"phone_otp",verifiedAt:d,ipAddress:s,userAgent:c,fingerprint:m,isAnonymous:t.isAnonymous||!1,comment:t.comment,createdAt:d};await (0,a.addDoc)((0,a.collection)(i.db,x),{...h,verifiedAt:a.Timestamp.fromDate(h.verifiedAt),createdAt:a.Timestamp.fromDate(h.createdAt)});let y=(0,a.doc)(i.db,q,e);await (0,a.updateDoc)(y,{currentSignatures:(0,a.nP)(1),updatedAt:a.Timestamp.fromDate(new Date)});let f=u.currentSignatures+1,w=f/u.targetSignatures*100;for(let t of[25,50,75,100]){let r=u.currentSignatures/u.targetSignatures*100;if(w>=t&&r<t){try{await (0,o.V1)(e,u.creatorId,u.title,f,t)}catch(e){console.error("Error sending milestone notification:",e)}break}}await n({petitionId:e,ipAddress:s,userAgent:c,phoneNumber:t.phone,userId:r,success:!0})}catch(o){console.error("Error signing petition:",o);let a=o instanceof Error?o.message:"Unknown error";throw a.includes("already been used")||a.includes("Too many signatures")||a.includes("inappropriate content")||await n({petitionId:e,ipAddress:s,userAgent:c,phoneNumber:t.phone,userId:r,success:!1,reason:a}),Error("Failed to sign petition. Please try again.")}},M=async(e,t)=>{try{let r=(0,a.query)((0,a.collection)(i.db,x),(0,a.where)("petitionId","==",e),(0,a.where)("userId","==",t),(0,a.b9)(1));return!(await (0,a.getDocs)(r)).empty}catch(e){return console.error("Error checking existing signature:",e),!1}},B=async(e,t)=>{try{let r=(0,a.query)((0,a.collection)(i.db,x),(0,a.where)("petitionId","==",e),(0,a.where)("signerPhone","==",t),(0,a.b9)(1));return!(await (0,a.getDocs)(r)).empty}catch(e){return console.error("Error checking phone signature:",e),!1}},L=async(e={},t={page:1,limit:12,total:0,hasMore:!1})=>{try{let r=(0,a.query)((0,a.collection)(i.db,q));r=e.status?(0,a.query)(r,(0,a.where)("status","==",e.status)):(0,a.query)(r,(0,a.where)("status","==","approved")),e.category&&(r=(0,a.query)(r,(0,a.where)("category","==",e.category)));let o="popular"===e.sortBy?"currentSignatures":"signatures"===e.sortBy?"currentSignatures":"createdAt",n=e.sortOrder||"desc";r=(0,a.query)(r,(0,a.orderBy)(o,n)),t.limit&&(r=(0,a.query)(r,(0,a.b9)(t.limit+1)));let s=await (0,a.getDocs)(r),c=[];s.docs.forEach((e,r)=>{if(t.limit&&r>=t.limit)return;let a=e.data();c.push({id:e.id,title:a.title,description:a.description,category:a.category,subcategory:a.subcategory,targetSignatures:a.targetSignatures,currentSignatures:a.currentSignatures||0,status:a.status,creatorId:a.creatorId,creatorPageId:a.creatorPageId,mediaUrls:a.mediaUrls||[],qrCodeUrl:a.qrCodeUrl,hasQrCode:a.hasQrCode||!1,pricingTier:a.pricingTier,amountPaid:a.amountPaid||0,paymentStatus:a.paymentStatus||"unpaid",location:a.location,createdAt:a.createdAt?.toDate()||new Date,updatedAt:a.updatedAt?.toDate()||new Date,approvedAt:a.approvedAt?.toDate(),pausedAt:a.pausedAt?.toDate(),deletedAt:a.deletedAt?.toDate(),viewCount:a.viewCount||0,shareCount:a.shareCount||0,moderatedBy:a.moderatedBy,moderationNotes:a.moderationNotes,isPublic:!1!==a.isPublic,isActive:!1!==a.isActive})});let d=c;if(e.search){let t=e.search.toLowerCase();d=c.filter(e=>e.title.toLowerCase().includes(t)||e.description.toLowerCase().includes(t))}e.location&&(d=d.filter(t=>t.location?.country===e.location||t.location?.city===e.location));let u={page:t.page||1,limit:t.limit||12,total:d.length,hasMore:d.length===t.limit};return{petitions:d,pagination:u}}catch(e){throw console.error("Error getting petitions:",e),Error("Failed to load petitions. Please try again.")}},V=async e=>{try{let t=(0,a.query)((0,a.collection)(i.db,q),(0,a.where)("creatorId","==",e),(0,a.orderBy)("createdAt","desc")),r=await (0,a.getDocs)(t),o=[];return r.forEach(e=>{let t=e.data();o.push({id:e.id,title:t.title,description:t.description,category:t.category,subcategory:t.subcategory,targetSignatures:t.targetSignatures,currentSignatures:t.currentSignatures||0,status:t.status,creatorId:t.creatorId,creatorPageId:t.creatorPageId,mediaUrls:t.mediaUrls||[],qrCodeUrl:t.qrCodeUrl,hasQrCode:t.hasQrCode||!1,pricingTier:t.pricingTier,amountPaid:t.amountPaid||0,paymentStatus:t.paymentStatus||"unpaid",location:t.location,createdAt:t.createdAt?.toDate()||new Date,updatedAt:t.updatedAt?.toDate()||new Date,approvedAt:t.approvedAt?.toDate(),pausedAt:t.pausedAt?.toDate(),deletedAt:t.deletedAt?.toDate(),viewCount:t.viewCount||0,shareCount:t.shareCount||0,moderatedBy:t.moderatedBy,moderationNotes:t.moderationNotes,isPublic:!1!==t.isPublic,isActive:!1!==t.isActive})}),o}catch(e){throw console.error("Error getting user petitions:",e),Error("Failed to load your petitions. Please try again.")}},_=async(e,t,r,o)=>{try{let n=(0,a.doc)(i.db,q,e),s=(await (0,a.getDoc)(n)).data(),c=s?.status,d={status:t,moderatedBy:r,updatedAt:a.Timestamp.fromDate(new Date)};o&&(d.moderationNotes=o),"approved"===t?d.approvedAt=a.Timestamp.fromDate(new Date):"paused"===t?d.pausedAt=a.Timestamp.fromDate(new Date):"deleted"===t&&(d.deletedAt=a.Timestamp.fromDate(new Date),d.isActive=!1),await (0,a.updateDoc)(n,d);let u=await Q(r),l={approved:"petition.approved",rejected:"petition.rejected",paused:"petition.paused",deleted:"petition.deleted",archived:"petition.archived"};l[t]&&(0,C.Lu)({actorId:r,actorName:u?.name||"Unknown",actorEmail:u?.email||"",actorRole:u?.role||"moderator",action:l[t],targetType:"petition",targetId:e,targetName:s?.title,details:{oldValue:c,newValue:t,reason:o}})}catch(e){throw console.error("Error updating petition status:",e),Error("Failed to update petition status. Please try again.")}},Y=async e=>{try{let t=(0,a.doc)(i.db,q,e);await (0,a.updateDoc)(t,{shareCount:(0,a.nP)(1),updatedAt:a.Timestamp.fromDate(new Date)})}catch(e){console.error("Error incrementing petition shares:",e)}},H=async()=>{try{let e=(0,a.collection)(i.db,k),t=await (0,a.getDocs)(e),r=[];if(t.forEach(e=>{let t=e.data();!1!==t.isActive&&r.push({id:e.id,name:t.name,description:t.description,icon:t.icon,color:t.color,isActive:!1!==t.isActive,petitionCount:t.petitionCount||0,createdAt:t.createdAt?.toDate()||new Date,updatedAt:t.updatedAt?.toDate()||new Date})}),0===r.length)return console.log("No categories found in database, using defaults"),E.DEFAULT_CATEGORIES.map((e,t)=>({id:`default-${t}`,...e,petitionCount:0,createdAt:new Date,updatedAt:new Date}));let o=(0,a.collection)(i.db,q),n=(0,a.query)(o,(0,a.where)("status","==","approved")),s=await (0,a.getDocs)(n),c={};return s.forEach(e=>{let t=e.data().category;t&&(c[t]=(c[t]||0)+1)}),r.forEach(e=>{e.petitionCount=c[e.name]||0}),r.sort((e,t)=>e.name.localeCompare(t.name)),r}catch(e){return console.error("Error getting categories:",e),E.DEFAULT_CATEGORIES.map((e,t)=>({id:`default-${t}`,...e,petitionCount:0,createdAt:new Date,updatedAt:new Date}))}};(async()=>{try{let e=(0,a.collection)(i.db,k);if((await (0,a.getDocs)(e)).empty){let t=new Date,r=E.DEFAULT_CATEGORIES.map(r=>(0,a.addDoc)(e,{...r,petitionCount:0,createdAt:a.Timestamp.fromDate(t),updatedAt:a.Timestamp.fromDate(t)}));await Promise.all(r),console.log("Default categories initialized")}}catch(e){console.error("Error initializing categories:",e)}})();let Q=async e=>{try{let t=(0,a.doc)(i.db,"users",e),r=await (0,a.getDoc)(t);if(!r.exists())return null;let o=r.data();return{id:r.id,email:o.email||"",name:o.name||"",role:o.role||"user",phone:o.phone||"",verifiedEmail:o.emailVerified||!1,verifiedPhone:o.phoneVerified||!1,createdAt:o.createdAt?.toDate()||new Date,updatedAt:o.updatedAt?.toDate()||new Date,isActive:!1!==o.isActive,...o.bio&&{bio:o.bio},...o.photoURL&&{photoURL:o.photoURL}}}catch(e){return console.error("Error getting user:",e),null}},z=async(e,t)=>{try{let r=(0,a.doc)(i.db,q,e),o=await (0,a.getDoc)(r);if(!o.exists())throw Error("Petition not found");if(o.data().creatorId!==t)throw Error("Only the petition creator can delete this petition");await (0,a.updateDoc)(r,{status:"deleted",deletedAt:new Date,updatedAt:new Date})}catch(e){throw console.error("Error deleting petition:",e),e}},j=async(e,t)=>{try{let r=(0,a.doc)(i.db,q,e),o=await (0,a.getDoc)(r);if(!o.exists())throw Error("Petition not found");if(o.data().creatorId!==t)throw Error("Only the petition creator can archive this petition");await (0,a.updateDoc)(r,{status:"archived",archivedAt:new Date,updatedAt:new Date})}catch(e){throw console.error("Error archiving petition:",e),e}},O=async(e,t,r)=>{try{let o=(0,a.collection)(i.db,"deletion_requests");await (0,a.addDoc)(o,{petitionId:e,requestedBy:t,reason:r,status:"pending",createdAt:new Date})}catch(e){throw console.error("Error requesting petition deletion:",e),e}}},68504:(e,t,r)=>{r.d(t,{cn:()=>i});var a=r(29395),o=r(1088);function i(...e){return(0,o.m6)((0,a.W)(e))}}};