"use strict";exports.id=6662,exports.ids=[6662],exports.modules={56654:(e,t,r)=>{r.d(t,{Z:()=>d});var o=r(95344),i=r(3729),a=r(41223),s=r.n(a),n=r(16434),l=r(16471);function d({petition:e,size:t=256,variant:r="default",branded:a=!1,downloadable:d=!0,shareable:c=!0,className:h="",onShare:m,onDownload:x}){let[u,g]=(0,i.useState)(""),[w,f]=(0,i.useState)(!0),[p,j]=(0,i.useState)(""),[b,y]=(0,i.useState)(!1);(0,i.useEffect)(()=>{(async()=>{try{if(f(!0),j(""),e.qrCodeUrl&&!a)g(e.qrCodeUrl);else{let r=await (0,n.w1)(e.id,{size:t,branded:a,includeAnalytics:!0});g(r)}}catch(e){console.error("Error generating QR code:",e),j("Failed to generate QR code")}finally{f(!1)}})()},[e.id,e.qrCodeUrl,t,a]);let v=async()=>{if(u)try{await (0,n.bw)(e.id,e.title,"png",{size:512,branded:a}),await (0,l.$l)(e.id),x&&x()}catch(e){console.error("Error downloading QR code:",e)}},k=async()=>{if(u)try{if(navigator.share){let t=await fetch(u),r=await t.blob(),o=new File([r],`${e.title}_qr_code.png`,{type:"image/png"});await navigator.share({title:`${e.title} - QR Code`,text:`Scan this QR code to support: ${e.title}`,files:[o]})}else{let t=`${window.location.origin}/petitions/${e.id}`;await navigator.clipboard.writeText(t),alert("Petition link copied to clipboard!")}await (0,l.$l)(e.id),m&&m()}catch(e){console.error("Error sharing QR code:",e)}},N=()=>{"default"===r&&y(!0)},C=()=>{y(!1)};return"default"===r?(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)("div",{className:`text-center ${h}`,children:[w?o.jsx("div",{className:"flex items-center justify-center bg-gray-100 rounded-lg",style:{width:t,height:t},children:o.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-green-600"})}):p?o.jsx("div",{className:"flex items-center justify-center bg-red-50 border border-red-200 rounded-lg text-red-600 text-sm",style:{width:t,height:t},children:p}):o.jsx("div",{className:"inline-block cursor-pointer",onClick:N,children:o.jsx(s(),{src:u,alt:`QR Code for ${e.title}`,width:t,height:t,className:"rounded-lg shadow-md hover:shadow-lg transition-shadow"})}),!w&&!p&&(d||c)&&(0,o.jsxs)("div",{className:"flex gap-2 justify-center mt-3",children:[d&&(0,o.jsxs)("button",{onClick:v,className:"px-4 py-2 text-sm bg-gray-800 hover:bg-gray-900 text-white rounded-md transition-colors flex items-center gap-2 font-medium",children:[o.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),"Download"]}),c&&(0,o.jsxs)("button",{onClick:k,className:"px-4 py-2 text-sm bg-green-600 hover:bg-green-700 text-white rounded-md transition-colors flex items-center gap-2 font-medium",children:[o.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.367 2.684 3 3 0 00-5.367-2.684z"})}),"Share"]})]})]}),b&&o.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",onClick:C,children:(0,o.jsxs)("div",{className:"bg-white rounded-lg max-w-md w-full p-6",onClick:e=>e.stopPropagation(),children:[(0,o.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[o.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Petition QR Code"}),o.jsx("button",{onClick:C,className:"text-gray-400 hover:text-gray-600 p-1",children:o.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,o.jsxs)("div",{className:"text-center",children:[w?o.jsx("div",{className:"flex items-center justify-center bg-gray-100 rounded-lg mx-auto",style:{width:300,height:300},children:o.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-green-600"})}):p?o.jsx("div",{className:"flex items-center justify-center bg-red-50 border border-red-200 rounded-lg text-red-600 text-sm mx-auto",style:{width:300,height:300},children:p}):o.jsx("div",{className:"inline-block mb-4",children:o.jsx(s(),{src:u,alt:`QR Code for ${e.title}`,width:300,height:300,className:"rounded-lg shadow-md"})}),(0,o.jsxs)("div",{className:"text-sm text-gray-600 mb-6",children:[o.jsx("p",{className:"font-medium text-gray-900",children:e.title}),o.jsx("p",{children:"Scan to view and support this petition"})]}),!w&&!p&&(0,o.jsxs)("div",{className:"flex gap-3",children:[d&&(0,o.jsxs)("button",{onClick:v,className:"flex-1 px-4 py-2 bg-gray-800 hover:bg-gray-900 text-white rounded-md transition-colors flex items-center justify-center gap-2 font-medium",children:[o.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),"Download"]}),c&&(0,o.jsxs)("button",{onClick:k,className:"flex-1 px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-md transition-colors flex items-center justify-center gap-2 font-medium",children:[o.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.367 2.684 3 3 0 00-5.367-2.684z"})}),"Share"]})]})]})]})})]}):"card"===r?o.jsx("div",{className:`bg-white rounded-lg shadow-md p-6 ${h}`,children:(0,o.jsxs)("div",{className:"text-center",children:[o.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Share this Petition"}),o.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Scan the QR code to view and support this petition"}),w?o.jsx("div",{className:"flex items-center justify-center bg-gray-100 rounded-lg mx-auto",style:{width:t,height:t},children:o.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-green-600"})}):p?o.jsx("div",{className:"flex items-center justify-center bg-red-50 border border-red-200 rounded-lg text-red-600 text-sm mx-auto",style:{width:t,height:t},children:p}):o.jsx("div",{className:"inline-block mb-4 cursor-pointer",onClick:N,children:o.jsx(s(),{src:u,alt:`QR Code for ${e.title}`,width:t,height:t,className:"rounded-lg shadow-md hover:shadow-lg transition-shadow"})}),(0,o.jsxs)("div",{className:"text-sm text-gray-600 mb-4",children:[o.jsx("p",{className:"font-medium",children:e.title}),o.jsx("p",{children:"Created by User"})]}),!w&&!p&&(0,o.jsxs)("div",{className:"flex gap-2 justify-center",children:[d&&(0,o.jsxs)("button",{onClick:v,className:"flex-1 px-4 py-2 bg-gray-800 hover:bg-gray-900 text-white rounded-md transition-colors flex items-center justify-center gap-2",children:[o.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),"Download"]}),c&&(0,o.jsxs)("button",{onClick:k,className:"flex-1 px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-md transition-colors flex items-center justify-center gap-2",children:[o.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.367 2.684 3 3 0 00-5.367-2.684z"})}),"Share"]})]})]})}):null}},51133:(e,t,r)=>{r.d(t,{Rc:()=>l,fc:()=>h,u2:()=>d,xw:()=>s}),r(95344);var o=r(3729),i=r(22254),a=r(87382);let s=(e="/auth/login")=>{let{user:t,loading:r}=(0,a.useAuth)(),s=(0,i.useRouter)();return(0,o.useEffect)(()=>{if(!r&&!t){let t=window.location.pathname,r=`${e}?redirect=${encodeURIComponent(t)}`;s.push(r)}},[t,r,s,e]),{user:t,loading:r,isAuthenticated:!!t}},n=(e,t="/dashboard")=>{let{user:r,userProfile:s,loading:n}=(0,a.useAuth)(),l=(0,i.useRouter)();return(0,o.useEffect)(()=>{if(!n){if(r)s&&!e.includes(s.role)&&l.push(t);else{let e=window.location.pathname,t=`/auth/login?redirect=${encodeURIComponent(e)}`;l.push(t)}}},[r,s,n,l,e,t]),{user:r,userProfile:s,loading:n,isAuthenticated:!!r,hasRequiredRole:!!s&&e.includes(s.role)}},l=(e="/dashboard")=>n(["admin"],e),d=(e="/dashboard")=>n(["moderator","admin"],e),c=(e,t)=>!!e&&t.includes(e.role),h=e=>c(e,["moderator","admin"])},16434:(e,t,r)=>{r.d(t,{bv:()=>l,bw:()=>c,w1:()=>n});var o=r(8035),i=r(73424),a=r(87097),s=r(81012);let n=async(e,t={})=>{let{size:r=256,branded:i=!1,includeAnalytics:a=!0}=t;try{let t=`https://3arida.ma/petitions/${e}${a?"?utm_source=qr":""}`,s=await o.toDataURL(t,{width:r,height:r,margin:2,color:{dark:"#000000",light:"#FFFFFF"},errorCorrectionLevel:"M"});if(i)return await d(s,r);return s}catch(e){throw console.error("Error generating QR code:",e),Error("Failed to generate QR code")}},l=async(e,t={})=>{let{size:r=512,branded:o=!1,updatePetition:l=!0}=t;try{let t=await n(e,{size:r,branded:o,includeAnalytics:!0}),d=await fetch(t),c=await d.blob(),h=`qr-codes/${e}-${Date.now()}.png`,m=(0,i.ref)(s.t,h);await (0,i.KV)(m,c);let x=await (0,i.getDownloadURL)(m);if(l){let t=(0,a.doc)(s.db,"petitions",e);await (0,a.updateDoc)(t,{qrCodeUrl:x,hasQrCode:!0,updatedAt:a.Timestamp.fromDate(new Date)})}return x}catch(e){throw console.error("Error generating and storing QR code:",e),Error("Failed to generate and store QR code")}},d=async(e,t)=>{try{let r=document.createElement("canvas"),o=r.getContext("2d");if(!o)throw Error("Could not get canvas context");r.width=t,r.height=t+60;let i=new Image;return await new Promise((t,r)=>{i.onload=t,i.onerror=r,i.src=e}),o.drawImage(i,0,0,t,t),o.fillStyle="#000000",o.font=`${Math.floor(.04*t)}px Arial, sans-serif`,o.textAlign="center",o.fillText("3arida.ma",t/2,t+30),o.fillText("Petition Platform",t/2,t+50),r.toDataURL("image/png")}catch(t){return console.error("Error adding branding to QR code:",t),e}},c=async(e,t,r="png",o={})=>{try{let{size:i=512,branded:a=!0}=o;if("png"===r){let r=await n(e,{size:i,branded:a,includeAnalytics:!0}),o=document.createElement("a");o.href=r,o.download=`${t.replace(/[^a-z0-9]/gi,"_").toLowerCase()}_qr_code.png`,document.body.appendChild(o),o.click(),document.body.removeChild(o)}else"pdf"===r&&await c(e,t,"png",o)}catch(e){throw console.error("Error downloading QR code:",e),Error("Failed to download QR code")}}}};