"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[770],{9479:function(e,t,r){r.d(t,{Z:function(){return c}});var n=r(7437),o=r(2265),i=r(6691),a=r.n(i),s=r(282),l=r(8063);function c(e){let{petition:t,size:r=256,variant:i="default",branded:c=!1,downloadable:d=!0,shareable:h=!0,className:u="",onShare:m,onDownload:g}=e,[x,f]=(0,o.useState)(""),[w,p]=(0,o.useState)(!0),[b,j]=(0,o.useState)(""),[v,y]=(0,o.useState)(!1);(0,o.useEffect)(()=>{(async()=>{try{if(p(!0),j(""),t.qrCodeUrl&&!c)f(t.qrCodeUrl);else{let e=await (0,s.w1)(t.id,{size:r,branded:c,includeAnalytics:!0});f(e)}}catch(e){console.error("Error generating QR code:",e),j("Failed to generate QR code")}finally{p(!1)}})()},[t.id,t.qrCodeUrl,r,c]);let k=async()=>{if(x)try{await (0,s.bw)(t.id,t.title,"png",{size:512,branded:c}),await (0,l.$l)(t.id),g&&g()}catch(e){console.error("Error downloading QR code:",e)}},N=async()=>{if(x)try{if(navigator.share){let e=await fetch(x),r=await e.blob(),n=new File([r],"".concat(t.title,"_qr_code.png"),{type:"image/png"});await navigator.share({title:"".concat(t.title," - QR Code"),text:"Scan this QR code to support: ".concat(t.title),files:[n]})}else{let e="".concat(window.location.origin,"/petitions/").concat(t.id);await navigator.clipboard.writeText(e),alert("Petition link copied to clipboard!")}await (0,l.$l)(t.id),m&&m()}catch(e){console.error("Error sharing QR code:",e)}},C=()=>{"default"===i&&y(!0)},R=()=>{y(!1)};return"default"===i?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"text-center ".concat(u),children:[w?(0,n.jsx)("div",{className:"flex items-center justify-center bg-gray-100 rounded-lg",style:{width:r,height:r},children:(0,n.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-green-600"})}):b?(0,n.jsx)("div",{className:"flex items-center justify-center bg-red-50 border border-red-200 rounded-lg text-red-600 text-sm",style:{width:r,height:r},children:b}):(0,n.jsx)("div",{className:"inline-block cursor-pointer",onClick:C,children:(0,n.jsx)(a(),{src:x,alt:"QR Code for ".concat(t.title),width:r,height:r,className:"rounded-lg shadow-md hover:shadow-lg transition-shadow"})}),!w&&!b&&(d||h)&&(0,n.jsxs)("div",{className:"flex gap-2 justify-center mt-3",children:[d&&(0,n.jsxs)("button",{onClick:k,className:"px-4 py-2 text-sm bg-gray-800 hover:bg-gray-900 text-white rounded-md transition-colors flex items-center gap-2 font-medium",children:[(0,n.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),"Download"]}),h&&(0,n.jsxs)("button",{onClick:N,className:"px-4 py-2 text-sm bg-green-600 hover:bg-green-700 text-white rounded-md transition-colors flex items-center gap-2 font-medium",children:[(0,n.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.367 2.684 3 3 0 00-5.367-2.684z"})}),"Share"]})]})]}),v&&(0,n.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",onClick:R,children:(0,n.jsxs)("div",{className:"bg-white rounded-lg max-w-md w-full p-6",onClick:e=>e.stopPropagation(),children:[(0,n.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,n.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Petition QR Code"}),(0,n.jsx)("button",{onClick:R,className:"text-gray-400 hover:text-gray-600 p-1",children:(0,n.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,n.jsxs)("div",{className:"text-center",children:[w?(0,n.jsx)("div",{className:"flex items-center justify-center bg-gray-100 rounded-lg mx-auto",style:{width:300,height:300},children:(0,n.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-green-600"})}):b?(0,n.jsx)("div",{className:"flex items-center justify-center bg-red-50 border border-red-200 rounded-lg text-red-600 text-sm mx-auto",style:{width:300,height:300},children:b}):(0,n.jsx)("div",{className:"inline-block mb-4",children:(0,n.jsx)(a(),{src:x,alt:"QR Code for ".concat(t.title),width:300,height:300,className:"rounded-lg shadow-md"})}),(0,n.jsxs)("div",{className:"text-sm text-gray-600 mb-6",children:[(0,n.jsx)("p",{className:"font-medium text-gray-900",children:t.title}),(0,n.jsx)("p",{children:"Scan to view and support this petition"})]}),!w&&!b&&(0,n.jsxs)("div",{className:"flex gap-3",children:[d&&(0,n.jsxs)("button",{onClick:k,className:"flex-1 px-4 py-2 bg-gray-800 hover:bg-gray-900 text-white rounded-md transition-colors flex items-center justify-center gap-2 font-medium",children:[(0,n.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),"Download"]}),h&&(0,n.jsxs)("button",{onClick:N,className:"flex-1 px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-md transition-colors flex items-center justify-center gap-2 font-medium",children:[(0,n.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.367 2.684 3 3 0 00-5.367-2.684z"})}),"Share"]})]})]})]})})]}):"card"===i?(0,n.jsx)("div",{className:"bg-white rounded-lg shadow-md p-6 ".concat(u),children:(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Share this Petition"}),(0,n.jsx)("p",{className:"text-sm text-gray-600 mb-4",children:"Scan the QR code to view and support this petition"}),w?(0,n.jsx)("div",{className:"flex items-center justify-center bg-gray-100 rounded-lg mx-auto",style:{width:r,height:r},children:(0,n.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-green-600"})}):b?(0,n.jsx)("div",{className:"flex items-center justify-center bg-red-50 border border-red-200 rounded-lg text-red-600 text-sm mx-auto",style:{width:r,height:r},children:b}):(0,n.jsx)("div",{className:"inline-block mb-4 cursor-pointer",onClick:C,children:(0,n.jsx)(a(),{src:x,alt:"QR Code for ".concat(t.title),width:r,height:r,className:"rounded-lg shadow-md hover:shadow-lg transition-shadow"})}),(0,n.jsxs)("div",{className:"text-sm text-gray-600 mb-4",children:[(0,n.jsx)("p",{className:"font-medium",children:t.title}),(0,n.jsx)("p",{children:"Created by User"})]}),!w&&!b&&(0,n.jsxs)("div",{className:"flex gap-2 justify-center",children:[d&&(0,n.jsxs)("button",{onClick:k,className:"flex-1 px-4 py-2 bg-gray-800 hover:bg-gray-900 text-white rounded-md transition-colors flex items-center justify-center gap-2",children:[(0,n.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),"Download"]}),h&&(0,n.jsxs)("button",{onClick:N,className:"flex-1 px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-md transition-colors flex items-center justify-center gap-2",children:[(0,n.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.367 2.684 3 3 0 00-5.367-2.684z"})}),"Share"]})]})]})}):null}},6587:function(e,t,r){r.d(t,{Rc:function(){return l},fc:function(){return h},u2:function(){return c},xw:function(){return a}}),r(7437);var n=r(2265),o=r(4033),i=r(3525);let a=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"/auth/login",{user:t,loading:r}=(0,i.useAuth)(),a=(0,o.useRouter)();return(0,n.useEffect)(()=>{if(!r&&!t){let t=window.location.pathname,r="".concat(e,"?redirect=").concat(encodeURIComponent(t));a.push(r)}},[t,r,a,e]),{user:t,loading:r,isAuthenticated:!!t}},s=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"/dashboard",{user:r,userProfile:a,loading:s}=(0,i.useAuth)(),l=(0,o.useRouter)();return(0,n.useEffect)(()=>{if(!s){if(r)a&&!e.includes(a.role)&&l.push(t);else{let e=window.location.pathname,t="/auth/login?redirect=".concat(encodeURIComponent(e));l.push(t)}}},[r,a,s,l,e,t]),{user:r,userProfile:a,loading:s,isAuthenticated:!!r,hasRequiredRole:!!a&&e.includes(a.role)}},l=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"/dashboard";return s(["admin"],e)},c=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"/dashboard";return s(["moderator","admin"],e)},d=(e,t)=>!!e&&t.includes(e.role),h=e=>d(e,["moderator","admin"])},282:function(e,t,r){r.d(t,{bv:function(){return l},bw:function(){return d},w1:function(){return s}});var n=r(5298),o=r(955),i=r(8121),a=r(1221);let s=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{size:r=256,branded:o=!1,includeAnalytics:i=!0}=t;try{let t=window.location.origin,a="".concat(t,"/petitions/").concat(e).concat(i?"?utm_source=qr":""),s=await n.toDataURL(a,{width:r,height:r,margin:2,color:{dark:"#000000",light:"#FFFFFF"},errorCorrectionLevel:"M"});if(o)return await c(s,r);return s}catch(e){throw console.error("Error generating QR code:",e),Error("Failed to generate QR code")}},l=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{size:r=512,branded:n=!1,updatePetition:l=!0}=t;try{let t=await s(e,{size:r,branded:n,includeAnalytics:!0}),c=await fetch(t),d=await c.blob(),h="qr-codes/".concat(e,"-").concat(Date.now(),".png"),u=(0,o.ref)(a.t,h);await (0,o.KV)(u,d);let m=await (0,o.getDownloadURL)(u);if(l){let t=(0,i.doc)(a.db,"petitions",e);await (0,i.updateDoc)(t,{qrCodeUrl:m,hasQrCode:!0,updatedAt:i.Timestamp.fromDate(new Date)})}return m}catch(e){throw console.error("Error generating and storing QR code:",e),Error("Failed to generate and store QR code")}},c=async(e,t)=>{try{let r=document.createElement("canvas"),n=r.getContext("2d");if(!n)throw Error("Could not get canvas context");r.width=t,r.height=t+60;let o=new Image;return await new Promise((t,r)=>{o.onload=t,o.onerror=r,o.src=e}),n.drawImage(o,0,0,t,t),n.fillStyle="#000000",n.font="".concat(Math.floor(.04*t),"px Arial, sans-serif"),n.textAlign="center",n.fillText("3arida.ma",t/2,t+30),n.fillText("Petition Platform",t/2,t+50),r.toDataURL("image/png")}catch(t){return console.error("Error adding branding to QR code:",t),e}},d=async function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"png",n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};try{let{size:o=512,branded:i=!0}=n;if("png"===r){let r=await s(e,{size:o,branded:i,includeAnalytics:!0}),n=document.createElement("a");n.href=r,n.download="".concat(t.replace(/[^a-z0-9]/gi,"_").toLowerCase(),"_qr_code.png"),document.body.appendChild(n),n.click(),document.body.removeChild(n)}else"pdf"===r&&await d(e,t,"png",n)}catch(e){throw console.error("Error downloading QR code:",e),Error("Failed to download QR code")}}}}]);