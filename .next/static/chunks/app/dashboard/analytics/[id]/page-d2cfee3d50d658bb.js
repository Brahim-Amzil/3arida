(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[368],{3138:function(e,s,t){Promise.resolve().then(t.bind(t,8684))},8684:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return g}});var r=t(7437),n=t(2265),a=t(4033),i=t(1396),l=t.n(i),o=t(1069),c=t(5671),d=t(8161);function x(e){let{petition:s,className:t=""}=e,[a,i]=(0,n.useState)(null),[l,o]=(0,n.useState)(!0),[x,h]=(0,n.useState)("30d"),u=(0,d.SB)(s.currentSignatures,s.targetSignatures);(0,n.useEffect)(()=>{m()},[s.id,x]);let m=async()=>{try{o(!0);let e={totalViews:s.viewCount,totalShares:s.shareCount,totalSignatures:s.currentSignatures,conversionRate:s.viewCount>0?s.currentSignatures/s.viewCount*100:0,shareRate:s.viewCount>0?s.shareCount/s.viewCount*100:0,dailyViews:g(s.viewCount,x),dailySignatures:g(s.currentSignatures,x),topReferrers:[{source:"Direct",count:Math.floor(.4*s.viewCount)},{source:"Facebook",count:Math.floor(.25*s.viewCount)},{source:"WhatsApp",count:Math.floor(.15*s.viewCount)},{source:"Twitter",count:Math.floor(.1*s.viewCount)},{source:"Other",count:Math.floor(.1*s.viewCount)}],demographics:{ageGroups:[{range:"18-24",count:Math.floor(.2*s.currentSignatures)},{range:"25-34",count:Math.floor(.35*s.currentSignatures)},{range:"35-44",count:Math.floor(.25*s.currentSignatures)},{range:"45-54",count:Math.floor(.15*s.currentSignatures)},{range:"55+",count:Math.floor(.05*s.currentSignatures)}],locations:[{city:"Casablanca",count:Math.floor(.3*s.currentSignatures)},{city:"Rabat",count:Math.floor(.2*s.currentSignatures)},{city:"Marrakech",count:Math.floor(.15*s.currentSignatures)},{city:"Fes",count:Math.floor(.1*s.currentSignatures)},{city:"Other",count:Math.floor(.25*s.currentSignatures)}]}};i(e)}catch(e){console.error("Error loading analytics:",e)}finally{o(!1)}},g=(e,s)=>{let t="7d"===s?7:"30d"===s?30:90,r=[];for(let s=0;s<t;s++){let s=e/t,n=.5*Math.random()+.75;r.push(Math.floor(s*n))}return r};return l?(0,r.jsx)("div",{className:"space-y-6 ".concat(t),children:[void 0,void 0,void 0,void 0].map((e,s)=>(0,r.jsx)(c.Zb,{children:(0,r.jsx)(c.aY,{className:"p-6",children:(0,r.jsxs)("div",{className:"animate-pulse",children:[(0,r.jsx)("div",{className:"h-4 bg-gray-200 rounded mb-2"}),(0,r.jsx)("div",{className:"h-8 bg-gray-200 rounded"})]})})},s))}):a?(0,r.jsxs)("div",{className:"space-y-6 ".concat(t),children:[(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsx)("h2",{className:"text-2xl font-bold text-gray-900",children:"Petition Analytics"}),(0,r.jsx)("div",{className:"flex bg-gray-100 rounded-lg p-1",children:["7d","30d","90d"].map(e=>(0,r.jsx)("button",{onClick:()=>h(e),className:"px-3 py-1 text-sm font-medium rounded-md transition-colors ".concat(x===e?"bg-white text-gray-900 shadow-sm":"text-gray-600 hover:text-gray-900"),children:"7d"===e?"7 days":"30d"===e?"30 days":"90 days"},e))})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[(0,r.jsx)(c.Zb,{children:(0,r.jsx)(c.aY,{className:"p-6",children:(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)("div",{className:"flex-shrink-0",children:(0,r.jsx)("div",{className:"w-8 h-8 bg-blue-100 rounded-lg flex items-center justify-center",children:(0,r.jsxs)("svg",{className:"w-5 h-5 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]})})}),(0,r.jsxs)("div",{className:"ml-4",children:[(0,r.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Total Views"}),(0,r.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:a.totalViews.toLocaleString()})]})]})})}),(0,r.jsx)(c.Zb,{children:(0,r.jsx)(c.aY,{className:"p-6",children:(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)("div",{className:"flex-shrink-0",children:(0,r.jsx)("div",{className:"w-8 h-8 bg-green-100 rounded-lg flex items-center justify-center",children:(0,r.jsx)("svg",{className:"w-5 h-5 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})})}),(0,r.jsxs)("div",{className:"ml-4",children:[(0,r.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Signatures"}),(0,r.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:a.totalSignatures.toLocaleString()})]})]})})}),(0,r.jsx)(c.Zb,{children:(0,r.jsx)(c.aY,{className:"p-6",children:(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)("div",{className:"flex-shrink-0",children:(0,r.jsx)("div",{className:"w-8 h-8 bg-purple-100 rounded-lg flex items-center justify-center",children:(0,r.jsx)("svg",{className:"w-5 h-5 text-purple-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.367 2.684 3 3 0 00-5.367-2.684z"})})})}),(0,r.jsxs)("div",{className:"ml-4",children:[(0,r.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Shares"}),(0,r.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:a.totalShares.toLocaleString()})]})]})})}),(0,r.jsx)(c.Zb,{children:(0,r.jsx)(c.aY,{className:"p-6",children:(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)("div",{className:"flex-shrink-0",children:(0,r.jsx)("div",{className:"w-8 h-8 bg-yellow-100 rounded-lg flex items-center justify-center",children:(0,r.jsx)("svg",{className:"w-5 h-5 text-yellow-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"})})})}),(0,r.jsxs)("div",{className:"ml-4",children:[(0,r.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Conversion Rate"}),(0,r.jsxs)("p",{className:"text-2xl font-bold text-gray-900",children:[a.conversionRate.toFixed(1),"%"]})]})]})})})]}),(0,r.jsxs)(c.Zb,{children:[(0,r.jsx)(c.Ol,{children:(0,r.jsx)(c.ll,{children:"Progress Overview"})}),(0,r.jsx)(c.aY,{children:(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsxs)("span",{className:"text-lg font-medium text-gray-900",children:[a.totalSignatures.toLocaleString()," of"," ",s.targetSignatures.toLocaleString()," signatures"]}),(0,r.jsxs)("span",{className:"text-lg font-bold text-green-600",children:[u.toFixed(1),"%"]})]}),(0,r.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-4",children:(0,r.jsx)("div",{className:"bg-green-600 h-4 rounded-full transition-all duration-300",style:{width:"".concat(Math.min(u,100),"%")}})}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-4 text-sm text-gray-600",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"font-medium",children:"Remaining:"})," ",Math.max(0,s.targetSignatures-a.totalSignatures).toLocaleString()]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"font-medium",children:"Share Rate:"})," ",a.shareRate.toFixed(1),"%"]})]})]})})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,r.jsxs)(c.Zb,{children:[(0,r.jsx)(c.Ol,{children:(0,r.jsx)(c.ll,{children:"Traffic Sources"})}),(0,r.jsx)(c.aY,{children:(0,r.jsx)("div",{className:"space-y-4",children:a.topReferrers.map((e,s)=>{let t=a.totalViews>0?e.count/a.totalViews*100:0;return(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)("div",{className:"w-3 h-3 rounded-full mr-3 ".concat(0===s?"bg-blue-500":1===s?"bg-green-500":2===s?"bg-yellow-500":3===s?"bg-purple-500":"bg-gray-500")}),(0,r.jsx)("span",{className:"text-sm font-medium text-gray-900",children:e.source})]}),(0,r.jsxs)("div",{className:"text-right",children:[(0,r.jsx)("div",{className:"text-sm font-bold text-gray-900",children:e.count.toLocaleString()}),(0,r.jsxs)("div",{className:"text-xs text-gray-500",children:[t.toFixed(1),"%"]})]})]},e.source)})})})]}),(0,r.jsxs)(c.Zb,{children:[(0,r.jsx)(c.Ol,{children:(0,r.jsx)(c.ll,{children:"Top Locations"})}),(0,r.jsx)(c.aY,{children:(0,r.jsx)("div",{className:"space-y-4",children:a.demographics.locations.map((e,s)=>{let t=a.totalSignatures>0?e.count/a.totalSignatures*100:0;return(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)("div",{className:"w-3 h-3 rounded-full mr-3 ".concat(0===s?"bg-red-500":1===s?"bg-orange-500":2===s?"bg-yellow-500":3===s?"bg-green-500":"bg-blue-500")}),(0,r.jsx)("span",{className:"text-sm font-medium text-gray-900",children:e.city})]}),(0,r.jsxs)("div",{className:"text-right",children:[(0,r.jsx)("div",{className:"text-sm font-bold text-gray-900",children:e.count.toLocaleString()}),(0,r.jsxs)("div",{className:"text-xs text-gray-500",children:[t.toFixed(1),"%"]})]})]},e.city)})})})]})]}),(0,r.jsxs)(c.Zb,{children:[(0,r.jsx)(c.Ol,{children:(0,r.jsx)(c.ll,{children:"Performance Insights"})}),(0,r.jsx)(c.aY,{children:(0,r.jsxs)("div",{className:"space-y-4",children:[a.conversionRate<2&&(0,r.jsxs)("div",{className:"flex items-start p-4 bg-yellow-50 border border-yellow-200 rounded-lg",children:[(0,r.jsx)("svg",{className:"w-5 h-5 text-yellow-600 mr-3 mt-0.5 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h4",{className:"text-sm font-medium text-yellow-800",children:"Low Conversion Rate"}),(0,r.jsxs)("p",{className:"text-sm text-yellow-700 mt-1",children:["Your conversion rate is"," ",a.conversionRate.toFixed(1),"%. Consider improving your petition description or adding compelling images."]})]})]}),a.shareRate<5&&(0,r.jsxs)("div",{className:"flex items-start p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[(0,r.jsx)("svg",{className:"w-5 h-5 text-blue-600 mr-3 mt-0.5 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h4",{className:"text-sm font-medium text-blue-800",children:"Increase Sharing"}),(0,r.jsxs)("p",{className:"text-sm text-blue-700 mt-1",children:["Your share rate is ",a.shareRate.toFixed(1),"%. Encourage supporters to share your petition on social media."]})]})]}),u>=75&&(0,r.jsxs)("div",{className:"flex items-start p-4 bg-green-50 border border-green-200 rounded-lg",children:[(0,r.jsx)("svg",{className:"w-5 h-5 text-green-600 mr-3 mt-0.5 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h4",{className:"text-sm font-medium text-green-800",children:"Great Progress!"}),(0,r.jsxs)("p",{className:"text-sm text-green-700 mt-1",children:["You're ",u.toFixed(1),"% of the way to your goal. Keep promoting your petition to reach 100%!"]})]})]})]})})]})]}):(0,r.jsx)("div",{className:"".concat(t),children:(0,r.jsx)(c.Zb,{children:(0,r.jsx)(c.aY,{className:"py-12 text-center",children:(0,r.jsx)("p",{className:"text-gray-500",children:"Failed to load analytics data"})})})})}var h=t(575),u=t(6587),m=t(8063);function g(){let e=(0,a.useParams)(),s=(0,a.useRouter)(),t=null==e?void 0:e.id,{user:i}=(0,u.xw)(),[c,d]=(0,n.useState)(null),[g,j]=(0,n.useState)(!0),[f,v]=(0,n.useState)("");(0,n.useEffect)(()=>{i&&t&&p()},[i,t]);let p=async()=>{try{j(!0),v("");let e=await (0,m.Am)(t);if(!e){v("Petition not found");return}if(e.creatorId!==(null==i?void 0:i.uid)){v("You can only view analytics for your own petitions");return}d(e)}catch(e){console.error("Error loading petition:",e),v("Failed to load petition")}finally{j(!1)}};return g?(0,r.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,r.jsx)(o.Z,{}),(0,r.jsx)("div",{className:"flex items-center justify-center min-h-[calc(100vh-4rem)]",children:(0,r.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-green-600"})})]}):f||!c?(0,r.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,r.jsx)(o.Z,{}),(0,r.jsx)("div",{className:"max-w-2xl mx-auto px-4 py-12",children:(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-8 text-center",children:[(0,r.jsx)("div",{className:"w-16 h-16 mx-auto mb-4 bg-red-100 rounded-full flex items-center justify-center",children:(0,r.jsx)("svg",{className:"w-8 h-8 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),(0,r.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Error"}),(0,r.jsx)("p",{className:"text-gray-600 mb-6",children:f}),(0,r.jsx)(h.z,{onClick:()=>s.push("/dashboard"),children:"Back to Dashboard"})]})})]}):(0,r.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,r.jsx)(o.Z,{}),(0,r.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[(0,r.jsxs)("div",{className:"mb-8",children:[(0,r.jsxs)("div",{className:"flex items-center gap-4 mb-4",children:[(0,r.jsx)(h.z,{variant:"outline",asChild:!0,children:(0,r.jsxs)(l(),{href:"/dashboard",children:[(0,r.jsx)("svg",{className:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})}),"Back to Dashboard"]})}),(0,r.jsx)(h.z,{variant:"outline",asChild:!0,children:(0,r.jsx)(l(),{href:"/petitions/".concat(c.id),children:"View Petition"})})]}),(0,r.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Petition Analytics"}),(0,r.jsx)("p",{className:"text-lg text-gray-600",children:c.title})]}),(0,r.jsx)(x,{petition:c})]})]})}},6587:function(e,s,t){"use strict";t.d(s,{Rc:function(){return o},fc:function(){return x},u2:function(){return c},xw:function(){return i}}),t(7437);var r=t(2265),n=t(4033),a=t(3525);let i=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"/auth/login",{user:s,loading:t}=(0,a.useAuth)(),i=(0,n.useRouter)();return(0,r.useEffect)(()=>{if(!t&&!s){let s=window.location.pathname,t="".concat(e,"?redirect=").concat(encodeURIComponent(s));i.push(t)}},[s,t,i,e]),{user:s,loading:t,isAuthenticated:!!s}},l=function(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"/dashboard",{user:t,userProfile:i,loading:l}=(0,a.useAuth)(),o=(0,n.useRouter)();return(0,r.useEffect)(()=>{if(!l){if(t)i&&!e.includes(i.role)&&o.push(s);else{let e=window.location.pathname,s="/auth/login?redirect=".concat(encodeURIComponent(e));o.push(s)}}},[t,i,l,o,e,s]),{user:t,userProfile:i,loading:l,isAuthenticated:!!t,hasRequiredRole:!!i&&e.includes(i.role)}},o=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"/dashboard";return l(["admin"],e)},c=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"/dashboard";return l(["moderator","admin"],e)},d=(e,s)=>!!e&&s.includes(e.role),x=e=>d(e,["moderator","admin"])}},function(e){e.O(0,[358,139,218,682,680,396,496,340,878,69,63,971,938,744],function(){return e(e.s=3138)}),_N_E=e.O()}]);