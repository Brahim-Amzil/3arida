(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1310],{5531:function(e,t,r){"use strict";r.d(t,{Z:function(){return u}});var i=r(2265);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let s=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),a=e=>e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,r)=>r?r.toUpperCase():t.toLowerCase()),n=e=>{let t=a(e);return t.charAt(0).toUpperCase()+t.slice(1)},l=(...e)=>e.filter((e,t,r)=>!!e&&""!==e.trim()&&r.indexOf(e)===t).join(" ").trim(),o=e=>{for(let t in e)if(t.startsWith("aria-")||"role"===t||"title"===t)return!0};/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var d={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let c=(0,i.forwardRef)(({color:e="currentColor",size:t=24,strokeWidth:r=2,absoluteStrokeWidth:s,className:a="",children:n,iconNode:c,...u},m)=>(0,i.createElement)("svg",{ref:m,...d,width:t,height:t,stroke:e,strokeWidth:s?24*Number(r)/Number(t):r,className:l("lucide",a),...!n&&!o(u)&&{"aria-hidden":"true"},...u},[...c.map(([e,t])=>(0,i.createElement)(e,t)),...Array.isArray(n)?n:[n]])),u=(e,t)=>{let r=(0,i.forwardRef)(({className:r,...a},o)=>(0,i.createElement)(c,{ref:o,iconNode:t,className:l(`lucide-${s(n(e))}`,`lucide-${e}`,r),...a}));return r.displayName=n(e),r}},8063:function(e,t,r){"use strict";r.d(t,{Z:function(){return i}});let i=(0,r(5531).Z)("circle-alert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]])},976:function(e,t,r){Promise.resolve().then(r.bind(r,9682))},9682:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return p}});var i=r(7437),s=r(2265),a=r(4033),n=r(1138),l=r(2193),o=r(2053),d=r(3089),c=r(609),u=r(1550),m=r(5797),h=r(6831),x=r(8071),f=r(8063);function p(){let e=(0,a.useParams)(),t=(0,a.useRouter)(),r=null==e?void 0:e.id,{user:p,userProfile:g}=(0,n.useAuth)(),[v,b]=(0,s.useState)(null),[j,y]=(0,s.useState)(!0),[N,w]=(0,s.useState)(!1),[A,C]=(0,s.useState)(""),[D,k]=(0,s.useState)(""),[E,P]=(0,s.useState)(""),[R,S]=(0,s.useState)(""),[U,L]=(0,s.useState)(2500),[T,Z]=(0,s.useState)([]),[O,M]=(0,s.useState)([]);(0,s.useEffect)(()=>{let e=async()=>{if(r)try{let e=await (0,u.I7)(r);if(!e){C("Petition not found"),y(!1);return}if(e.creatorId!==(null==p?void 0:p.uid)){C("You do not have permission to edit this petition"),y(!1);return}if("rejected"!==e.status){C("Only rejected petitions can be edited and resubmitted"),y(!1);return}if((e.resubmissionCount||0)>=3){C("You have reached the maximum number of resubmissions (".concat(3,")")),y(!1);return}b(e),k(e.title),P(e.description),S(e.category),L(e.targetSignatures),M(e.mediaUrls||[]),y(!1)}catch(e){console.error("Error loading petition:",e),C("Failed to load petition"),y(!1)}};p&&e()},[r,p]);let _=async e=>{if(e.preventDefault(),v&&p){w(!0),C("");try{let e=[];if(T.length>0)for(let t of T){let r=Date.now(),i=t.name.split(".").pop(),s="".concat(p.uid,"_").concat(r,"_").concat(Math.random().toString(36).substring(7),".").concat(i),a=(0,x.ref)(h.t,"petition-media/".concat(s));await (0,x.KV)(a,t);let n=await (0,x.getDownloadURL)(a);e.push(n)}let r=[...O,...e],i=v.resubmissionHistory||[],s=i.map((e,t)=>{let r=t===i.length-1;return{rejectedAt:e.rejectedAt instanceof Date?m.Timestamp.fromDate(e.rejectedAt):e.rejectedAt,reason:e.reason,resubmittedAt:r?m.Timestamp.fromDate(new Date):e.resubmittedAt?e.resubmittedAt instanceof Date?m.Timestamp.fromDate(e.resubmittedAt):e.resubmittedAt:null}});0===s.length&&s.push({rejectedAt:v.rejectedAt?m.Timestamp.fromDate(v.rejectedAt):m.Timestamp.fromDate(new Date),reason:v.moderationNotes||"No reason provided",resubmittedAt:m.Timestamp.fromDate(new Date)});let a={title:D,description:E,category:R,targetSignatures:U,mediaUrls:r,status:"pending",resubmissionCount:(v.resubmissionCount||0)+1,resubmissionHistory:s,moderationNotes:"",updatedAt:m.Timestamp.fromDate(new Date)};await (0,m.updateDoc)((0,m.doc)(h.db,"petitions",v.id),a),alert("Petition resubmitted successfully! It will be reviewed by our moderation team."),t.push("/dashboard")}catch(e){console.error("Error resubmitting petition:",e),C("Failed to resubmit petition. Please try again."),w(!1)}}},H=e=>{M(O.filter((t,r)=>r!==e))};if(j)return(0,i.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,i.jsx)(l.default,{}),(0,i.jsx)("div",{className:"flex items-center justify-center min-h-[calc(100vh-4rem)]",children:(0,i.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-green-600"})})]});if(A)return(0,i.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,i.jsx)(l.default,{}),(0,i.jsx)("div",{className:"max-w-2xl mx-auto px-4 py-12",children:(0,i.jsx)(c.Zb,{children:(0,i.jsxs)(c.aY,{className:"py-12 text-center",children:[(0,i.jsx)("div",{className:"w-16 h-16 mx-auto mb-4 bg-red-100 rounded-full flex items-center justify-center",children:(0,i.jsx)(f.Z,{className:"w-8 h-8 text-red-600"})}),(0,i.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Cannot Edit Petition"}),(0,i.jsx)("p",{className:"text-gray-600 mb-6",children:A}),(0,i.jsx)(d.z,{onClick:()=>t.push("/dashboard"),children:"Go to Dashboard"})]})})})]});let I=3-((null==v?void 0:v.resubmissionCount)||0);return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(l.default,{}),(0,i.jsx)("div",{className:"min-h-screen bg-gray-50 py-8",children:(0,i.jsx)("div",{className:"max-w-3xl mx-auto px-4",children:(0,i.jsxs)(c.Zb,{children:[(0,i.jsxs)(c.Ol,{children:[(0,i.jsx)(c.ll,{children:"Edit & Resubmit Petition"}),(0,i.jsxs)("div",{className:"mt-2 space-y-2",children:[(0,i.jsx)("div",{className:"bg-blue-50 border-l-4 border-blue-500 p-4 rounded-r-lg",children:(0,i.jsxs)("p",{className:"text-sm text-blue-700",children:["You have ",(0,i.jsx)("strong",{children:I})," resubmission",1!==I?"s":""," remaining."]})}),(null==v?void 0:v.moderationNotes)&&(0,i.jsxs)("div",{className:"bg-red-50 border-l-4 border-red-500 p-4 rounded-r-lg",children:[(0,i.jsx)("p",{className:"text-sm font-medium text-red-800 mb-1",children:"Previous Rejection Reason:"}),(0,i.jsx)("p",{className:"text-sm text-red-700",children:v.moderationNotes})]})]})]}),(0,i.jsx)(c.aY,{children:(0,i.jsxs)("form",{onSubmit:_,className:"space-y-6",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Petition Title *"}),(0,i.jsx)("input",{type:"text",value:D,onChange:e=>k(e.target.value),required:!0,maxLength:150,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent",placeholder:"Enter a clear and concise title"})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Description *"}),(0,i.jsx)("textarea",{value:E,onChange:e=>P(e.target.value),required:!0,rows:8,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent",placeholder:"Describe your petition in detail"})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Category *"}),(0,i.jsxs)("select",{value:R,onChange:e=>S(e.target.value),required:!0,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent",children:[(0,i.jsx)("option",{value:"",children:"Select a category"}),(0,i.jsx)("option",{value:"Environment",children:"Environment"}),(0,i.jsx)("option",{value:"Human Rights",children:"Human Rights"}),(0,i.jsx)("option",{value:"Education",children:"Education"}),(0,i.jsx)("option",{value:"Health",children:"Health"}),(0,i.jsx)("option",{value:"Animal Rights",children:"Animal Rights"}),(0,i.jsx)("option",{value:"Politics",children:"Politics"}),(0,i.jsx)("option",{value:"Economy",children:"Economy"}),(0,i.jsx)("option",{value:"Social Justice",children:"Social Justice"}),(0,i.jsx)("option",{value:"Other",children:"Other"})]})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Target Signatures *"}),(0,i.jsx)("input",{type:"number",value:U,onChange:e=>L(parseInt(e.target.value)),required:!0,min:100,max:1e5,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent"})]}),O.length>0&&(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Current Media"}),(0,i.jsx)("div",{className:"grid grid-cols-2 gap-4",children:O.map((e,t)=>(0,i.jsxs)("div",{className:"relative",children:[(0,i.jsx)("img",{src:e,alt:"Media ".concat(t+1),className:"w-full h-32 object-cover rounded-lg"}),(0,i.jsx)("button",{type:"button",onClick:()=>H(t),className:"absolute top-2 right-2 bg-red-500 text-white rounded-full p-1 hover:bg-red-600",children:(0,i.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,i.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]},t))})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Add New Media (Optional)"}),(0,i.jsx)("input",{type:"file",accept:"image/*,video/*",multiple:!0,onChange:e=>Z(Array.from(e.target.files||[])),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent"})]}),(0,i.jsxs)("div",{className:"flex gap-4",children:[(0,i.jsx)(d.z,{type:"submit",disabled:N,className:"flex-1",children:N?"Resubmitting...":"Resubmit for Review"}),(0,i.jsx)(d.z,{type:"button",variant:"outline",onClick:()=>t.push("/petitions/".concat(r)),disabled:N,children:"Cancel"})]})]})})]})})}),(0,i.jsx)(o.Z,{})]})}},1138:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return c},useAuth:function(){return d}});var i=r(7437),s=r(2265),a=r(4867),n=r(5797),l=r(6831);let o=(0,s.createContext)({user:null,userProfile:null,loading:!0,isAuthenticated:!1}),d=()=>{let e=(0,s.useContext)(o);if(!e)throw Error("useAuth must be used within an AuthProvider");return e};function c(e){let{children:t}=e,[r,d]=(0,s.useState)(null),[c,u]=(0,s.useState)(null),[m,h]=(0,s.useState)(!0);return(0,s.useEffect)(()=>{let e=null,t=(0,a.Aj)(l.auth,async t=>{if(console.log("\uD83D\uDD10 Auth state changed:",t?"User logged in":"User logged out"),d(t),h(!1),e&&(e(),e=null),t){let r=(0,n.doc)(l.db,"users",t.uid);e=(0,n.cf)(r,async e=>{if(e.exists()){var r,i,s,a,n,o,d,c;let m=e.data();if(console.log("\uD83D\uDC64 User profile updated from Firestore",{hasBio:!!m.bio,bio:m.bio,isActive:m.isActive}),!1===m.isActive){console.warn("⚠️ User account is inactive, logging out..."),await l.auth.signOut(),window.location.href="/auth/login?error=account-inactive";return}u({id:t.uid,name:m.name||t.displayName||"",email:m.email||t.email||"",phone:m.phone,photoURL:m.photoURL||t.photoURL,bio:m.bio,verifiedEmail:m.verifiedEmail||t.emailVerified||!1,verifiedPhone:m.verifiedPhone||!1,role:m.role||"user",creatorPageId:m.creatorPageId,fcmToken:m.fcmToken,fcmTokenUpdatedAt:null===(i=m.fcmTokenUpdatedAt)||void 0===i?void 0:null===(r=i.toDate)||void 0===r?void 0:r.call(i),createdAt:(null===(a=m.createdAt)||void 0===a?void 0:null===(s=a.toDate)||void 0===s?void 0:s.call(a))||new Date,updatedAt:null===(o=m.updatedAt)||void 0===o?void 0:null===(n=o.toDate)||void 0===n?void 0:n.call(o),lastLoginAt:null===(c=m.lastLoginAt)||void 0===c?void 0:null===(d=c.toDate)||void 0===d?void 0:d.call(c),isActive:!1!==m.isActive})}else u({id:t.uid,name:t.displayName||"",email:t.email||"",verifiedEmail:t.emailVerified,verifiedPhone:!1,role:"user",isActive:!0,createdAt:new Date})},e=>{console.error("Error listening to user profile:",e),u({id:t.uid,name:t.displayName||"",email:t.email||"",verifiedEmail:t.emailVerified,verifiedPhone:!1,role:"user",isActive:!0,createdAt:new Date})})}else u(null)});return()=>{t(),e&&e()}},[]),(0,i.jsx)(o.Provider,{value:{user:r,userProfile:c,loading:m,isAuthenticated:!!r},children:t})}},2053:function(e,t,r){"use strict";r.d(t,{Z:function(){return n}});var i=r(7437);r(2265);var s=r(1396),a=r.n(s);function n(){return(0,i.jsx)("footer",{className:"bg-gray-900 text-white py-12 mt-auto",children:(0,i.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[(0,i.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-8",children:[(0,i.jsxs)("div",{children:[(0,i.jsxs)("div",{className:"flex items-center space-x-2 mb-4",children:[(0,i.jsx)("div",{className:"w-8 h-8 bg-green-600 rounded-lg flex items-center justify-center",children:(0,i.jsx)("span",{className:"text-white font-bold text-lg",children:"3"})}),(0,i.jsx)("span",{className:"text-xl font-bold",children:"3arida"})]}),(0,i.jsx)("p",{className:"text-gray-400",children:"Empowering Moroccan citizens to create change through petitions."})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("h3",{className:"font-semibold mb-4",children:"Platform"}),(0,i.jsxs)("ul",{className:"space-y-2 text-gray-400",children:[(0,i.jsx)("li",{children:(0,i.jsx)(a(),{href:"/petitions",className:"hover:text-white",children:"Discover Petitions"})}),(0,i.jsx)("li",{children:(0,i.jsx)(a(),{href:"/petitions/create",className:"hover:text-white",children:"Start a Petition"})}),(0,i.jsx)("li",{children:(0,i.jsx)(a(),{href:"/about",className:"hover:text-white",children:"About Us"})})]})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("h3",{className:"font-semibold mb-4",children:"Support"}),(0,i.jsxs)("ul",{className:"space-y-2 text-gray-400",children:[(0,i.jsx)("li",{children:(0,i.jsx)(a(),{href:"/help",className:"hover:text-white",children:"Help Center"})}),(0,i.jsx)("li",{children:(0,i.jsx)(a(),{href:"/contact",className:"hover:text-white",children:"Contact Us"})}),(0,i.jsx)("li",{children:(0,i.jsx)(a(),{href:"/guidelines",className:"hover:text-white",children:"Community Guidelines"})})]})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("h3",{className:"font-semibold mb-4",children:"Legal"}),(0,i.jsxs)("ul",{className:"space-y-2 text-gray-400",children:[(0,i.jsx)("li",{children:(0,i.jsx)(a(),{href:"/privacy",className:"hover:text-white",children:"Privacy Policy"})}),(0,i.jsx)("li",{children:(0,i.jsx)(a(),{href:"/terms",className:"hover:text-white",children:"Terms of Service"})}),(0,i.jsx)("li",{children:(0,i.jsx)(a(),{href:"/cookies",className:"hover:text-white",children:"Cookie Policy"})})]})]})]}),(0,i.jsx)("div",{className:"border-t border-gray-800 mt-8 pt-8 text-center text-gray-400",children:(0,i.jsx)("p",{children:"\xa9 2024 3arida. All rights reserved. Made with ❤️ for Morocco."})})]})})}},609:function(e,t,r){"use strict";r.d(t,{Ol:function(){return l},Zb:function(){return n},aY:function(){return d},ll:function(){return o}});var i=r(7437),s=r(2265),a=r(345);let n=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,i.jsx)("div",{ref:t,className:(0,a.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",r),...s})});n.displayName="Card";let l=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,i.jsx)("div",{ref:t,className:(0,a.cn)("flex flex-col space-y-1.5 p-6",r),...s})});l.displayName="CardHeader";let o=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,i.jsx)("h3",{ref:t,className:(0,a.cn)("text-2xl font-semibold leading-none tracking-tight",r),...s})});o.displayName="CardTitle",s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,i.jsx)("p",{ref:t,className:(0,a.cn)("text-sm text-muted-foreground",r),...s})}).displayName="CardDescription";let d=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,i.jsx)("div",{ref:t,className:(0,a.cn)("p-6 pt-0",r),...s})});d.displayName="CardContent",s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,i.jsx)("div",{ref:t,className:(0,a.cn)("flex items-center p-6 pt-0",r),...s})}).displayName="CardFooter"},1396:function(e,t,r){e.exports=r(8326)},4033:function(e,t,r){e.exports=r(94)}},function(e){e.O(0,[4358,139,8218,7895,8326,745,9112,8984,2971,2472,1744],function(){return e(e.s=976)}),_N_E=e.O()}]);