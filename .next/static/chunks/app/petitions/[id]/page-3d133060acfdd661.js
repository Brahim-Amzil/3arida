(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1864],{5531:function(e,t,s){"use strict";s.d(t,{Z:function(){return m}});var a=s(2265);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let r=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),i=e=>e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,s)=>s?s.toUpperCase():t.toLowerCase()),n=e=>{let t=i(e);return t.charAt(0).toUpperCase()+t.slice(1)},l=(...e)=>e.filter((e,t,s)=>!!e&&""!==e.trim()&&s.indexOf(e)===t).join(" ").trim(),o=e=>{for(let t in e)if(t.startsWith("aria-")||"role"===t||"title"===t)return!0};/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var c={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let d=(0,a.forwardRef)(({color:e="currentColor",size:t=24,strokeWidth:s=2,absoluteStrokeWidth:r,className:i="",children:n,iconNode:d,...m},x)=>(0,a.createElement)("svg",{ref:x,...c,width:t,height:t,stroke:e,strokeWidth:r?24*Number(s)/Number(t):s,className:l("lucide",i),...!n&&!o(m)&&{"aria-hidden":"true"},...m},[...d.map(([e,t])=>(0,a.createElement)(e,t)),...Array.isArray(n)?n:[n]])),m=(e,t)=>{let s=(0,a.forwardRef)(({className:s,...i},o)=>(0,a.createElement)(d,{ref:o,iconNode:t,className:l(`lucide-${r(n(e))}`,`lucide-${e}`,s),...i}));return s.displayName=n(e),s}},2442:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});let a=(0,s(5531).Z)("check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]])},8063:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});let a=(0,s(5531).Z)("circle-alert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]])},4530:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});let a=(0,s(5531).Z)("circle-check-big",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]])},3101:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});let a=(0,s(5531).Z)("pause",[["rect",{x:"14",y:"3",width:"5",height:"18",rx:"1",key:"kaeet6"}],["rect",{x:"5",y:"3",width:"5",height:"18",rx:"1",key:"1wsw3u"}]])},5367:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});let a=(0,s(5531).Z)("trash-2",[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]])},2549:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});let a=(0,s(5531).Z)("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]])},8042:function(e,t,s){Promise.resolve().then(s.bind(s,5654))},5654:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return W}});var a=s(7437),r=s(2265),i=s(4033),n=s(6691),l=s.n(n),o=s(1396),c=s.n(o),d=s(2193),m=s(2053),x=s(2130),h=s(1566),u=s(3089),p=s(609),g=s(1550);function j(e){let{petition:t,onClose:s}=e,[i,n]=(0,r.useState)(!1),l="".concat(window.location.origin,"/petitions/").concat(t.id),o="Support this petition: ".concat(t.title),c=encodeURIComponent(l),d=encodeURIComponent(o),m=async()=>{try{await navigator.clipboard.writeText(l),n(!0),setTimeout(()=>n(!1),2e3),await (0,g.$l)(t.id)}catch(e){console.error("Failed to copy link:",e)}},x=async(e,s)=>{window.open(s,"_blank","width=600,height=400");try{await (0,g.$l)(t.id)}catch(e){console.error("Failed to track share:",e)}},h=async()=>{if(navigator.share)try{await navigator.share({title:t.title,text:o,url:l}),await (0,g.$l)(t.id)}catch(e){}},j=[{name:"Facebook",icon:(0,a.jsx)("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{d:"M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"})}),url:"https://www.facebook.com/sharer/sharer.php?u=".concat(c),color:"bg-blue-600 hover:bg-blue-700"},{name:"X",icon:(0,a.jsx)("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{d:"M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"})}),url:"https://twitter.com/intent/tweet?text=".concat(d,"&url=").concat(c),color:"bg-black hover:bg-gray-900"},{name:"WhatsApp",icon:(0,a.jsx)("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{d:"M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893A11.821 11.821 0 0020.885 3.488"})}),url:"https://wa.me/?text=".concat(d,"%20").concat(c),color:"bg-green-500 hover:bg-green-600"},{name:"LinkedIn",icon:(0,a.jsx)("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{d:"M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"})}),url:"https://www.linkedin.com/sharing/share-offsite/?url=".concat(c),color:"bg-blue-700 hover:bg-blue-800"},{name:"Telegram",icon:(0,a.jsx)("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{d:"M11.944 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0a12 12 0 0 0-.056 0zm4.962 7.224c.1-.002.321.023.465.14a.506.506 0 0 1 .171.325c.016.093.036.306.02.472-.18 1.898-.962 6.502-1.36 8.627-.168.9-.499 1.201-.82 1.23-.696.065-1.225-.46-1.9-.902-1.056-.693-1.653-1.124-2.678-1.8-1.185-.78-.417-1.21.258-1.91.177-.184 3.247-2.977 3.307-3.23.007-.032.014-.15-.056-.212s-.174-.041-.249-.024c-.106.024-1.793 1.14-5.061 3.345-.48.33-.913.49-1.302.48-.428-.008-1.252-.241-1.865-.44-.752-.245-1.349-.374-1.297-.789.027-.216.325-.437.893-.663 3.498-1.524 5.83-2.529 6.998-3.014 3.332-1.386 4.025-1.627 4.476-1.635z"})}),url:"https://t.me/share/url?url=".concat(c,"&text=").concat(d),color:"bg-blue-500 hover:bg-blue-600"}];return(0,a.jsxs)(p.Zb,{className:"w-full max-w-md",children:[(0,a.jsx)(p.Ol,{children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)(p.ll,{children:"Share Petition"}),s&&(0,a.jsx)("button",{onClick:s,className:"text-gray-400 hover:text-gray-600 p-1",children:(0,a.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})}),(0,a.jsxs)(p.aY,{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"p-4 bg-gray-50 rounded-lg",children:[(0,a.jsx)("h4",{className:"font-medium text-gray-900 mb-2 line-clamp-2",children:t.title}),(0,a.jsxs)("div",{className:"flex items-center gap-4 text-sm text-gray-600",children:[(0,a.jsxs)("span",{children:[t.currentSignatures.toLocaleString()," signatures"]}),(0,a.jsx)("span",{children:t.category})]})]}),(0,a.jsxs)("button",{onClick:()=>x("WhatsApp","https://wa.me/?text=".concat(d,"%20").concat(c)),className:"w-full bg-green-500 hover:bg-green-600 text-white p-3 rounded-lg flex items-center justify-center gap-2 transition-colors",children:[(0,a.jsx)("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{d:"M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893A11.821 11.821 0 0020.885 3.488"})}),(0,a.jsx)("span",{className:"text-sm font-medium",children:"WhatsApp"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"text-sm font-medium text-gray-700 mb-3",children:"Share on social media"}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[j.filter(e=>"WhatsApp"!==e.name).map(e=>(0,a.jsxs)("button",{onClick:()=>x(e.name,e.url),className:"".concat(e.color," text-white p-3 rounded-lg flex items-center justify-center gap-2 transition-colors"),children:[e.icon,(0,a.jsx)("span",{className:"text-sm font-medium",children:e.name})]},e.name)),void 0!==navigator.share&&(0,a.jsxs)("button",{onClick:h,className:"bg-gray-600 hover:bg-gray-700 text-white p-3 rounded-lg flex items-center justify-center gap-2 transition-colors",children:[(0,a.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.367 2.684 3 3 0 00-5.367-2.684z"})}),(0,a.jsx)("span",{className:"text-sm font-medium",children:"Share"})]})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"text-sm font-medium text-gray-700 mb-3",children:"Copy link"}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("input",{type:"text",value:l,readOnly:!0,className:"flex-1 px-3 py-2 border border-gray-300 rounded-md bg-gray-50 text-sm"}),(0,a.jsx)(u.z,{onClick:m,variant:"outline",className:i?"bg-green-50 border-green-300 text-green-700":"",children:i?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("svg",{className:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),"Copied"]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("svg",{className:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})}),"Copy"]})})]})]}),(0,a.jsx)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:(0,a.jsxs)("div",{className:"flex items-start",children:[(0,a.jsx)("svg",{className:"w-5 h-5 text-blue-600 mr-2 mt-0.5 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h5",{className:"text-sm font-medium text-blue-800 mb-1",children:"Sharing Tips"}),(0,a.jsxs)("ul",{className:"text-xs text-blue-700 space-y-1",children:[(0,a.jsx)("li",{children:"• Add a personal message when sharing"}),(0,a.jsx)("li",{children:"• Share with friends who care about this cause"}),(0,a.jsx)("li",{children:"• Post in relevant groups and communities"}),(0,a.jsx)("li",{children:"• Use relevant hashtags on social media"})]})]})]})})]})]})}var b=s(1138),f=s(5797),y=s(6831);function v(e){let{petitionId:t,className:s="",onCommentsCountChange:i}=e,{user:n,userProfile:l}=(0,b.useAuth)(),[o,c]=(0,r.useState)([]),[d,m]=(0,r.useState)(!0),[x,h]=(0,r.useState)(!1),[g,j]=(0,r.useState)(""),[v,N]=(0,r.useState)(!1),[w,k]=(0,r.useState)(!1),[C,S]=(0,r.useState)("latest"),[A,D]=(0,r.useState)(new Set);(0,r.useEffect)(()=>{L()},[t]);let L=async()=>{try{m(!0),console.log("\uD83D\uDD0D Loading comments for petition:",t);let e=(0,f.collection)(y.db,"comments"),s=(0,f.query)(e,(0,f.where)("petitionId","==",t),(0,f.orderBy)("createdAt","desc")),a=await (0,f.getDocs)(s),r=[];console.log("\uD83D\uDCCA Found comments:",a.size),a.forEach(e=>{var t;let s=e.data(),a=s.likedBy||[];n&&a.includes(n.uid)&&D(t=>new Set(t).add(e.id)),r.push({id:e.id,petitionId:s.petitionId,authorId:s.authorId,authorName:s.authorName,content:s.content,createdAt:(null===(t=s.createdAt)||void 0===t?void 0:t.toDate())||new Date,isAnonymous:s.isAnonymous||!1,likes:s.likes||0,likedBy:a,replies:[]})}),console.log("✅ Loaded comments:",r.length);let l=z(r,C);c(l),null==i||i(r.length)}catch(e){console.error("❌ Error loading comments:",e),alert("Failed to load comments. Check console for details.")}finally{m(!1)}},z=(e,t)=>"mostLiked"===t?[...e].sort((e,t)=>t.likes-e.likes):[...e].sort((e,t)=>t.createdAt.getTime()-e.createdAt.getTime());(0,r.useEffect)(()=>{o.length>0&&c(z(o,C))},[C]);let P=async e=>{if(e.preventDefault(),n&&l&&g.trim())try{h(!0);let e={petitionId:t,authorId:n.uid,authorName:v?"Anonymous":l.name,content:g.trim(),createdAt:f.Timestamp.fromDate(new Date),isAnonymous:v,likes:0},s={id:(await (0,f.addDoc)((0,f.collection)(y.db,"comments"),e)).id,...e,createdAt:new Date,replies:[]};c(e=>{let t=[s,...e];return null==i||i(t.length),t}),j(""),k(!1)}catch(e){console.error("Error submitting comment:",e),alert("Failed to submit comment. Please try again.")}finally{h(!1)}},M=async e=>{if(!n){alert("Please sign in to like comments");return}try{var t,s,a;let r=(0,f.doc)(y.db,"comments",e);if(A.has(e))await (0,f.updateDoc)(r,{likes:(0,f.nP)(-1),likedBy:(null===(s=o.find(t=>t.id===e))||void 0===s?void 0:null===(t=s.likedBy)||void 0===t?void 0:t.filter(e=>e!==n.uid))||[]}),D(t=>{let s=new Set(t);return s.delete(e),s}),c(t=>t.map(t=>{var s;return t.id===e?{...t,likes:t.likes-1,likedBy:null===(s=t.likedBy)||void 0===s?void 0:s.filter(e=>e!==n.uid)}:t}));else{let t=(null===(a=o.find(t=>t.id===e))||void 0===a?void 0:a.likedBy)||[];await (0,f.updateDoc)(r,{likes:(0,f.nP)(1),likedBy:[...t,n.uid]}),D(t=>new Set(t).add(e)),c(t=>t.map(t=>t.id===e?{...t,likes:t.likes+1,likedBy:[...t.likedBy||[],n.uid]}:t))}}catch(e){console.error("Error liking comment:",e),alert("Failed to like comment. Please try again.")}},T=e=>{let t=Math.floor((new Date().getTime()-e.getTime())/1e3);return t<60?"just now":t<3600?"".concat(Math.floor(t/60),"m ago"):t<86400?"".concat(Math.floor(t/3600),"h ago"):t<604800?"".concat(Math.floor(t/86400),"d ago"):e.toLocaleDateString()};return(0,a.jsxs)(p.Zb,{className:s,children:[(0,a.jsxs)(p.Ol,{children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsxs)(p.ll,{children:["Discussion (",o.length,")"]}),n&&!w&&(0,a.jsx)(u.z,{onClick:()=>k(!0),size:"sm",children:"Add Comment"})]}),o.length>0&&(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"text-sm text-gray-600",children:"Sort by:"}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("button",{onClick:()=>S("latest"),className:"px-3 py-1.5 text-sm rounded-md transition-colors ".concat("latest"===C?"bg-green-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:"Latest"}),(0,a.jsx)("button",{onClick:()=>S("mostLiked"),className:"px-3 py-1.5 text-sm rounded-md transition-colors ".concat("mostLiked"===C?"bg-green-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:"Most Liked"})]})]})]}),(0,a.jsxs)(p.aY,{className:"space-y-6",children:[w&&n&&(0,a.jsx)("div",{className:"border border-gray-200 rounded-lg p-4 bg-gray-50",children:(0,a.jsxs)("form",{onSubmit:P,className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Share your thoughts"}),(0,a.jsx)("textarea",{value:g,onChange:e=>j(e.target.value),placeholder:"Why do you support this petition?",rows:4,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent resize-none",disabled:x,required:!0})]}),(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("input",{type:"checkbox",id:"anonymous",checked:v,onChange:e=>N(e.target.checked),className:"mr-2"}),(0,a.jsx)("label",{htmlFor:"anonymous",className:"text-sm text-gray-600",children:"Comment anonymously"})]}),(0,a.jsxs)("div",{className:"flex gap-3",children:[(0,a.jsx)(u.z,{type:"submit",disabled:x||!g.trim(),size:"sm",children:x?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Posting..."]}):"Post Comment"}),(0,a.jsx)(u.z,{type:"button",variant:"outline",onClick:()=>{k(!1),j(""),N(!1)},size:"sm",children:"Cancel"})]})]})}),!n&&(0,a.jsxs)("div",{className:"text-center py-8 bg-gray-50 rounded-lg",children:[(0,a.jsx)("svg",{className:"w-12 h-12 mx-auto mb-4 text-gray-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})}),(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Join the Discussion"}),(0,a.jsx)("p",{className:"text-gray-600 mb-4",children:"Sign in to share your thoughts and support this petition."}),(0,a.jsx)(u.z,{asChild:!0,children:(0,a.jsx)("a",{href:"/auth/login?redirect=".concat(encodeURIComponent(window.location.pathname)),children:"Sign In to Comment"})})]}),d?(0,a.jsx)("div",{className:"space-y-4",children:[void 0,void 0,void 0].map((e,t)=>(0,a.jsx)("div",{className:"animate-pulse",children:(0,a.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,a.jsx)("div",{className:"w-10 h-10 bg-gray-200 rounded-full"}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("div",{className:"h-4 bg-gray-200 rounded w-1/4 mb-2"}),(0,a.jsx)("div",{className:"h-4 bg-gray-200 rounded w-3/4 mb-1"}),(0,a.jsx)("div",{className:"h-4 bg-gray-200 rounded w-1/2"})]})]})},t))}):0===o.length?(0,a.jsxs)("div",{className:"text-center py-8",children:[(0,a.jsx)("svg",{className:"w-12 h-12 mx-auto mb-4 text-gray-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})}),(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No comments yet"}),(0,a.jsx)("p",{className:"text-gray-600",children:"Be the first to share your thoughts on this petition."})]}):(0,a.jsx)("div",{className:"space-y-6",children:o.map(e=>(0,a.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,a.jsx)("div",{className:"w-10 h-10 bg-green-100 rounded-full flex items-center justify-center flex-shrink-0",children:(0,a.jsx)("span",{className:"text-green-600 font-medium text-sm",children:e.isAnonymous?"?":e.authorName.charAt(0).toUpperCase()})}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,a.jsx)("span",{className:"font-medium text-gray-900",children:e.authorName}),e.isAnonymous&&(0,a.jsx)("span",{className:"inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-600",children:"Anonymous"}),(0,a.jsx)("span",{className:"text-sm text-gray-500",children:T(e.createdAt)})]}),(0,a.jsx)("p",{className:"text-gray-700 whitespace-pre-wrap mb-3",children:e.content}),(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsxs)("button",{onClick:()=>M(e.id),className:"flex items-center gap-1 text-sm transition-colors ".concat(A.has(e.id)?"text-red-500 hover:text-red-600":"text-gray-500 hover:text-gray-700"),disabled:!n,children:[(0,a.jsx)("svg",{className:"w-4 h-4 ".concat(A.has(e.id)?"fill-current":""),fill:A.has(e.id)?"currentColor":"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"})}),e.likes>0&&(0,a.jsx)("span",{className:"font-medium",children:e.likes})]}),(0,a.jsx)("button",{className:"text-sm text-gray-500 hover:text-gray-700",children:"Reply"}),e.authorId===(null==n?void 0:n.uid)&&(0,a.jsx)("button",{className:"text-sm text-red-500 hover:text-red-700",children:"Delete"})]})]})]},e.id))}),o.length>0&&o.length%10==0&&(0,a.jsx)("div",{className:"text-center",children:(0,a.jsx)(u.z,{variant:"outline",size:"sm",children:"Load More Comments"})})]})]})}var N=s(5367),w=s(5531);let k=(0,w.Z)("archive",[["rect",{width:"20",height:"5",x:"2",y:"3",rx:"1",key:"1wp1u1"}],["path",{d:"M4 8v11a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8",key:"1s80jp"}],["path",{d:"M10 12h4",key:"a56b0p"}]]);var C=s(8063);function S(e){let{petition:t,onDelete:s,onArchive:i,onRequestDeletion:n}=e,[l,o]=(0,r.useState)(!1),[c,d]=(0,r.useState)(!1),[m,x]=(0,r.useState)(!1),[h,g]=(0,r.useState)(""),[j,b]=(0,r.useState)(!1),f=async()=>{try{b(!0),await s(),o(!1)}catch(e){console.error("Error deleting petition:",e),alert("Failed to delete petition. Please try again.")}finally{b(!1)}},y=async()=>{try{b(!0),await i(),d(!1)}catch(e){console.error("Error archiving petition:",e),alert("Failed to archive petition. Please try again.")}finally{b(!1)}},v=async()=>{if(!h.trim()){alert("Please provide a reason for deletion");return}try{b(!0),await n(h),x(!1),g(""),alert("Deletion request submitted. An admin will review it shortly.")}catch(e){console.error("Error requesting deletion:",e),alert("Failed to submit deletion request. Please try again.")}finally{b(!1)}},w=(()=>{let e=t.createdAt.getTime(),s=Date.now();return t.currentSignatures<=10||"pending"===t.status||(s-e)/36e5<24})();return(0,a.jsxs)(a.Fragment,{children:[l&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,a.jsxs)("div",{className:"bg-white rounded-lg max-w-md w-full p-6",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3 mb-4",children:[(0,a.jsx)("div",{className:"w-12 h-12 bg-red-100 rounded-full flex items-center justify-center",children:(0,a.jsx)(N.Z,{className:"w-6 h-6 text-red-600"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Delete Petition?"}),(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"This action cannot be undone"})]})]}),(0,a.jsx)("p",{className:"text-gray-700 mb-6",children:"Are you sure you want to permanently delete this petition? All signatures, comments, and data will be removed from public view."}),(0,a.jsxs)("div",{className:"flex gap-3 justify-end",children:[(0,a.jsx)(u.z,{variant:"outline",onClick:()=>o(!1),disabled:j,children:"Cancel"}),(0,a.jsx)(u.z,{variant:"destructive",onClick:f,disabled:j,children:j?"Deleting...":"Delete Petition"})]})]})}),c&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,a.jsxs)("div",{className:"bg-white rounded-lg max-w-md w-full p-6",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3 mb-4",children:[(0,a.jsx)("div",{className:"w-12 h-12 bg-yellow-100 rounded-full flex items-center justify-center",children:(0,a.jsx)(k,{className:"w-6 h-6 text-yellow-600"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Archive Petition?"}),(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"You can restore it later"})]})]}),(0,a.jsx)("p",{className:"text-gray-700 mb-6",children:"Archiving will hide this petition from public view, but you can restore it anytime from your dashboard. All data will be preserved."}),(0,a.jsxs)("div",{className:"flex gap-3 justify-end",children:[(0,a.jsx)(u.z,{variant:"outline",onClick:()=>d(!1),disabled:j,children:"Cancel"}),(0,a.jsx)(u.z,{className:"bg-yellow-600 hover:bg-yellow-700",onClick:y,disabled:j,children:j?"Archiving...":"Archive Petition"})]})]})}),m&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,a.jsxs)("div",{className:"bg-white rounded-lg max-w-md w-full p-6",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3 mb-4",children:[(0,a.jsx)("div",{className:"w-12 h-12 bg-orange-100 rounded-full flex items-center justify-center",children:(0,a.jsx)(C.Z,{className:"w-6 h-6 text-orange-600"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Request Deletion"}),(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"Admin will review your request"})]})]}),(0,a.jsx)("p",{className:"text-gray-700 mb-4",children:"Your petition has significant support. Please explain why you want to delete it, and an admin will review your request."}),(0,a.jsx)("textarea",{value:h,onChange:e=>g(e.target.value),placeholder:"Reason for deletion request...",rows:4,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-transparent resize-none mb-4",disabled:j}),(0,a.jsxs)("div",{className:"flex gap-3 justify-end",children:[(0,a.jsx)(u.z,{variant:"outline",onClick:()=>{x(!1),g("")},disabled:j,children:"Cancel"}),(0,a.jsx)(u.z,{className:"bg-orange-600 hover:bg-orange-700",onClick:v,disabled:j||!h.trim(),children:j?"Submitting...":"Submit Request"})]})]})}),(0,a.jsxs)(p.Zb,{className:"border-orange-200 bg-orange-50",children:[(0,a.jsx)(p.Ol,{children:(0,a.jsxs)(p.ll,{className:"text-lg flex items-center gap-2",children:[(0,a.jsx)(C.Z,{className:"w-5 h-5 text-orange-600"}),"Petition Management"]})}),(0,a.jsxs)(p.aY,{className:"space-y-3",children:[(0,a.jsx)("p",{className:"text-sm text-gray-700 mb-4",children:"As the creator, you can manage this petition."}),w?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(u.z,{variant:"destructive",onClick:()=>o(!0),className:"w-full flex items-center justify-center gap-2",children:[(0,a.jsx)(N.Z,{className:"w-4 h-4"}),"Delete Petition"]}),(0,a.jsx)("p",{className:"text-xs text-gray-600",children:"You can delete this petition because it has ≤10 signatures, is pending approval, or was created within 24 hours."})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(u.z,{className:"w-full flex items-center justify-center gap-2 bg-yellow-600 hover:bg-yellow-700",onClick:()=>d(!0),children:[(0,a.jsx)(k,{className:"w-4 h-4"}),"Archive Petition"]}),(0,a.jsxs)(u.z,{variant:"outline",onClick:()=>x(!0),className:"w-full flex items-center justify-center gap-2 border-orange-300 text-orange-700 hover:bg-orange-100",children:[(0,a.jsx)(C.Z,{className:"w-4 h-4"}),"Request Deletion"]}),(0,a.jsx)("p",{className:"text-xs text-gray-600",children:"This petition has significant support. You can archive it or request admin approval for deletion."})]})]})]})]})}let A=(0,w.Z)("plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]),D=(0,w.Z)("clock",[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);function L(e){let{petitionId:t,isCreator:i}=e,[n,l]=(0,r.useState)([]),[o,c]=(0,r.useState)(!0),[d,m]=(0,r.useState)(!1),[x,h]=(0,r.useState)({title:"",content:""}),[g,j]=(0,r.useState)(!1),[b,f]=(0,r.useState)(null),[y,v]=(0,r.useState)({title:"",content:""}),[N,w]=(0,r.useState)(null),[k,C]=(0,r.useState)(!1);(0,r.useEffect)(()=>{S()},[t]);let S=async()=>{try{let{collection:e,query:a,where:r,orderBy:i,getDocs:n}=await Promise.resolve().then(s.bind(s,5797)),{db:o}=await Promise.resolve().then(s.bind(s,6831)),c=e(o,"petitionUpdates"),d=a(c,r("petitionId","==",t),i("createdAt","desc")),m=(await n(d)).docs.map(e=>{var t;let s=e.data();return{id:e.id,...s,createdAt:(null===(t=s.createdAt)||void 0===t?void 0:t.toDate())||new Date}});l(m)}catch(e){console.error("Error fetching updates:",e)}finally{c(!1)}},L=async e=>{if(e.preventDefault(),!x.title.trim()||!x.content.trim()){alert("Please fill in all fields");return}j(!0);try{let{collection:e,addDoc:a,serverTimestamp:r}=await Promise.resolve().then(s.bind(s,5797)),{db:i,auth:n}=await Promise.resolve().then(s.bind(s,6831)),l=n.currentUser;if(!l){alert("You must be logged in to post updates");return}await a(e(i,"petitionUpdates"),{petitionId:t,title:x.title.trim(),content:x.content.trim(),createdAt:r(),createdBy:l.uid,createdByName:l.displayName||"Anonymous"}),h({title:"",content:""}),m(!1),await S()}catch(e){console.error("Error adding update:",e),alert("Failed to add update. Please try again.")}finally{j(!1)}},z=e=>{f(e.id),v({title:e.title,content:e.content})},P=async e=>{if(!y.title.trim()||!y.content.trim()){alert("Please fill in all fields");return}j(!0);try{let{doc:t,updateDoc:a,serverTimestamp:r}=await Promise.resolve().then(s.bind(s,5797)),{db:i}=await Promise.resolve().then(s.bind(s,6831)),n=t(i,"petitionUpdates",e);await a(n,{title:y.title.trim(),content:y.content.trim(),editedAt:r(),editedOnce:!0}),f(null),v({title:"",content:""}),await S()}catch(e){console.error("Error updating:",e),alert("Failed to update. Please try again.")}finally{j(!1)}},M=e=>{w(e)},T=async()=>{if(N){C(!0);try{let{doc:e,deleteDoc:t}=await Promise.resolve().then(s.bind(s,5797)),{db:a}=await Promise.resolve().then(s.bind(s,6831)),r=e(a,"petitionUpdates",N);await t(r),w(null),await S()}catch(e){console.error("Error deleting update:",e),alert("Failed to delete update. Please try again.")}finally{C(!1)}}},B=e=>new Intl.DateTimeFormat("en-US",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}).format(e);return o?(0,a.jsx)(p.Zb,{children:(0,a.jsx)(p.aY,{className:"py-8 text-center",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-green-600 mx-auto"})})}):(0,a.jsxs)(a.Fragment,{children:[N&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,a.jsxs)("div",{className:"bg-white rounded-lg max-w-md w-full p-6 shadow-xl",children:[(0,a.jsxs)("div",{className:"flex items-start mb-4",children:[(0,a.jsx)("div",{className:"flex-shrink-0 w-10 h-10 bg-red-100 rounded-full flex items-center justify-center",children:(0,a.jsx)("svg",{className:"w-6 h-6 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),(0,a.jsxs)("div",{className:"ml-4 flex-1",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Delete Update?"}),(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"Are you sure you want to delete this update? This action cannot be undone."})]})]}),(0,a.jsxs)("div",{className:"flex gap-3 justify-end",children:[(0,a.jsx)(u.z,{variant:"outline",onClick:()=>{w(null)},disabled:k,children:"Cancel"}),(0,a.jsx)(u.z,{variant:"destructive",onClick:T,disabled:k,children:k?"Deleting...":"Delete"})]})]})}),(0,a.jsx)(p.Zb,{children:(0,a.jsxs)(p.aY,{className:"p-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold text-gray-900",children:"Updates"}),i&&!d&&(0,a.jsxs)(u.z,{onClick:()=>m(!0),size:"sm",className:"flex items-center gap-2",children:[(0,a.jsx)(A,{className:"w-4 h-4"}),"Post Update"]})]}),d&&(0,a.jsxs)("form",{onSubmit:L,className:"mb-6 space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"update-title",className:"block text-sm font-medium text-gray-700 mb-1",children:"Update Title"}),(0,a.jsx)("input",{id:"update-title",type:"text",value:x.title,onChange:e=>h({...x,title:e.target.value}),placeholder:"e.g., We reached 1,000 signatures!",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500",maxLength:100,disabled:g})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"update-content",className:"block text-sm font-medium text-gray-700 mb-1",children:"Update Content"}),(0,a.jsx)("textarea",{id:"update-content",value:x.content,onChange:e=>h({...x,content:e.target.value}),placeholder:"Share progress, news, or thank supporters...",rows:4,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500",maxLength:1e3,disabled:g}),(0,a.jsxs)("p",{className:"text-xs text-gray-500 mt-1",children:[x.content.length,"/1000 characters"]})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(u.z,{type:"submit",disabled:g,children:g?"Posting...":"Post Update"}),(0,a.jsx)(u.z,{type:"button",variant:"outline",onClick:()=>{m(!1),h({title:"",content:""})},disabled:g,children:"Cancel"})]})]}),n.length>0?(0,a.jsx)("div",{className:"space-y-6",children:n.map((e,t)=>(0,a.jsxs)("div",{className:"relative",children:[t<n.length-1&&(0,a.jsx)("div",{className:"absolute left-4 top-10 bottom-0 w-0.5 bg-gray-200"}),(0,a.jsxs)("div",{className:"flex gap-4",children:[(0,a.jsx)("div",{className:"flex-shrink-0 w-8 h-8 bg-green-100 rounded-full flex items-center justify-center relative z-10",children:(0,a.jsx)(D,{className:"w-4 h-4 text-green-600"})}),(0,a.jsx)("div",{className:"flex-1 pb-6",children:b===e.id?(0,a.jsxs)("div",{className:"bg-white border border-gray-300 rounded-lg p-4 shadow-sm space-y-3",children:[(0,a.jsx)("div",{children:(0,a.jsx)("input",{type:"text",value:y.title,onChange:e=>v({...y,title:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500",maxLength:100,disabled:g})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("textarea",{value:y.content,onChange:e=>v({...y,content:e.target.value}),rows:4,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500",maxLength:1e3,disabled:g}),(0,a.jsxs)("p",{className:"text-xs text-gray-500 mt-1",children:[y.content.length,"/1000 characters"]})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(u.z,{size:"sm",onClick:()=>P(e.id),disabled:g,children:g?"Saving...":"Save Changes"}),(0,a.jsx)(u.z,{size:"sm",variant:"outline",onClick:()=>{f(null),v({title:"",content:""})},disabled:g,children:"Cancel"})]}),(0,a.jsxs)("p",{className:"text-xs text-amber-600 flex items-center gap-1",children:[(0,a.jsx)("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),"You can only edit this update once"]})]}):(0,a.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 shadow-sm",children:[(0,a.jsxs)("div",{className:"flex items-start justify-between mb-1",children:[(0,a.jsx)("h3",{className:"font-semibold text-gray-900 flex-1",children:e.title}),i&&(0,a.jsxs)("div",{className:"flex gap-1 ml-2",children:[!e.editedOnce&&(0,a.jsx)("button",{onClick:()=>z(e),className:"p-1 text-blue-600 hover:bg-blue-100 rounded transition-colors",title:"Edit update (one time only)",children:(0,a.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})}),(0,a.jsx)("button",{onClick:()=>M(e.id),className:"p-1 text-red-600 hover:bg-red-100 rounded transition-colors",title:"Delete update",children:(0,a.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]}),(0,a.jsxs)("p",{className:"text-xs text-blue-600 mb-3",children:[B(e.createdAt)," • by"," ",e.createdByName,e.editedAt&&(0,a.jsxs)("span",{className:"ml-2 text-amber-600",children:["• Edited ",B(e.editedAt)]})]}),(0,a.jsx)("p",{className:"text-gray-700 whitespace-pre-wrap",children:e.content})]})})]})]},e.id))}):(0,a.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[(0,a.jsx)("svg",{className:"w-12 h-12 mx-auto mb-4 text-gray-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 20H5a2 2 0 01-2-2V6a2 2 0 012-2h10a2 2 0 012 2v1m2 13a2 2 0 01-2-2V7m2 13a2 2 0 002-2V9a2 2 0 00-2-2h-2m-4-3H9M7 16h6M7 8h6v4H7V8z"})}),(0,a.jsx)("p",{className:"font-medium",children:"No updates yet"}),(0,a.jsx)("p",{className:"text-sm",children:i?"Post your first update to keep supporters informed":"The petition creator hasn't posted any updates"})]})]})})]})}function z(e){let{petitionId:t}=e,[s,i]=(0,r.useState)([]),[n,l]=(0,r.useState)(!0),[o,c]=(0,r.useState)(!1),[d,m]=(0,r.useState)(null),[x,h]=(0,r.useState)(!0),[u,p]=(0,r.useState)(0);(0,r.useEffect)(()=>{g()},[t]);let g=async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];try{e?c(!0):l(!0);let s=(0,f.collection)(y.db,"signatures"),a=(0,f.query)(s,(0,f.where)("petitionId","==",t),(0,f.orderBy)("signedAt","desc"),(0,f.b9)(20));e&&d&&(a=(0,f.query)(s,(0,f.where)("petitionId","==",t),(0,f.orderBy)("signedAt","desc"),(0,f.TQ)(d),(0,f.b9)(20)));let r=await (0,f.getDocs)(a);if(r.empty){h(!1);return}let n=r.docs.map(e=>{var t;let s=e.data();return{id:e.id,name:s.name||"Anonymous",location:s.location,comment:s.comment,signedAt:(null===(t=s.signedAt)||void 0===t?void 0:t.toDate())||new Date}});e?i(e=>[...e,...n]):(i(n),p(n.length)),m(r.docs[r.docs.length-1]),h(20===r.docs.length)}catch(e){console.error("Error fetching signatures:",e)}finally{l(!1),c(!1)}};return n?(0,a.jsx)("div",{className:"flex items-center justify-center py-12",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-green-600"})}):0===s.length?(0,a.jsxs)("div",{className:"text-center py-12",children:[(0,a.jsx)("svg",{className:"w-12 h-12 mx-auto mb-4 text-gray-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"})}),(0,a.jsx)("p",{className:"text-gray-500 font-medium",children:"No signatures yet"}),(0,a.jsx)("p",{className:"text-sm text-gray-400 mt-1",children:"Be the first to sign this petition!"})]}):(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("div",{className:"flex items-center justify-between mb-4",children:(0,a.jsxs)("h3",{className:"text-lg font-semibold text-gray-900",children:[s.length.toLocaleString()," Supporters"]})}),(0,a.jsx)("div",{className:"space-y-3",children:s.map(e=>(0,a.jsx)("div",{className:"bg-white border border-gray-200 rounded-lg p-4 hover:shadow-sm transition-shadow",children:(0,a.jsxs)("div",{className:"flex items-start justify-between",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("div",{className:"w-8 h-8 rounded-full bg-green-100 flex items-center justify-center",children:(0,a.jsx)("span",{className:"text-green-700 font-medium text-sm",children:e.name.charAt(0).toUpperCase()})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-medium text-gray-900",children:e.name}),e.location&&(0,a.jsx)("p",{className:"text-sm text-gray-500",children:[e.location.city,e.location.country].filter(Boolean).join(", ")})]})]}),e.comment&&(0,a.jsxs)("p",{className:"mt-2 text-sm text-gray-700 italic",children:['"',e.comment,'"']})]}),(0,a.jsx)("span",{className:"text-xs text-gray-400 whitespace-nowrap ml-4",children:e.signedAt.toLocaleDateString()})]})},e.id))}),x&&(0,a.jsx)("div",{className:"flex justify-center pt-4",children:(0,a.jsx)("button",{onClick:()=>{!o&&x&&g(!0)},disabled:o,className:"px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:o?(0,a.jsxs)("span",{className:"flex items-center gap-2",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Loading..."]}):"Load More"})})]})}let P=e=>{let[t,s]=(0,r.useState)(null),[a,i]=(0,r.useState)(!0),[n,l]=(0,r.useState)("");return(0,r.useEffect)(()=>{if(!e){i(!1);return}let t=null;return(async()=>{try{let a=e;if(e.includes("-")&&e.length<=15){console.log("\uD83D\uDD0D Looking up petition by reference code:",e);let t=(0,f.query)((0,f.collection)(y.db,"petitions"),(0,f.where)("referenceCode","==",e)),r=await (0,f.getDocs)(t);if(r.empty){console.log("❌ No petition found with reference code:",e),l("Petition not found"),s(null),i(!1);return}a=r.docs[0].id,console.log("✅ Found petition ID:",a)}let r=(0,f.doc)(y.db,"petitions",a);t=(0,f.cf)(r,e=>{if(e.exists()){var t,a,r,n;let i=e.data();s({id:e.id,...i,createdAt:(null===(a=i.createdAt)||void 0===a?void 0:null===(t=a.toDate)||void 0===t?void 0:t.call(a))||new Date,updatedAt:(null===(n=i.updatedAt)||void 0===n?void 0:null===(r=n.toDate)||void 0===r?void 0:r.call(n))||new Date}),l("")}else l("Petition not found"),s(null);i(!1)},e=>{console.error("❌ Error listening to petition:",e),l("Failed to load petition"),s(null),i(!1)})}catch(e){console.error("❌ Error setting up petition listener:",e),l("Failed to load petition"),s(null),i(!1)}})(),()=>{t&&t()}},[e]),{petition:t,loading:a,error:n}};var M=s(8452),T=s(7134),B=s(2549),Z=s(3101),E=s(2442);let U=(0,w.Z)("play",[["path",{d:"M5 5a2 2 0 0 1 3.008-1.728l11.997 6.998a2 2 0 0 1 .003 3.458l-12 7A2 2 0 0 1 5 19z",key:"10ikf1"}]]);var H=s(8892),F=s(4530);let I=(0,w.Z)("circle-x",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);function R(e){let{data:t,onClose:s}=e,r=(()=>{switch(t.type){case"approved":return{bg:"bg-green-50 border-green-200",icon:(0,a.jsx)(F.Z,{className:"w-6 h-6 text-green-600"}),iconBg:"bg-green-100",textColor:"text-green-900",titleColor:"text-green-800"};case"rejected":return{bg:"bg-red-50 border-red-200",icon:(0,a.jsx)(I,{className:"w-6 h-6 text-red-600"}),iconBg:"bg-red-100",textColor:"text-red-900",titleColor:"text-red-800"};case"paused":return{bg:"bg-orange-50 border-orange-200",icon:(0,a.jsx)(Z.Z,{className:"w-6 h-6 text-orange-600"}),iconBg:"bg-orange-100",textColor:"text-orange-900",titleColor:"text-orange-800"};case"deleted":return{bg:"bg-gray-50 border-gray-300",icon:(0,a.jsx)(N.Z,{className:"w-6 h-6 text-gray-600"}),iconBg:"bg-gray-100",textColor:"text-gray-900",titleColor:"text-gray-800"};case"archived":return{bg:"bg-blue-50 border-blue-200",icon:(0,a.jsx)(C.Z,{className:"w-6 h-6 text-blue-600"}),iconBg:"bg-blue-100",textColor:"text-blue-900",titleColor:"text-blue-800"};case"deletion_approved":return{bg:"bg-red-50 border-red-200",icon:(0,a.jsx)(F.Z,{className:"w-6 h-6 text-red-600"}),iconBg:"bg-red-100",textColor:"text-red-900",titleColor:"text-red-800"};case"deletion_denied":return{bg:"bg-yellow-50 border-yellow-200",icon:(0,a.jsx)(I,{className:"w-6 h-6 text-yellow-600"}),iconBg:"bg-yellow-100",textColor:"text-yellow-900",titleColor:"text-yellow-800"};default:return{bg:"bg-gray-50 border-gray-200",icon:(0,a.jsx)(C.Z,{className:"w-6 h-6 text-gray-600"}),iconBg:"bg-gray-100",textColor:"text-gray-900",titleColor:"text-gray-800"}}})();return(0,a.jsx)("div",{className:"relative rounded-lg border-2 ".concat(r.bg," p-4 mb-6 shadow-md animate-in slide-in-from-top duration-300"),role:"alert",children:(0,a.jsxs)("div",{className:"flex items-start gap-4",children:[(0,a.jsx)("div",{className:"flex-shrink-0 ".concat(r.iconBg," rounded-full p-2"),children:r.icon}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold ".concat(r.titleColor," mb-1"),children:t.title}),(0,a.jsx)("p",{className:"text-sm ".concat(r.textColor," mb-2"),children:t.message}),t.reason&&(0,a.jsxs)("div",{className:"mt-3 p-3 bg-white bg-opacity-60 rounded-md border border-current border-opacity-20",children:[(0,a.jsx)("p",{className:"text-xs font-medium text-gray-700 mb-1",children:"Admin's Reason:"}),(0,a.jsxs)("p",{className:"text-sm ".concat(r.textColor," italic"),children:['"',t.reason,'"']})]}),t.timestamp&&(0,a.jsx)("p",{className:"text-xs text-gray-500 mt-2",children:t.timestamp.toLocaleString()})]}),(0,a.jsx)("button",{onClick:s,className:"flex-shrink-0 text-gray-400 hover:text-gray-600 transition-colors","aria-label":"Close notification",children:(0,a.jsx)(B.Z,{className:"w-5 h-5"})})]})})}function W(){var e,t;let n=(0,i.useParams)(),o=(0,i.useRouter)(),f=(0,i.useSearchParams)(),y=null==n?void 0:n.id,{user:w,userProfile:C}=(0,b.useAuth)(),{petition:A,loading:D,error:F}=P(y),[I,W]=(0,r.useState)(!1),[q,Y]=(0,r.useState)(!1),[V,_]=(0,r.useState)(!1),[O,X]=(0,r.useState)(!1),[$,G]=(0,r.useState)(!1),[Q,J]=(0,r.useState)(null),[K,ee]=(0,r.useState)(null),[et,es]=(0,r.useState)(!1),[ea,er]=(0,r.useState)("petition"),[ei,en]=(0,r.useState)(0),el=C&&("admin"===C.role||"moderator"===C.role);(0,r.useEffect)(()=>{(async()=>{if((null==A?void 0:A.creatorId)&&!K&&!et){es(!0);try{let e=await (0,g.GA)(A.creatorId);ee(e)}catch(e){console.error("Error fetching creator:",e)}finally{es(!1)}}})()},[null==A?void 0:A.creatorId,K,et]),(0,r.useEffect)(()=>{(async()=>{if(null==A?void 0:A.id)try{let{collection:e,query:t,where:a,getCountFromServer:r}=await Promise.resolve().then(s.bind(s,5797)),{db:i}=await Promise.resolve().then(s.bind(s,6831)),n=e(i,"comments"),l=t(n,a("petitionId","==",A.id)),o=await r(l);en(o.data().count)}catch(e){console.error("Error fetching comments count:",e)}})()},[null==A?void 0:A.id]),(0,r.useEffect)(()=>{if(!A)return;let e=f.get("notif"),t=f.get("reason");if(console.log("\uD83D\uDD0D Checking for notification parameters:",{notifType:e,notifReason:t,hasSearchParams:!!f,allParams:Object.fromEntries(f.entries())}),e){console.log("✅ Found notification type:",e);let s=null;switch(e){case"approved":s={type:"approved",title:"Petition Approved!",message:"Your petition has been approved by our moderation team and is now live on the platform.",reason:t||void 0,timestamp:new Date};break;case"rejected":s={type:"rejected",title:"Petition Rejected",message:"Your petition has been rejected by our moderation team.",reason:t||void 0,timestamp:new Date};break;case"paused":s={type:"paused",title:"Petition Paused",message:"Your petition has been temporarily paused by our moderation team.",reason:t||void 0,timestamp:new Date};break;case"deleted":s={type:"deleted",title:"Petition Deleted",message:"Your petition has been removed from the platform.",reason:t||void 0,timestamp:new Date};break;case"archived":s={type:"archived",title:"Petition Archived",message:"Your petition has been archived.",reason:t||void 0,timestamp:new Date};break;case"deletion_approved":s={type:"deletion_approved",title:"Deletion Request Approved",message:"Your deletion request has been approved. The petition has been removed.",reason:t||void 0,timestamp:new Date};break;case"deletion_denied":s={type:"deletion_denied",title:"Deletion Request Denied",message:"Your deletion request has been denied by our moderation team.",reason:t||void 0,timestamp:new Date}}if(s){console.log("✅ Setting notification alert:",s),J(s);let e=window.location.pathname;window.history.replaceState({},"",e)}else console.log("❌ No alert data created for notification type:",e)}else console.log("ℹ️ No notification type found in URL")},[A,f]);let eo=async e=>{if(A&&w)try{if(X(!0),console.log("\uD83D\uDCF1 Phone verified, updating user profile...",{userId:w.uid,phoneNumber:e,currentVerifiedStatus:null==C?void 0:C.verifiedPhone}),C&&!C.verifiedPhone){let{doc:t,updateDoc:a}=await Promise.resolve().then(s.bind(s,5797)),{db:r}=await Promise.resolve().then(s.bind(s,6831));console.log("\uD83D\uDD04 Updating Firestore document..."),await a(t(r,"users",w.uid),{phone:e,verifiedPhone:!0,updatedAt:new Date}),console.log("✅ User profile updated successfully")}else console.log("ℹ️ Skipping update - already verified or no profile");await (0,g.Qq)(A.id,{name:(null==C?void 0:C.name)||w.displayName||"Anonymous",phone:e,location:{country:"Morocco"},comment:""}),W(!1),alert("شكرًا لتوقيعك على هذه العريضة!")}catch(e){console.error("Error signing petition:",e),alert(e.message||"فشل التوقيع على العريضة. يرجى المحاولة مرة أخرى.")}finally{X(!1)}},ec=()=>{_(!0)},ed=async e=>{if((0,H.fc)(C)&&A&&C){G(!0);try{await (0,g.Sp)(A.id,e,C.id);try{await (0,T.t8)(A.id,A.creatorId,A.title,e)}catch(e){console.warn("Failed to send notification, but status updated:",e)}alert("Petition ".concat(e," successfully!")),window.location.reload()}catch(e){console.error("Error updating petition:",e),alert("Error updating petition status"),G(!1)}}},em=async()=>{(0,H.fc)(C)&&confirm("Are you sure you want to archive this petition?")&&await ed("archived")},ex=async()=>{(0,H.fc)(C)&&confirm("Are you sure you want to delete this petition? This action cannot be undone.")&&await ed("deleted")},eh=async()=>{if(w&&A)try{await (0,g.Ee)(A.id,w.uid),alert("Petition deleted successfully"),o.push("/dashboard")}catch(e){console.error("Error deleting petition:",e),alert(e.message||"Failed to delete petition")}},eu=async()=>{if(w&&A)try{await (0,g.Ue)(A.id,w.uid),alert("Petition archived successfully"),o.push("/dashboard")}catch(e){console.error("Error archiving petition:",e),alert(e.message||"Failed to archive petition")}},ep=async e=>{if(w&&A)try{await (0,g.at)(A.id,w.uid,e);try{let{notifyAdminsOfDeletionRequest:t}=await Promise.resolve().then(s.bind(s,7134));await t(A.id,A.title,w.uid,e,A.currentSignatures)}catch(e){console.error("Error sending notification to admins:",e)}}catch(e){throw console.error("Error requesting deletion:",e),e}};if(D)return(0,a.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,a.jsx)(d.default,{}),(0,a.jsx)("div",{className:"flex items-center justify-center min-h-[calc(100vh-4rem)]",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-green-600"})})]});if(F||!A)return(0,a.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,a.jsx)(d.default,{}),(0,a.jsx)("div",{className:"max-w-2xl mx-auto px-4 py-12",children:(0,a.jsx)(p.Zb,{children:(0,a.jsxs)(p.aY,{className:"py-12 text-center",children:[(0,a.jsx)("div",{className:"w-16 h-16 mx-auto mb-4 bg-red-100 rounded-full flex items-center justify-center",children:(0,a.jsx)("svg",{className:"w-8 h-8 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),(0,a.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Petition Not Found"}),(0,a.jsx)("p",{className:"text-gray-600 mb-6",children:F||"The petition you are looking for does not exist."}),(0,a.jsx)(u.z,{asChild:!0,children:(0,a.jsx)(c(),{href:"/petitions",children:"Browse Petitions"})})]})})})]});let eg=(0,M.SB)(A.currentSignatures,A.targetSignatures),ej=(0,M.kC)(A.status),eb=(0,M.AN)(A.status);return(0,a.jsxs)("div",{className:"min-h-screen bg-gray-50 flex flex-col",children:[(0,a.jsx)(d.default,{}),I&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,a.jsx)("div",{className:"bg-white rounded-lg max-w-md w-full",children:(0,a.jsx)(x.Z,{onVerified:eo,onCancel:()=>W(!1)})})}),q&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,a.jsxs)("div",{className:"bg-white rounded-lg max-w-md w-full p-6",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Share QR Code"}),(0,a.jsx)("button",{onClick:()=>Y(!1),className:"text-gray-400 hover:text-gray-600 p-1",children:(0,a.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,a.jsx)(h.Z,{petition:A,size:250,branded:!0,downloadable:!0,shareable:!0})]})}),V&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,a.jsx)(j,{petition:A,onClose:()=>_(!1)})}),(0,a.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[(0,a.jsx)("div",{className:"mb-6",children:(0,a.jsxs)("nav",{className:"flex items-center space-x-2 text-sm text-gray-500",children:[(0,a.jsx)(c(),{href:"/",className:"hover:text-gray-700",children:"Home"}),(0,a.jsx)("span",{children:"/"}),(0,a.jsx)(c(),{href:"/petitions",className:"hover:text-gray-700",children:"Petitions"}),(0,a.jsx)("span",{children:"/"}),(0,a.jsx)("span",{className:"text-gray-900",children:A.title})]})}),(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-[1fr_340px] gap-8",children:[(0,a.jsxs)("div",{className:"w-full min-w-0 space-y-6",children:[Q&&(0,a.jsx)(R,{data:Q,onClose:()=>J(null)}),(0,a.jsx)(p.Zb,{className:"w-full",style:{width:"100%",maxWidth:"100%"},children:(0,a.jsxs)(p.aY,{className:"p-6",style:{width:"100%"},children:[(0,a.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-3",children:A.title}),(0,a.jsxs)("div",{className:"flex items-center gap-3 mb-6 w-full",children:[(0,a.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-".concat(ej,"-100 text-").concat(ej,"-800"),children:eb}),(0,a.jsx)("span",{className:"text-sm text-gray-500",children:A.category}),(0,a.jsx)("span",{className:"text-sm text-gray-500",children:"•"}),(0,a.jsxs)("span",{className:"text-sm text-gray-600",children:["By"," ",(0,a.jsx)("span",{className:"font-medium",children:et?"Loading...":(null==K?void 0:K.name)||"Unknown User"})]}),(0,a.jsx)("span",{className:"text-sm text-gray-500",children:"•"}),(0,a.jsx)("span",{className:"text-sm text-gray-500",children:A.createdAt.toLocaleDateString()})]}),(0,a.jsx)("div",{className:"mb-4 bg-gray-50 border border-gray-300 rounded-md p-3",children:(0,a.jsxs)("div",{className:"space-y-1.5",children:[(0,a.jsxs)("div",{className:"flex items-start",children:[(0,a.jsx)("span",{className:"text-sm font-normal text-gray-600 min-w-[90px]",children:"Publisher:"}),(0,a.jsx)("span",{className:"text-sm text-gray-900 font-medium",children:A.publisherName||(et?"Loading...":(null==K?void 0:K.name)||"Unknown User")})]}),(A.addressedToSpecific||A.addressedToType)&&(0,a.jsxs)("div",{className:"flex items-start",children:[(0,a.jsx)("span",{className:"text-sm font-normal text-gray-600 min-w-[90px]",children:"Target:"}),(0,a.jsx)("span",{className:"text-sm text-gray-900 font-medium",children:A.addressedToSpecific||A.addressedToType})]}),(0,a.jsxs)("div",{className:"flex items-start",children:[(0,a.jsx)("span",{className:"text-sm font-normal text-gray-600 min-w-[90px]",children:"Subject:"}),(0,a.jsx)("span",{className:"text-sm text-gray-900 font-medium",children:A.title})]})]})}),A.mediaUrls&&A.mediaUrls.length>0&&(0,a.jsx)("div",{className:"mb-6 space-y-4",children:A.mediaUrls.map((e,t)=>e.includes(".mp4")||e.includes(".webm")||e.includes(".ogg")||e.includes("video")?(0,a.jsxs)("video",{controls:!0,className:"w-full rounded-lg",children:[(0,a.jsx)("source",{src:e,type:"video/mp4"}),"Your browser does not support the video tag."]},t):(0,a.jsx)("div",{className:"relative w-full h-80 bg-gray-100 rounded-lg overflow-hidden",children:(0,a.jsx)(l(),{src:e,alt:A.title,fill:!0,className:"object-cover",sizes:"(max-width: 768px) 100vw, (max-width: 1200px) 66vw, 50vw"})},t))}),"rejected"===A.status&&(0,a.jsx)("div",{className:"mb-6 bg-red-50 border-l-4 border-red-500 p-4 rounded-r-lg",children:(0,a.jsxs)("div",{className:"flex items-start",children:[(0,a.jsx)("div",{className:"flex-shrink-0",children:(0,a.jsx)(B.Z,{className:"h-5 w-5 text-red-500"})}),(0,a.jsxs)("div",{className:"ml-3 flex-1",children:[(0,a.jsx)("h3",{className:"text-sm font-medium text-red-800",children:"Petition Rejected"}),(0,a.jsx)("p",{className:"mt-1 text-sm text-red-700",children:"This petition has been rejected by our moderation team and cannot accept signatures."}),(A.moderationNotes||A.resubmissionHistory&&A.resubmissionHistory.length>0)&&(0,a.jsxs)("div",{className:"mt-2 p-2 bg-red-100 rounded",children:[(0,a.jsx)("p",{className:"text-sm font-medium text-red-800",children:"Reason:"}),(0,a.jsx)("p",{className:"text-sm text-red-700",children:A.moderationNotes||(A.resubmissionHistory&&A.resubmissionHistory.length>0?A.resubmissionHistory[A.resubmissionHistory.length-1].reason:"No reason provided")})]}),w&&A.creatorId===w.uid&&3>(A.resubmissionCount||0)&&(0,a.jsx)("div",{className:"mt-3",children:(0,a.jsxs)(u.z,{size:"sm",onClick:()=>o.push("/petitions/".concat(A.id,"/edit")),className:"bg-blue-600 hover:bg-blue-700",children:["Edit & Resubmit (",3-(A.resubmissionCount||0)," attempts left)"]})}),w&&A.creatorId===w.uid&&(A.resubmissionCount||0)>=3&&(0,a.jsx)("div",{className:"mt-3",children:(0,a.jsx)("p",{className:"text-sm text-red-600 font-medium",children:"Maximum resubmission attempts reached (3/3)"})})]})]})}),"paused"===A.status&&(0,a.jsx)("div",{className:"mb-6 bg-orange-50 border-l-4 border-orange-500 p-4 rounded-r-lg",children:(0,a.jsxs)("div",{className:"flex items-start",children:[(0,a.jsx)("div",{className:"flex-shrink-0",children:(0,a.jsx)(Z.Z,{className:"h-5 w-5 text-orange-500"})}),(0,a.jsxs)("div",{className:"ml-3",children:[(0,a.jsx)("h3",{className:"text-sm font-medium text-orange-800",children:"Petition Temporarily Paused"}),(0,a.jsx)("p",{className:"mt-1 text-sm text-orange-700",children:"This petition is currently paused and cannot accept new signatures at this time. It may be under review or temporarily suspended by moderators."}),A.moderationNotes&&(0,a.jsxs)("div",{className:"mt-2 p-2 bg-orange-100 rounded",children:[(0,a.jsx)("p",{className:"text-sm font-medium text-orange-800",children:"Reason:"}),(0,a.jsx)("p",{className:"text-sm text-orange-700",children:A.moderationNotes})]})]})]})}),(0,a.jsxs)("div",{className:"mb-6 w-full",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,a.jsx)("span",{className:"text-2xl font-bold text-gray-900",children:A.currentSignatures.toLocaleString()}),(0,a.jsxs)("span",{className:"text-sm text-gray-600",children:[eg.toFixed(1),"% of"," ",A.targetSignatures.toLocaleString()," goal"]})]}),(0,a.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-4",children:(0,a.jsx)("div",{className:"h-4 rounded-full transition-all duration-300 ".concat(eg<30?"bg-gray-500":eg<60?"bg-yellow-600":"bg-blue-600"),style:{width:"".concat(Math.min(eg,100),"%")}})}),(0,a.jsx)("p",{className:"text-sm text-gray-600 mt-2",children:A.targetSignatures-A.currentSignatures>0?"".concat((A.targetSignatures-A.currentSignatures).toLocaleString()," more signatures needed"):"Goal reached! \uD83C\uDF89"})]}),(0,a.jsxs)("div",{className:"flex gap-3 mb-6 w-full",children:[(0,a.jsx)(u.z,{onClick:()=>{if(!w){o.push("/auth/login?redirect=".concat(encodeURIComponent(window.location.pathname)));return}W(!0)},disabled:"approved"!==A.status||O,className:"flex-1",children:O?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Signing..."]}):"Sign This Petition"}),(0,a.jsxs)(u.z,{variant:"outline",onClick:ec,className:"flex items-center gap-2",children:[(0,a.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.367 2.684 3 3 0 00-5.367-2.684z"})}),"Share"]}),(0,a.jsxs)(u.z,{variant:"outline",onClick:()=>Y(!0),className:"flex items-center gap-2",children:[(0,a.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v1m6 11h2m-6 0h-2v4m0-11v3m0 0h.01M12 12h4.01M16 20h4M4 12h4m12 0h.01M5 8h2a1 1 0 001-1V5a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1zm12 0h2a1 1 0 001-1V5a1 1 0 00-1-1h-2a1 1 0 00-1 1v2a1 1 0 001 1zM5 20h2a1 1 0 001-1v-2a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1z"})}),"QR Code"]})]}),(0,a.jsx)("div",{className:"border-b border-gray-200 mb-6",children:(0,a.jsxs)("nav",{className:"flex space-x-8",children:[(0,a.jsx)("button",{onClick:()=>er("petition"),className:"pb-4 px-1 border-b-2 font-medium text-sm transition-colors ".concat("petition"===ea?"border-green-600 text-green-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:"Petition"}),(0,a.jsx)("button",{onClick:()=>er("comments"),className:"pb-4 px-1 border-b-2 font-medium text-sm transition-colors relative ".concat("comments"===ea?"border-green-600 text-green-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:(0,a.jsxs)("span",{className:"flex items-center gap-2",children:["Comments",ei>0&&(0,a.jsx)("span",{className:"inline-flex items-center justify-center min-w-[20px] h-5 px-1.5 text-xs font-bold text-white bg-red-500 rounded-full",children:ei>99?"99+":ei})]})}),(0,a.jsx)("button",{onClick:()=>er("signees"),className:"pb-4 px-1 border-b-2 font-medium text-sm transition-colors ".concat("signees"===ea?"border-green-600 text-green-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:"Signees"}),(0,a.jsx)("button",{onClick:()=>er("publisher"),className:"pb-4 px-1 border-b-2 font-medium text-sm transition-colors ".concat("publisher"===ea?"border-green-600 text-green-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:"Publisher"})]})}),(0,a.jsxs)("div",{className:"min-h-[400px] w-full",children:["petition"===ea&&(0,a.jsxs)("div",{className:"space-y-6 w-full",children:[(0,a.jsxs)("div",{className:"w-full",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-3",children:"About this petition"}),(0,a.jsx)("div",{className:"text-gray-700 whitespace-pre-wrap leading-relaxed",children:A.description})]}),A.youtubeVideoUrl&&(0,a.jsx)("div",{className:"relative w-full pb-[56.25%] rounded-lg overflow-hidden",children:(0,a.jsx)("iframe",{className:"absolute top-0 left-0 w-full h-full",src:A.youtubeVideoUrl.includes("embed")?A.youtubeVideoUrl:"https://www.youtube.com/embed/".concat((null===(e=A.youtubeVideoUrl.split("v=")[1])||void 0===e?void 0:e.split("&")[0])||A.youtubeVideoUrl.split("/").pop()),title:"YouTube video",frameBorder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0})}),A.tags&&"string"==typeof A.tags&&A.tags.trim()&&(0,a.jsx)("div",{className:"flex flex-wrap gap-2",children:A.tags.split(",").map(e=>e.trim()).filter(e=>e.length>0).map((e,t)=>(0,a.jsxs)("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-gray-100 text-gray-700 hover:bg-gray-200 transition-colors",children:["#",e]},t))})]}),"publisher"===ea&&(0,a.jsxs)("div",{className:"space-y-6 w-full",children:[(0,a.jsxs)("div",{className:"flex items-start justify-between",children:[(0,a.jsxs)("div",{className:"flex items-start space-x-4 flex-1",children:[(null==K?void 0:K.photoURL)?(0,a.jsx)("div",{className:"w-16 h-16 rounded-full overflow-hidden bg-gray-200 flex-shrink-0",children:(0,a.jsx)(l(),{src:K.photoURL,alt:K.name||"User",width:64,height:64,className:"object-cover"})}):(0,a.jsx)("div",{className:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center flex-shrink-0",children:(0,a.jsx)("span",{className:"text-green-600 font-bold text-2xl",children:(null==K?void 0:null===(t=K.name)||void 0===t?void 0:t.charAt(0).toUpperCase())||"U"})}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:(null==K?void 0:K.name)||"Unknown User"}),(0,a.jsx)("p",{className:"text-sm text-gray-600 mb-2",children:null==K?void 0:K.email}),(0,a.jsx)("div",{className:"text-sm text-gray-500",children:(0,a.jsxs)("p",{children:["Member since"," ",(null==K?void 0:K.createdAt)?"string"==typeof K.createdAt?new Date(K.createdAt).toLocaleDateString():K.createdAt.toDate?K.createdAt.toDate().toLocaleDateString():new Date(K.createdAt).toLocaleDateString():"N/A"]})})]})]}),w&&A.creatorId===w.uid&&(0,a.jsx)(c(),{href:"/profile?tab=profile",children:(0,a.jsxs)(u.z,{variant:"outline",size:"sm",className:"flex items-center gap-2",children:[(0,a.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})}),"Edit Bio"]})})]}),(0,a.jsxs)("div",{className:"border-t border-gray-200 pt-4",children:[(0,a.jsx)("h4",{className:"font-medium text-gray-900 mb-2",children:"About the Publisher"}),(null==K?void 0:K.bio)?(0,a.jsx)("p",{className:"text-gray-700 whitespace-pre-wrap",children:K.bio}):(0,a.jsx)("p",{className:"text-gray-500 italic",children:w&&A.creatorId===w.uid?'You haven\'t added a bio yet. Click "Edit Bio" to add one.':"".concat((null==K?void 0:K.name)||"This user"," hasn't added a bio yet.")})]}),(A.publisherType||A.publisherName)&&(0,a.jsxs)("div",{className:"w-full bg-blue-50 border border-blue-200 rounded-lg p-4",children:[(0,a.jsx)("h3",{className:"text-base font-bold text-blue-700 mb-3",children:"Publisher Information"}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[A.publisherType&&(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-xs text-blue-700",children:"Type"}),(0,a.jsx)("p",{className:"text-sm font-medium text-blue-900",children:A.publisherType})]}),A.publisherName&&(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-xs text-blue-700",children:"Name"}),(0,a.jsx)("p",{className:"text-sm font-medium text-blue-900",children:A.publisherName})]})]})]}),(A.petitionType||A.addressedToType||A.addressedToSpecific||A.referenceCode)&&(0,a.jsxs)("div",{className:"w-full bg-purple-50 border border-purple-200 rounded-lg p-4",children:[(0,a.jsx)("h3",{className:"text-base font-bold text-purple-700 mb-3",children:"Petition Details"}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[A.petitionType&&(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-xs text-purple-700 mb-1",children:"Type"}),(0,a.jsx)("p",{className:"text-sm font-medium text-purple-900",children:A.petitionType})]}),A.addressedToType&&(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-xs text-purple-700 mb-1",children:"Addressed To"}),(0,a.jsx)("p",{className:"text-sm font-medium text-purple-900",children:A.addressedToType})]}),A.addressedToSpecific&&(0,a.jsxs)("div",{className:"col-span-1",children:[(0,a.jsx)("p",{className:"text-xs text-purple-700 mb-1",children:"Specific Target"}),(0,a.jsx)("p",{className:"text-sm font-medium text-purple-900",children:A.addressedToSpecific})]}),A.referenceCode&&(0,a.jsxs)("div",{className:A.addressedToSpecific?"":"col-start-2",children:[(0,a.jsx)("p",{className:"text-xs text-purple-700 mb-1",children:"Reference Code"}),(0,a.jsx)("p",{className:"text-lg font-bold text-purple-900 font-mono tracking-wider",children:A.referenceCode}),(0,a.jsx)("p",{className:"text-xs text-purple-600 mt-1",children:"Use this code for support inquiries"})]})]})]})]}),"comments"===ea&&(0,a.jsx)("div",{className:"w-full",children:(0,a.jsx)(v,{petitionId:A.id,onCommentsCountChange:e=>en(e)})}),"signees"===ea&&(0,a.jsx)(z,{petitionId:A.id})]})]})}),(0,a.jsx)(L,{petitionId:A.id,isCreator:(null==w?void 0:w.uid)===A.creatorId})]}),(0,a.jsxs)("div",{className:"w-full space-y-6",children:[(0,a.jsxs)(p.Zb,{children:[(0,a.jsx)(p.Ol,{children:(0,a.jsx)(p.ll,{children:"Petition Stats"})}),(0,a.jsx)(p.aY,{children:(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-gray-600",children:"Signatures"}),(0,a.jsx)("span",{className:"font-medium",children:A.currentSignatures.toLocaleString()})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-gray-600",children:"Goal"}),(0,a.jsx)("span",{className:"font-medium",children:A.targetSignatures.toLocaleString()})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-gray-600",children:"Progress"}),(0,a.jsxs)("span",{className:"font-medium",children:[eg.toFixed(1),"%"]})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-gray-600",children:"Views"}),(0,a.jsx)("span",{className:"font-medium",children:A.viewCount.toLocaleString()})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-gray-600",children:"Shares"}),(0,a.jsx)("span",{className:"font-medium",children:A.shareCount.toLocaleString()})]})]})})]}),w&&A.creatorId===w.uid&&"deleted"!==A.status&&(0,a.jsx)(S,{petition:A,onDelete:eh,onArchive:eu,onRequestDeletion:ep}),el&&A.resubmissionHistory&&A.resubmissionHistory.length>0&&(0,a.jsxs)(p.Zb,{children:[(0,a.jsx)(p.Ol,{children:(0,a.jsx)(p.ll,{className:"text-orange-600",children:"Resubmission History"})}),(0,a.jsx)(p.aY,{children:(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("p",{className:"text-sm text-gray-600",children:["This petition has been resubmitted"," ",(0,a.jsx)("strong",{children:A.resubmissionCount||0})," ","time(s)."]}),A.resubmissionHistory.map((e,t)=>(0,a.jsxs)("div",{className:"border-l-2 border-orange-300 pl-3 py-2",children:[(0,a.jsxs)("p",{className:"text-xs text-gray-500 mb-1",children:["Attempt ",t+1]}),(0,a.jsxs)("p",{className:"text-sm text-gray-700",children:[(0,a.jsx)("strong",{children:"Rejected:"})," ",new Date(e.rejectedAt).toLocaleDateString()]}),(0,a.jsxs)("p",{className:"text-sm text-gray-700",children:[(0,a.jsx)("strong",{children:"Reason:"})," ",e.reason]}),e.resubmittedAt&&(0,a.jsxs)("p",{className:"text-sm text-gray-700",children:[(0,a.jsx)("strong",{children:"Resubmitted:"})," ",new Date(e.resubmittedAt).toLocaleDateString()]})]},t))]})})]}),el&&(0,a.jsxs)(p.Zb,{children:[(0,a.jsx)(p.Ol,{children:(0,a.jsx)(p.ll,{children:"Admin Actions"})}),(0,a.jsx)(p.aY,{children:(0,a.jsxs)("div",{className:"space-y-3",children:[("pending"===A.status||"rejected"===A.status)&&(0,a.jsxs)(u.z,{onClick:()=>ed("approved"),disabled:$,className:"w-full bg-green-600 hover:bg-green-700",children:[(0,a.jsx)(E.Z,{className:"w-4 h-4 mr-2"}),"rejected"===A.status?"Approve (Reverse Rejection)":"Approve Petition"]}),("pending"===A.status||"approved"===A.status||"paused"===A.status)&&(0,a.jsxs)(u.z,{onClick:()=>ed("rejected"),disabled:$,variant:"destructive",className:"w-full",children:[(0,a.jsx)(B.Z,{className:"w-4 h-4 mr-2"}),"Reject Petition"]}),"approved"===A.status&&(0,a.jsxs)(u.z,{onClick:()=>ed("paused"),disabled:$,variant:"outline",className:"w-full",children:[(0,a.jsx)(Z.Z,{className:"w-4 h-4 mr-2"}),"Pause Petition"]}),"paused"===A.status&&(0,a.jsxs)(u.z,{onClick:()=>ed("approved"),disabled:$,className:"w-full bg-blue-600 hover:bg-blue-700",children:[(0,a.jsx)(U,{className:"w-4 h-4 mr-2"}),"Resume Petition"]}),("approved"===A.status||"paused"===A.status||"rejected"===A.status)&&(0,a.jsxs)(u.z,{onClick:em,disabled:$,variant:"outline",className:"w-full border-blue-300 text-blue-600 hover:bg-blue-50",children:[(0,a.jsx)(k,{className:"w-4 h-4 mr-2"}),"Archive Petition"]}),"archived"===A.status&&(0,a.jsxs)(u.z,{onClick:()=>ed("approved"),disabled:$,className:"w-full bg-blue-600 hover:bg-blue-700",children:[(0,a.jsx)(U,{className:"w-4 h-4 mr-2"}),"Unarchive & Approve"]}),"deleted"!==A.status&&(0,a.jsxs)(u.z,{onClick:ex,disabled:$,variant:"destructive",className:"w-full",children:[(0,a.jsx)(N.Z,{className:"w-4 h-4 mr-2"}),"Delete Petition"]})]})})]}),(0,a.jsx)("div",{onClick:()=>Y(!0),className:"cursor-pointer hover:opacity-90 transition-opacity",children:(0,a.jsx)(h.Z,{petition:A,size:200,variant:"card",branded:!1,downloadable:!0,shareable:!1})}),(0,a.jsxs)(u.z,{onClick:ec,className:"w-full bg-green-600 hover:bg-green-700 text-white",children:[(0,a.jsx)("svg",{className:"w-5 h-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.367 2.684 3 3 0 00-5.367-2.684z"})}),"Share This Petition"]})]})]})]}),(0,a.jsx)(m.Z,{})]})}},2130:function(e,t,s){"use strict";s.d(t,{Z:function(){return o}});var a=s(7437),r=s(2265),i=s(3089),n=s(6831),l=s(4867);function o(e){let{onVerified:t,onCancel:s}=e,[o,c]=(0,r.useState)(""),[d,m]=(0,r.useState)(""),[x,h]=(0,r.useState)("phone"),[u,p]=(0,r.useState)(!1),[g,j]=(0,r.useState)(""),[b,f]=(0,r.useState)(null),y=(0,r.useRef)(null);(0,r.useEffect)(()=>((()=>{try{y.current||(y.current=new l.lI(n.auth,"recaptcha-container",{size:"invisible",callback:()=>{console.log("✅ reCAPTCHA solved")},"expired-callback":()=>{console.log("⚠️ reCAPTCHA expired"),j("انتهت صلاحية التحقق. يرجى المحاولة مرة أخرى")}}))}catch(e){console.error("Error initializing reCAPTCHA:",e)}})(),()=>{if(y.current){try{y.current.clear()}catch(e){console.error("Error clearing reCAPTCHA:",e)}y.current=null}}),[]);let v=async()=>{if(!o.trim()){j("الرجاء إدخال رقم هاتف صحيح");return}let e=o.replace(/\s/g,"");if(!/^\+?[1-9]\d{1,14}$/.test(e)){j("رقم الهاتف غير صحيح. يجب أن يبدأ بـ + ورمز الدولة");return}p(!0),j("");try{if(!y.current)throw Error("reCAPTCHA not initialized");console.log("\uD83D\uDCF1 Sending SMS to:",e);let t=await (0,l.$g)(n.auth,e,y.current);f(t),h("code"),console.log("✅ SMS sent successfully")}catch(e){if(console.error("❌ Error sending SMS:",e),"auth/invalid-phone-number"===e.code?j("رقم الهاتف غير صحيح"):"auth/too-many-requests"===e.code?j("تم تجاوز عدد المحاولات. يرجى المحاولة لاحقًا"):"auth/quota-exceeded"===e.code?j("تم تجاوز حد الرسائل اليومي"):"auth/invalid-app-credential"===e.code?j("خطأ في إعدادات التحقق. يرجى التواصل مع الدعم الفني"):j("فشل إرسال رمز التحقق. يرجى المحاولة مرة أخرى"),y.current)try{y.current.clear(),y.current=new l.lI(n.auth,"recaptcha-container",{size:"invisible"})}catch(e){console.error("Error resetting reCAPTCHA:",e)}}finally{p(!1)}},N=async()=>{if(!d.trim()){j("الرجاء إدخال رمز التحقق");return}if(!b){j("خطأ في التحقق. يرجى إعادة إرسال الرمز");return}p(!0),j("");try{console.log("\uD83D\uDD0D Verifying code:",d),await b.confirm(d),console.log("✅ Phone number verified successfully"),t(o)}catch(e){console.error("❌ Error verifying code:",e),"auth/invalid-verification-code"===e.code?j("رمز التحقق غير صحيح"):"auth/code-expired"===e.code?j("انتهت صلاحية الرمز. يرجى إعادة إرسال الرمز"):j("فشل التحقق من الرمز. يرجى المحاولة مرة أخرى")}finally{p(!1)}};return(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,a.jsxs)("div",{className:"bg-white rounded-lg p-6 max-w-md w-full mx-4",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"التحقق من رقم الهاتف مطلوب"}),(0,a.jsx)("div",{id:"recaptcha-container"}),"phone"===x?(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("p",{className:"text-gray-600",children:"الرجاء إدخال رقم هاتفك للتوقيع على هذه العريضة."}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"رقم الهاتف"}),(0,a.jsx)("input",{type:"tel",value:o,onChange:e=>c(e.target.value),placeholder:"+212 6XX XXX XXX",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500",dir:"ltr"}),(0,a.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"مثال: +212612345678 أو +34613658220"})]}),g&&(0,a.jsx)("p",{className:"text-red-600 text-sm",children:g}),(0,a.jsxs)("div",{className:"flex gap-3",children:[(0,a.jsx)(i.z,{onClick:v,disabled:u,className:"flex-1",children:u?"جاري الإرسال...":"إرسال الرمز"}),(0,a.jsx)(i.z,{variant:"outline",onClick:s,disabled:u,children:"إلغاء"})]})]}):(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("p",{className:"text-gray-600",children:["أدخل الرمز المكون من 6 أرقام المرسل إلى ",o]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"رمز التحقق"}),(0,a.jsx)("input",{type:"text",value:d,onChange:e=>{m(e.target.value.replace(/\D/g,""))},placeholder:"123456",maxLength:6,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500 text-center text-lg tracking-widest",dir:"ltr"})]}),g&&(0,a.jsx)("p",{className:"text-red-600 text-sm",children:g}),(0,a.jsxs)("div",{className:"flex gap-3",children:[(0,a.jsx)(i.z,{onClick:N,disabled:u,className:"flex-1",children:u?"جاري التحقق...":"تحقق"}),(0,a.jsx)(i.z,{variant:"outline",onClick:()=>{h("phone"),m(""),j(""),f(null)},disabled:u,children:"رجوع"})]}),(0,a.jsx)("button",{onClick:v,disabled:u,className:"w-full text-sm text-green-600 hover:text-green-700 underline",children:"إعادة إرسال الرمز"})]})]})})}},2053:function(e,t,s){"use strict";s.d(t,{Z:function(){return n}});var a=s(7437);s(2265);var r=s(1396),i=s.n(r);function n(){return(0,a.jsx)("footer",{className:"bg-gray-900 text-white py-12 mt-auto",children:(0,a.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-8",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2 mb-4",children:[(0,a.jsx)("div",{className:"w-8 h-8 bg-green-600 rounded-lg flex items-center justify-center",children:(0,a.jsx)("span",{className:"text-white font-bold text-lg",children:"3"})}),(0,a.jsx)("span",{className:"text-xl font-bold",children:"3arida"})]}),(0,a.jsx)("p",{className:"text-gray-400",children:"Empowering Moroccan citizens to create change through petitions."})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"font-semibold mb-4",children:"Platform"}),(0,a.jsxs)("ul",{className:"space-y-2 text-gray-400",children:[(0,a.jsx)("li",{children:(0,a.jsx)(i(),{href:"/petitions",className:"hover:text-white",children:"Discover Petitions"})}),(0,a.jsx)("li",{children:(0,a.jsx)(i(),{href:"/petitions/create",className:"hover:text-white",children:"Start a Petition"})}),(0,a.jsx)("li",{children:(0,a.jsx)(i(),{href:"/about",className:"hover:text-white",children:"About Us"})})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"font-semibold mb-4",children:"Support"}),(0,a.jsxs)("ul",{className:"space-y-2 text-gray-400",children:[(0,a.jsx)("li",{children:(0,a.jsx)(i(),{href:"/help",className:"hover:text-white",children:"Help Center"})}),(0,a.jsx)("li",{children:(0,a.jsx)(i(),{href:"/contact",className:"hover:text-white",children:"Contact Us"})}),(0,a.jsx)("li",{children:(0,a.jsx)(i(),{href:"/guidelines",className:"hover:text-white",children:"Community Guidelines"})})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"font-semibold mb-4",children:"Legal"}),(0,a.jsxs)("ul",{className:"space-y-2 text-gray-400",children:[(0,a.jsx)("li",{children:(0,a.jsx)(i(),{href:"/privacy",className:"hover:text-white",children:"Privacy Policy"})}),(0,a.jsx)("li",{children:(0,a.jsx)(i(),{href:"/terms",className:"hover:text-white",children:"Terms of Service"})}),(0,a.jsx)("li",{children:(0,a.jsx)(i(),{href:"/cookies",className:"hover:text-white",children:"Cookie Policy"})})]})]})]}),(0,a.jsx)("div",{className:"border-t border-gray-800 mt-8 pt-8 text-center text-gray-400",children:(0,a.jsx)("p",{children:"\xa9 2024 3arida. All rights reserved. Made with ❤️ for Morocco."})})]})})}},1396:function(e,t,s){e.exports=s(8326)}},function(e){e.O(0,[4358,139,8218,7895,8326,745,9112,6691,8625,8984,9938,2971,2472,1744],function(){return e(e.s=8042)}),_N_E=e.O()}]);