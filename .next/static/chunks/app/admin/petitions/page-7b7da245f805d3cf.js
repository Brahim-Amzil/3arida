(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3283],{5531:function(e,t,r){"use strict";r.d(t,{Z:function(){return u}});var a=r(2265);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let s=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),i=e=>e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,r)=>r?r.toUpperCase():t.toLowerCase()),n=e=>{let t=i(e);return t.charAt(0).toUpperCase()+t.slice(1)},o=(...e)=>e.filter((e,t,r)=>!!e&&""!==e.trim()&&r.indexOf(e)===t).join(" ").trim(),l=e=>{for(let t in e)if(t.startsWith("aria-")||"role"===t||"title"===t)return!0};/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var d={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let c=(0,a.forwardRef)(({color:e="currentColor",size:t=24,strokeWidth:r=2,absoluteStrokeWidth:s,className:i="",children:n,iconNode:c,...u},m)=>(0,a.createElement)("svg",{ref:m,...d,width:t,height:t,stroke:e,strokeWidth:s?24*Number(r)/Number(t):r,className:o("lucide",i),...!n&&!l(u)&&{"aria-hidden":"true"},...u},[...c.map(([e,t])=>(0,a.createElement)(e,t)),...Array.isArray(n)?n:[n]])),u=(e,t)=>{let r=(0,a.forwardRef)(({className:r,...i},l)=>(0,a.createElement)(c,{ref:l,iconNode:t,className:o(`lucide-${s(n(e))}`,`lucide-${e}`,r),...i}));return r.displayName=n(e),r}},2442:function(e,t,r){"use strict";r.d(t,{Z:function(){return a}});let a=(0,r(5531).Z)("check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]])},3101:function(e,t,r){"use strict";r.d(t,{Z:function(){return a}});let a=(0,r(5531).Z)("pause",[["rect",{x:"14",y:"3",width:"5",height:"18",rx:"1",key:"kaeet6"}],["rect",{x:"5",y:"3",width:"5",height:"18",rx:"1",key:"1wsw3u"}]])},1138:function(e,t,r){"use strict";r.d(t,{Z:function(){return a}});let a=(0,r(5531).Z)("trash-2",[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]])},2549:function(e,t,r){"use strict";r.d(t,{Z:function(){return a}});let a=(0,r(5531).Z)("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]])},2865:function(e,t,r){Promise.resolve().then(r.bind(r,5946))},5946:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return N}});var a=r(7437),s=r(2265),i=r(1396),n=r.n(i),o=r(8449),l=r(7967),d=r(5671),c=r(575),u=r(6587),m=r(2442),h=r(3101),p=r(2549),x=r(1138),g=r(8121),f=r(1221),v=r(9289),j=r(5179),b=r(8063);function y(e){let{petition:t,onUpdate:r,size:i="default",layout:n="horizontal",moderatorId:o}=e,[l,d]=(0,s.useState)(""),u=async function(e){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1],s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(a&&!confirm("Are you sure you want to ".concat(e," this petition?")))return;let i="";if(s){let t="delete"===e?"Reason for deletion (required):":"Reason for ".concat(e," (optional):");if(i=prompt(t)||"","delete"===e&&!i.trim()){alert("A reason is required for deletion.");return}}d(e);try{let a=new Date,s={updatedAt:g.Timestamp.fromDate(a)};switch(e){case"approve":s.status="approved",s.approvedAt=g.Timestamp.fromDate(a);break;case"reject":s.status="rejected",s.rejectedAt=g.Timestamp.fromDate(a);break;case"pause":s.status="paused",s.pausedAt=g.Timestamp.fromDate(a);break;case"delete":s.status="deleted",s.deletedAt=g.Timestamp.fromDate(a),s.isActive=!1}if(o&&(s.moderatedBy=o),i&&(s.moderatorNotes=i),"reject"===e){let e=(t.resubmissionHistory||[]).map(e=>({rejectedAt:e.rejectedAt instanceof Date?g.Timestamp.fromDate(e.rejectedAt):e.rejectedAt,reason:e.reason,resubmittedAt:e.resubmittedAt?e.resubmittedAt instanceof Date?g.Timestamp.fromDate(e.resubmittedAt):e.resubmittedAt:null}));e.push({rejectedAt:g.Timestamp.fromDate(a),reason:i||"No reason provided",resubmittedAt:null}),s.resubmissionHistory=e}if(await (0,g.updateDoc)((0,g.doc)(f.db,"petitions",t.id),s),o){let r={approve:"petition.approved",reject:"petition.rejected",pause:"petition.paused",delete:"petition.deleted"};if(r[e])try{let a=await (0,b.GA)(o);await (0,j.Lu)({actorId:o,actorName:(null==a?void 0:a.name)||"Unknown Admin",actorEmail:(null==a?void 0:a.email)||"",actorRole:(null==a?void 0:a.role)||"admin",action:r[e],targetType:"petition",targetId:t.id,targetName:t.title,details:{oldValue:t.status,newValue:s.status,reason:i}}),console.log("✅ Audit log created successfully")}catch(e){console.error("❌ Error logging audit action:",e)}}else console.warn("⚠️ No moderatorId provided for audit logging");let n={...t,status:s.status,updatedAt:a,moderatedBy:s.moderatedBy,moderationNotes:s.moderatorNotes,isActive:void 0!==s.isActive?s.isActive:t.isActive};s.approvedAt&&(n.approvedAt=a),s.rejectedAt&&(n.rejectedAt=a),s.pausedAt&&(n.pausedAt=a),s.deletedAt&&(n.deletedAt=a);try{await (0,v.t8)(t.id,t.creatorId,t.title,s.status,i)}catch(e){console.error("Error sending notification:",e)}r&&r(n);let l="delete"===e?"deleted":"".concat(e,"d");alert("Petition ".concat(l," successfully!"))}catch(t){console.error("Error ".concat(e,"ing petition:"),t),alert("Error ".concat(e,"ing petition. Please try again."))}finally{d("")}};return(0,a.jsxs)("div",{className:"vertical"===n?"flex flex-col gap-2":"flex flex-wrap gap-2",children:[(0,a.jsxs)(c.z,{size:i,onClick:()=>u("approve"),disabled:"approve"===l||""!==l||"approved"===t.status,className:"bg-green-600 hover:bg-green-700 text-white disabled:bg-gray-300 disabled:text-gray-500",children:[(0,a.jsx)(m.Z,{className:"w-4 h-4 mr-2"}),"approve"===l?"Approving...":"Approve"]}),(0,a.jsxs)(c.z,{size:i,onClick:()=>u("pause",!1,!0),disabled:"pause"===l||""!==l||"paused"===t.status||"deleted"===t.status,variant:"outline",className:"text-orange-600 border-orange-300 hover:bg-orange-50 disabled:text-gray-500 disabled:border-gray-300",children:[(0,a.jsx)(h.Z,{className:"w-4 h-4 mr-2"}),"pause"===l?"Pausing...":"Pause"]}),(0,a.jsxs)(c.z,{size:i,onClick:()=>u("reject",!0,!0),disabled:"reject"===l||""!==l||"rejected"===t.status||"deleted"===t.status,variant:"destructive",className:"disabled:bg-gray-300 disabled:text-gray-500",children:[(0,a.jsx)(p.Z,{className:"w-4 h-4 mr-2"}),"reject"===l?"Rejecting...":"Reject"]}),(0,a.jsxs)(c.z,{size:i,onClick:()=>u("delete",!0,!0),disabled:"delete"===l||""!==l||"deleted"===t.status,variant:"outline",className:"text-red-600 border-red-300 hover:bg-red-50 disabled:text-gray-500 disabled:border-gray-300",children:[(0,a.jsx)(x.Z,{className:"w-4 h-4 mr-2"}),"delete"===l?"Deleting...":"Delete"]}),l&&(0,a.jsxs)("div",{className:"flex items-center text-sm text-gray-600 mt-2",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-green-600 mr-2"}),"Processing..."]})]})}function N(){let{user:e,userProfile:t,loading:i,hasRequiredRole:m}=(0,u.u2)(),[h,p]=(0,s.useState)([]),[x,v]=(0,s.useState)([]),[j,b]=(0,s.useState)(!0),[N,w]=(0,s.useState)(""),[A,k]=(0,s.useState)("pending"),[C,D]=(0,s.useState)(""),[L,R]=(0,s.useState)("all"),[z,M]=(0,s.useState)(1),[E]=(0,s.useState)(10),[S,P]=(0,s.useState)([]),[q,B]=(0,s.useState)(0);(0,s.useEffect)(()=>{!i&&m&&(T(),U())},[i,m]),(0,s.useEffect)(()=>{x.length>0&&Z(x,A,C,L)},[A,C,L]),(0,s.useEffect)(()=>{M(1)},[A,C,L]);let Z=(e,t,r,a)=>{let s=e;if("all"!==t&&(s=s.filter(e=>e.status===t)),"all"!==a&&(s=s.filter(e=>e.category===a)),r.trim()){let e=r.toLowerCase(),t=r.toUpperCase();s=s.filter(r=>{var a,s;return r.title.toLowerCase().includes(e)||r.description.toLowerCase().includes(e)||r.category.toLowerCase().includes(e)||(null===(a=r.publisherName)||void 0===a?void 0:a.toLowerCase().includes(e))||(null===(s=r.referenceCode)||void 0===s?void 0:s.toUpperCase().includes(t))})}p(s)},T=async()=>{try{b(!0),w("");let e=(0,g.collection)(f.db,"petitions"),t=(0,g.query)(e,(0,g.orderBy)("createdAt","desc")),r=await (0,g.getDocs)(t),a=[];r.forEach(e=>{var t,r,s,i;let n=e.data(),o={id:e.id,...n,createdAt:(null===(r=n.createdAt)||void 0===r?void 0:null===(t=r.toDate)||void 0===t?void 0:t.call(r))||new Date,updatedAt:(null===(i=n.updatedAt)||void 0===i?void 0:null===(s=i.toDate)||void 0===s?void 0:s.call(i))||new Date};a.push(o)}),v(a),Z(a,A,C,L)}catch(e){console.error("Error loading petitions:",e),w("Failed to load petitions")}finally{b(!1)}},U=async()=>{try{let e=(0,g.collection)(f.db,"deletionRequests"),t=(0,g.query)(e,(0,g.where)("status","==","pending"),(0,g.orderBy)("createdAt","desc")),r=await (0,g.getDocs)(t),a=[];r.forEach(e=>{var t,r;a.push({id:e.id,...e.data(),createdAt:(null===(r=e.data().createdAt)||void 0===r?void 0:null===(t=r.toDate)||void 0===t?void 0:t.call(r))||new Date})}),P(a),B(a.length)}catch(e){console.error("Error loading deletion requests:",e)}},I=async(e,a)=>{if(confirm("Approve this deletion request? The petition will be deleted."))try{let{updateDoc:s,doc:i,Timestamp:n,getDoc:o}=await Promise.resolve().then(r.bind(r,8121)),{notifyDeletionRequestApproved:l}=await Promise.resolve().then(r.bind(r,9289)),d=(await o(i(f.db,"petitions",a))).data();if(await s(i(f.db,"petitions",a),{status:"deleted",deletedAt:n.now(),deletedBy:null==t?void 0:t.id}),await s(i(f.db,"deletionRequests",e),{status:"approved",approvedAt:n.now(),approvedBy:null==t?void 0:t.id}),null==d?void 0:d.publisherId)try{await l(d.publisherId,d.title,a)}catch(e){console.error("Error sending notification:",e)}alert("Deletion request approved"),U(),T()}catch(e){console.error("Error approving deletion:",e),alert("Failed to approve deletion request")}},V=async e=>{let a=prompt("Reason for denying this deletion request (optional):");if(null!==a)try{let{updateDoc:s,doc:i,Timestamp:n,getDoc:o}=await Promise.resolve().then(r.bind(r,8121)),{notifyDeletionRequestDenied:l}=await Promise.resolve().then(r.bind(r,9289)),d=(await o(i(f.db,"deletionRequests",e))).data();if(await s(i(f.db,"deletionRequests",e),{status:"denied",deniedAt:n.now(),deniedBy:null==t?void 0:t.id,denialReason:a||"No reason provided"}),null==d?void 0:d.creatorId)try{await l(d.creatorId,d.petitionTitle,d.petitionId,a||"No reason provided")}catch(e){console.error("Error sending notification:",e)}alert("Deletion request denied"),U()}catch(e){console.error("Error denying deletion:",e),alert("Failed to deny deletion request")}};return i?(0,a.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,a.jsx)(o.default,{}),(0,a.jsx)("div",{className:"flex items-center justify-center min-h-[calc(100vh-4rem)]",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-green-600"})})]}):m?(0,a.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,a.jsx)(o.default,{}),(0,a.jsx)(l.Z,{}),(0,a.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[(0,a.jsxs)("div",{className:"mb-8",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Petition Moderation"}),(0,a.jsx)("p",{className:"text-lg text-gray-600",children:"Review and manage petitions on the platform"})]}),(0,a.jsx)("div",{className:"mb-6",children:(0,a.jsxs)("div",{className:"flex gap-4",children:[(0,a.jsxs)("div",{className:"flex-1 relative",children:[(0,a.jsx)("input",{type:"text",placeholder:"Search by title, description, category, publisher, or reference code (e.g., AB1234)...",value:C,onChange:e=>D(e.target.value),className:"w-full px-4 py-2 pl-10 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500"}),(0,a.jsx)("svg",{className:"absolute left-3 top-2.5 w-5 h-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})]}),(0,a.jsxs)("select",{value:L,onChange:e=>R(e.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500",children:[(0,a.jsx)("option",{value:"all",children:"All Categories"}),Array.from(new Set(x.map(e=>e.category))).sort().map(e=>(0,a.jsx)("option",{value:e,children:e},e))]}),(C||"all"!==L)&&(0,a.jsx)(c.z,{variant:"outline",onClick:()=>{D(""),R("all")},children:"Clear"})]})}),(0,a.jsx)("div",{className:"mb-6",children:(0,a.jsx)("div",{className:"border-b border-gray-200",children:(0,a.jsx)("nav",{className:"-mb-px flex space-x-8",children:[{key:"pending",label:"Pending Review",count:x.filter(e=>"pending"===e.status).length},{key:"approved",label:"Approved",count:x.filter(e=>"approved"===e.status).length},{key:"rejected",label:"Rejected",count:x.filter(e=>"rejected"===e.status).length},{key:"paused",label:"Paused",count:x.filter(e=>"paused"===e.status).length},{key:"archived",label:"Archived",count:x.filter(e=>"archived"===e.status).length},{key:"deleted",label:"Deleted",count:x.filter(e=>"deleted"===e.status).length},{key:"deletion-requests",label:"Deletion Requests",count:q},{key:"all",label:"All Petitions",count:x.length}].map(e=>(0,a.jsxs)("button",{onClick:()=>k(e.key),className:"py-2 px-1 border-b-2 font-medium text-sm ".concat(A===e.key?"border-green-500 text-green-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:[e.label,!j&&(0,a.jsx)("span",{className:"ml-2 bg-gray-100 text-gray-900 py-0.5 px-2.5 rounded-full text-xs",children:e.count})]},e.key))})})}),j?(0,a.jsx)("div",{className:"space-y-4",children:[void 0,void 0,void 0].map((e,t)=>(0,a.jsx)(d.Zb,{children:(0,a.jsx)(d.aY,{className:"p-6",children:(0,a.jsxs)("div",{className:"animate-pulse",children:[(0,a.jsx)("div",{className:"h-4 bg-gray-200 rounded mb-2"}),(0,a.jsx)("div",{className:"h-4 bg-gray-200 rounded w-3/4 mb-4"}),(0,a.jsx)("div",{className:"h-3 bg-gray-200 rounded w-1/2"})]})})},t))}):N?(0,a.jsxs)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6",children:[(0,a.jsx)("p",{className:"text-red-600",children:N}),(0,a.jsx)(c.z,{onClick:T,className:"mt-4",variant:"outline",children:"Try Again"})]}):"deletion-requests"===A?0===S.length?(0,a.jsx)(d.Zb,{children:(0,a.jsxs)(d.aY,{className:"py-12 text-center",children:[(0,a.jsx)("div",{className:"w-16 h-16 mx-auto mb-4 bg-gray-100 rounded-full flex items-center justify-center",children:(0,a.jsx)("svg",{className:"w-8 h-8 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})}),(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No deletion requests"}),(0,a.jsx)("p",{className:"text-gray-600",children:"There are no pending deletion requests at this time."})]})}):(0,a.jsx)("div",{className:"space-y-4",children:S.map(e=>(0,a.jsx)(d.Zb,{className:"border-orange-200 bg-orange-50",children:(0,a.jsx)(d.aY,{className:"p-6",children:(0,a.jsxs)("div",{className:"flex items-start justify-between",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:e.petitionTitle}),(0,a.jsxs)("div",{className:"space-y-2 text-sm text-gray-600",children:[(0,a.jsxs)("p",{children:[(0,a.jsx)("span",{className:"font-medium",children:"Petition ID:"})," ",e.petitionId]}),(0,a.jsxs)("p",{children:[(0,a.jsx)("span",{className:"font-medium",children:"Current Signatures:"})," ",e.currentSignatures]}),(0,a.jsxs)("p",{children:[(0,a.jsx)("span",{className:"font-medium",children:"Requested:"})," ",e.createdAt.toLocaleDateString()]}),(0,a.jsxs)("div",{className:"mt-3 p-3 bg-white rounded border border-orange-200",children:[(0,a.jsx)("p",{className:"font-medium text-gray-900 mb-1",children:"Reason:"}),(0,a.jsx)("p",{className:"text-gray-700",children:e.reason})]})]})]}),(0,a.jsxs)("div",{className:"ml-4 flex flex-col gap-2",children:[(0,a.jsx)(c.z,{onClick:()=>I(e.id,e.petitionId),className:"bg-red-600 hover:bg-red-700",size:"sm",children:"Approve Deletion"}),(0,a.jsx)(c.z,{onClick:()=>V(e.id),variant:"outline",size:"sm",children:"Deny Request"}),(0,a.jsx)(c.z,{asChild:!0,variant:"outline",size:"sm",children:(0,a.jsx)(n(),{href:"/petitions/".concat(e.petitionId),children:"View Petition"})})]})]})})},e.id))}):0===h.length?(0,a.jsx)(d.Zb,{children:(0,a.jsxs)(d.aY,{className:"py-12 text-center",children:[(0,a.jsx)("div",{className:"w-16 h-16 mx-auto mb-4 bg-gray-100 rounded-full flex items-center justify-center",children:(0,a.jsx)("svg",{className:"w-8 h-8 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})}),(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No petitions found"}),(0,a.jsx)("p",{className:"text-gray-600",children:C||"all"!==L?"No petitions match your search criteria.":"pending"===A?"No petitions are pending review.":"No ".concat(A," petitions found.")})]})}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"space-y-6",children:h.slice((z-1)*E,z*E).map(e=>(0,a.jsx)(d.Zb,{children:(0,a.jsx)(d.aY,{className:"p-6",children:(0,a.jsxs)("div",{className:"flex gap-6",children:[(0,a.jsx)("div",{className:"flex-shrink-0",children:e.mediaUrls&&e.mediaUrls.length>0?(0,a.jsx)("img",{src:e.mediaUrls[0],alt:e.title,className:"w-48 h-32 object-cover rounded-lg"}):(0,a.jsx)("div",{className:"w-48 h-32 bg-gray-100 rounded-lg flex items-center justify-center",children:(0,a.jsx)("svg",{className:"w-12 h-12 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})})})}),(0,a.jsx)("div",{className:"flex-1 min-w-0",children:(0,a.jsxs)("div",{className:"flex items-start justify-between",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,a.jsx)(n(),{href:"/admin/petitions/".concat(e.id),children:(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900 hover:text-green-600 cursor-pointer",children:e.title})}),(0,a.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat("pending"===e.status?"bg-yellow-100 text-yellow-800":"approved"===e.status?"bg-green-100 text-green-800":"paused"===e.status?"bg-red-100 text-red-800":"deleted"===e.status?"bg-gray-800 text-white":"bg-gray-100 text-gray-800"),children:e.status})]}),(0,a.jsx)("p",{className:"text-gray-600 mb-4 line-clamp-2",children:e.description}),(0,a.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm text-gray-500",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"font-medium",children:"Category:"}),(0,a.jsx)("br",{}),e.category]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"font-medium",children:"Signatures:"}),(0,a.jsx)("br",{}),e.currentSignatures," /"," ",e.targetSignatures]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"font-medium",children:"Created:"}),(0,a.jsx)("br",{}),e.createdAt.toLocaleDateString()]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"font-medium",children:"Tier:"}),(0,a.jsx)("br",{}),e.pricingTier]})]}),e.moderationNotes&&(0,a.jsx)("div",{className:"mt-4 p-3 bg-blue-50 border border-blue-200 rounded-md",children:(0,a.jsxs)("p",{className:"text-sm text-blue-800",children:[(0,a.jsx)("span",{className:"font-medium",children:"Moderator Notes:"})," ",e.moderationNotes]})}),"rejected"===e.status&&e.resubmissionHistory&&e.resubmissionHistory.length>0&&(0,a.jsxs)("div",{className:"mt-4 p-3 bg-red-50 border border-red-200 rounded-md",children:[(0,a.jsxs)("p",{className:"text-sm font-medium text-red-800 mb-2",children:["Rejection History (",e.resubmissionCount||0," ","resubmission",1!==(e.resubmissionCount||0)?"s":"","):"]}),(0,a.jsx)("div",{className:"space-y-2",children:e.resubmissionHistory.map((e,t)=>(0,a.jsxs)("div",{className:"text-xs text-red-700 border-l-2 border-red-300 pl-2",children:[(0,a.jsx)("p",{children:(0,a.jsxs)("strong",{children:["Attempt ",t+1,":"]})}),(0,a.jsxs)("p",{children:["Rejected:"," ",e.rejectedAt instanceof Date?e.rejectedAt.toLocaleDateString():new Date(e.rejectedAt).toLocaleDateString()]}),(0,a.jsxs)("p",{children:["Reason: ",e.reason]}),e.resubmittedAt&&(0,a.jsxs)("p",{children:["Resubmitted:"," ",e.resubmittedAt instanceof Date?e.resubmittedAt.toLocaleDateString():new Date(e.resubmittedAt).toLocaleDateString()]})]},t))})]})]}),(0,a.jsxs)("div",{className:"ml-6 flex flex-col gap-2",children:[(0,a.jsx)(c.z,{size:"sm",variant:"outline",asChild:!0,children:(0,a.jsx)(n(),{href:"/admin/petitions/".concat(e.id),children:"Review"})}),(0,a.jsx)(y,{petition:e,onUpdate:t=>{p(r=>r.map(r=>r.id===e.id?t:r)),"all"!==A&&t.status!==e.status&&T()},size:"sm",layout:"vertical",moderatorId:null==t?void 0:t.id})]})]})})]})})},e.id))}),h.length>E&&(0,a.jsxs)("div",{className:"mt-6 flex items-center justify-between border-t border-gray-200 pt-6",children:[(0,a.jsxs)("div",{className:"text-sm text-gray-700",children:["Showing"," ",(0,a.jsx)("span",{className:"font-medium",children:(z-1)*E+1})," ","to"," ",(0,a.jsx)("span",{className:"font-medium",children:Math.min(z*E,h.length)})," ","of ",(0,a.jsx)("span",{className:"font-medium",children:h.length})," ","results"]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsxs)(c.z,{variant:"outline",size:"sm",onClick:()=>M(e=>Math.max(1,e-1)),disabled:1===z,children:[(0,a.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})}),"Previous"]}),(0,a.jsx)("div",{className:"flex gap-1",children:Array.from({length:Math.ceil(h.length/E)},(e,t)=>t+1).filter(e=>{let t=Math.ceil(h.length/E);return 1===e||e===t||e>=z-1&&e<=z+1}).map((e,t,r)=>(0,a.jsxs)(s.Fragment,{children:[t>0&&r[t-1]!==e-1&&(0,a.jsx)("span",{className:"px-2 py-1 text-gray-500",children:"..."}),(0,a.jsx)(c.z,{variant:z===e?"default":"outline",size:"sm",onClick:()=>M(e),className:z===e?"bg-green-600 hover:bg-green-700":"",children:e})]},e))}),(0,a.jsxs)(c.z,{variant:"outline",size:"sm",onClick:()=>M(e=>Math.min(Math.ceil(h.length/E),e+1)),disabled:z===Math.ceil(h.length/E),children:["Next",(0,a.jsx)("svg",{className:"w-4 h-4 ml-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})]})]})]})]})]})]}):null}},7967:function(e,t,r){"use strict";r.d(t,{Z:function(){return o}});var a=r(7437),s=r(1396),i=r.n(s),n=r(4033);function o(){let e=(0,n.usePathname)(),t=[{name:"Dashboard",href:"/admin",icon:(0,a.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"})})},{name:"Petitions",href:"/admin/petitions",icon:(0,a.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})},{name:"Users",href:"/admin/users",icon:(0,a.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"})})},{name:"Moderators",href:"/admin/moderators",icon:(0,a.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"})})},{name:"Activity",href:"/admin/activity",icon:(0,a.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"})})},{name:"Analytics",href:"/admin/analytics",icon:(0,a.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})})}],r=t=>"/admin"===t?"/admin"===e:e.startsWith(t);return(0,a.jsx)("div",{className:"border-b border-gray-200 bg-white mb-8",children:(0,a.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,a.jsx)("nav",{className:"flex space-x-8 overflow-x-auto","aria-label":"Admin Navigation",children:t.map(e=>{let t=r(e.href);return(0,a.jsxs)(i(),{href:e.href,className:"\n                  flex items-center gap-2 py-4 px-1 border-b-2 font-medium text-sm whitespace-nowrap transition-colors\n                  ".concat(t?"border-green-600 text-green-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300","\n                "),children:[e.icon,e.name]},e.name)})})})})}},3525:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return c},useAuth:function(){return d}});var a=r(7437),s=r(2265),i=r(7065),n=r(8121),o=r(1221);let l=(0,s.createContext)({user:null,userProfile:null,loading:!0,isAuthenticated:!1}),d=()=>{let e=(0,s.useContext)(l);if(!e)throw Error("useAuth must be used within an AuthProvider");return e};function c(e){let{children:t}=e,[r,d]=(0,s.useState)(null),[c,u]=(0,s.useState)(null),[m,h]=(0,s.useState)(!0);return(0,s.useEffect)(()=>{let e=null,t=(0,i.Aj)(o.auth,async t=>{if(console.log("\uD83D\uDD10 Auth state changed:",t?"User logged in":"User logged out"),d(t),h(!1),e&&(e(),e=null),t){let r=(0,n.doc)(o.db,"users",t.uid);e=(0,n.cf)(r,async e=>{if(e.exists()){var r,a,s,i,n,l,d,c;let m=e.data();if(console.log("\uD83D\uDC64 User profile updated from Firestore",{hasBio:!!m.bio,bio:m.bio,isActive:m.isActive}),!1===m.isActive){console.warn("⚠️ User account is inactive, logging out..."),await o.auth.signOut(),window.location.href="/auth/login?error=account-inactive";return}u({id:t.uid,name:m.name||t.displayName||"",email:m.email||t.email||"",phone:m.phone,photoURL:m.photoURL||t.photoURL,bio:m.bio,verifiedEmail:m.verifiedEmail||t.emailVerified||!1,verifiedPhone:m.verifiedPhone||!1,role:m.role||"user",creatorPageId:m.creatorPageId,fcmToken:m.fcmToken,fcmTokenUpdatedAt:null===(a=m.fcmTokenUpdatedAt)||void 0===a?void 0:null===(r=a.toDate)||void 0===r?void 0:r.call(a),createdAt:(null===(i=m.createdAt)||void 0===i?void 0:null===(s=i.toDate)||void 0===s?void 0:s.call(i))||new Date,updatedAt:null===(l=m.updatedAt)||void 0===l?void 0:null===(n=l.toDate)||void 0===n?void 0:n.call(l),lastLoginAt:null===(c=m.lastLoginAt)||void 0===c?void 0:null===(d=c.toDate)||void 0===d?void 0:d.call(c),isActive:!1!==m.isActive})}else u({id:t.uid,name:t.displayName||"",email:t.email||"",verifiedEmail:t.emailVerified,verifiedPhone:!1,role:"user",isActive:!0,createdAt:new Date})},e=>{console.error("Error listening to user profile:",e),u({id:t.uid,name:t.displayName||"",email:t.email||"",verifiedEmail:t.emailVerified,verifiedPhone:!1,role:"user",isActive:!0,createdAt:new Date})})}else u(null)});return()=>{t(),e&&e()}},[]),(0,a.jsx)(l.Provider,{value:{user:r,userProfile:c,loading:m,isAuthenticated:!!r},children:t})}},5671:function(e,t,r){"use strict";r.d(t,{Ol:function(){return o},Zb:function(){return n},aY:function(){return d},ll:function(){return l}});var a=r(7437),s=r(2265),i=r(2169);let n=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)("div",{ref:t,className:(0,i.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",r),...s})});n.displayName="Card";let o=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)("div",{ref:t,className:(0,i.cn)("flex flex-col space-y-1.5 p-6",r),...s})});o.displayName="CardHeader";let l=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)("h3",{ref:t,className:(0,i.cn)("text-2xl font-semibold leading-none tracking-tight",r),...s})});l.displayName="CardTitle",s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)("p",{ref:t,className:(0,i.cn)("text-sm text-muted-foreground",r),...s})}).displayName="CardDescription";let d=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)("div",{ref:t,className:(0,i.cn)("p-6 pt-0",r),...s})});d.displayName="CardContent",s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)("div",{ref:t,className:(0,i.cn)("flex items-center p-6 pt-0",r),...s})}).displayName="CardFooter"},6587:function(e,t,r){"use strict";r.d(t,{Rc:function(){return l},fc:function(){return u},u2:function(){return d},xw:function(){return n}}),r(7437);var a=r(2265),s=r(4033),i=r(3525);let n=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"/auth/login",{user:t,loading:r}=(0,i.useAuth)(),n=(0,s.useRouter)();return(0,a.useEffect)(()=>{if(!r&&!t){let t=window.location.pathname,r="".concat(e,"?redirect=").concat(encodeURIComponent(t));n.push(r)}},[t,r,n,e]),{user:t,loading:r,isAuthenticated:!!t}},o=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"/dashboard",{user:r,userProfile:n,loading:o}=(0,i.useAuth)(),l=(0,s.useRouter)();return(0,a.useEffect)(()=>{if(!o){if(r)n&&!e.includes(n.role)&&l.push(t);else{let e=window.location.pathname,t="/auth/login?redirect=".concat(encodeURIComponent(e));l.push(t)}}},[r,n,o,l,e,t]),{user:r,userProfile:n,loading:o,isAuthenticated:!!r,hasRequiredRole:!!n&&e.includes(n.role)}},l=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"/dashboard";return o(["admin"],e)},d=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"/dashboard";return o(["moderator","admin"],e)},c=(e,t)=>!!e&&t.includes(e.role),u=e=>c(e,["moderator","admin"])},1396:function(e,t,r){e.exports=r(5250)},4033:function(e,t,r){e.exports=r(5313)}},function(e){e.O(0,[4358,139,8218,7895,5250,6289,1094,5748,2971,4938,1744],function(){return e(e.s=2865)}),_N_E=e.O()}]);