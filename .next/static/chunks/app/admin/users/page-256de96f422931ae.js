(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[674],{673:function(e,t,r){Promise.resolve().then(r.bind(r,4882))},4882:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return x}});var s=r(7437),a=r(2265),i=r(1396),n=r.n(i),l=r(1069),d=r(5671),c=r(575),o=r(6587),u=r(8121),m=r(1221);function x(){let{user:e,userProfile:t,loading:r,hasRequiredRole:i}=(0,o.Rc)(),[x,h]=(0,a.useState)([]),[v,g]=(0,a.useState)(!0),[f,p]=(0,a.useState)(""),[b,j]=(0,a.useState)("all"),[y,N]=(0,a.useState)("");(0,a.useEffect)(()=>{!r&&i&&w()},[r,i,b]);let w=async()=>{try{let e;g(!0),p("");let t=(0,u.collection)(m.db,"users");switch(b){case"active":e=(0,u.query)(t,(0,u.where)("isActive","==",!0),(0,u.orderBy)("createdAt","desc"));break;case"inactive":e=(0,u.query)(t,(0,u.where)("isActive","==",!1),(0,u.orderBy)("createdAt","desc"));break;case"moderators":e=(0,u.query)(t,(0,u.where)("role","in",["moderator","admin"]),(0,u.orderBy)("createdAt","desc"));break;default:e=(0,u.query)(t,(0,u.orderBy)("createdAt","desc"))}let r=await (0,u.getDocs)(e),s=[];r.forEach(e=>{var t,r,a,i,n,l;let d=e.data(),c={id:e.id,...d,createdAt:(null===(r=d.createdAt)||void 0===r?void 0:null===(t=r.toDate)||void 0===t?void 0:t.call(r))||new Date,updatedAt:(null===(i=d.updatedAt)||void 0===i?void 0:null===(a=i.toDate)||void 0===a?void 0:a.call(i))||new Date,lastLoginAt:null===(l=d.lastLoginAt)||void 0===l?void 0:null===(n=l.toDate)||void 0===n?void 0:n.call(l)};s.push(c)}),h(s)}catch(e){console.error("Error loading users:",e),p("Failed to load users")}finally{g(!1)}},A=async(e,r)=>{if(t)try{N(e);let t=(0,u.doc)(m.db,"users",e),s={updatedAt:new Date};switch(r){case"activate":s.isActive=!0;break;case"deactivate":s.isActive=!1;break;case"promote":s.role="moderator";break;case"demote":s.role="user"}await (0,u.updateDoc)(t,s),h(t=>t.map(t=>t.id===e?{...t,...s}:t)),"all"!==b&&w()}catch(e){console.error("Error ".concat(r,"ing user:"),e),alert("Failed to ".concat(r," user. Please try again."))}finally{N("")}};return r?(0,s.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,s.jsx)(l.Z,{}),(0,s.jsx)("div",{className:"flex items-center justify-center min-h-[calc(100vh-4rem)]",children:(0,s.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-green-600"})})]}):i?(0,s.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,s.jsx)(l.Z,{}),(0,s.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[(0,s.jsxs)("div",{className:"mb-8",children:[(0,s.jsx)("div",{className:"flex items-center gap-4 mb-4",children:(0,s.jsx)(c.z,{variant:"outline",asChild:!0,children:(0,s.jsxs)(n(),{href:"/admin",children:[(0,s.jsx)("svg",{className:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})}),"Back to Dashboard"]})})}),(0,s.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"User Management"}),(0,s.jsx)("p",{className:"text-lg text-gray-600",children:"Manage user accounts and permissions"})]}),(0,s.jsx)("div",{className:"mb-6",children:(0,s.jsx)("div",{className:"border-b border-gray-200",children:(0,s.jsx)("nav",{className:"-mb-px flex space-x-8",children:[{key:"all",label:"All Users",count:x.length},{key:"active",label:"Active",count:x.filter(e=>e.isActive).length},{key:"inactive",label:"Inactive",count:x.filter(e=>!e.isActive).length},{key:"moderators",label:"Staff",count:x.filter(e=>["moderator","admin"].includes(e.role)).length}].map(e=>(0,s.jsxs)("button",{onClick:()=>j(e.key),className:"py-2 px-1 border-b-2 font-medium text-sm ".concat(b===e.key?"border-green-500 text-green-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:[e.label,!v&&(0,s.jsx)("span",{className:"ml-2 bg-gray-100 text-gray-900 py-0.5 px-2.5 rounded-full text-xs",children:e.count})]},e.key))})})}),v?(0,s.jsx)("div",{className:"space-y-4",children:[void 0,void 0,void 0,void 0,void 0].map((e,t)=>(0,s.jsx)(d.Zb,{children:(0,s.jsx)(d.aY,{className:"p-6",children:(0,s.jsxs)("div",{className:"animate-pulse",children:[(0,s.jsx)("div",{className:"h-4 bg-gray-200 rounded mb-2"}),(0,s.jsx)("div",{className:"h-4 bg-gray-200 rounded w-3/4 mb-4"}),(0,s.jsx)("div",{className:"h-3 bg-gray-200 rounded w-1/2"})]})})},t))}):f?(0,s.jsxs)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6",children:[(0,s.jsx)("p",{className:"text-red-600",children:f}),(0,s.jsx)(c.z,{onClick:w,className:"mt-4",variant:"outline",children:"Try Again"})]}):0===x.length?(0,s.jsx)(d.Zb,{children:(0,s.jsxs)(d.aY,{className:"py-12 text-center",children:[(0,s.jsx)("div",{className:"w-16 h-16 mx-auto mb-4 bg-gray-100 rounded-full flex items-center justify-center",children:(0,s.jsx)("svg",{className:"w-8 h-8 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})})}),(0,s.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No users found"}),(0,s.jsx)("p",{className:"text-gray-600",children:"No users match the current filter criteria."})]})}):(0,s.jsx)("div",{className:"space-y-4",children:x.map(e=>(0,s.jsx)(d.Zb,{children:(0,s.jsx)(d.aY,{className:"p-6",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,s.jsx)("div",{className:"w-12 h-12 bg-green-100 rounded-full flex items-center justify-center",children:(0,s.jsx)("span",{className:"text-green-600 font-medium text-lg",children:e.name.charAt(0).toUpperCase()})}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:e.name}),(0,s.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat("admin"===e.role?"bg-purple-100 text-purple-800":"moderator"===e.role?"bg-blue-100 text-blue-800":"bg-gray-100 text-gray-800"),children:e.role}),(0,s.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat(e.isActive?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:e.isActive?"Active":"Inactive"})]}),(0,s.jsx)("p",{className:"text-gray-600",children:e.email}),(0,s.jsxs)("div",{className:"flex items-center gap-4 mt-1 text-sm text-gray-500",children:[(0,s.jsxs)("span",{children:["Joined: ",e.createdAt.toLocaleDateString()]}),e.lastLoginAt&&(0,s.jsxs)("span",{children:["Last login:"," ",e.lastLoginAt.toLocaleDateString()]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[e.verifiedEmail&&(0,s.jsxs)("span",{className:"inline-flex items-center text-green-600",children:[(0,s.jsx)("svg",{className:"w-3 h-3 mr-1",fill:"currentColor",viewBox:"0 0 20 20",children:(0,s.jsx)("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})}),"Email"]}),e.verifiedPhone&&(0,s.jsxs)("span",{className:"inline-flex items-center text-green-600",children:[(0,s.jsx)("svg",{className:"w-3 h-3 mr-1",fill:"currentColor",viewBox:"0 0 20 20",children:(0,s.jsx)("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})}),"Phone"]})]})]})]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[e.id!==(null==t?void 0:t.id)&&(0,s.jsxs)(s.Fragment,{children:[e.isActive?(0,s.jsx)(c.z,{size:"sm",variant:"outline",onClick:()=>{confirm("Are you sure you want to deactivate this user?")&&A(e.id,"deactivate")},disabled:y===e.id,className:"text-red-600 border-red-300 hover:bg-red-50",children:"Deactivate"}):(0,s.jsx)(c.z,{size:"sm",onClick:()=>A(e.id,"activate"),disabled:y===e.id,className:"bg-green-600 hover:bg-green-700",children:"Activate"}),"user"===e.role?(0,s.jsx)(c.z,{size:"sm",variant:"outline",onClick:()=>{confirm("Are you sure you want to promote this user to moderator?")&&A(e.id,"promote")},disabled:y===e.id,children:"Promote to Moderator"}):"moderator"===e.role?(0,s.jsx)(c.z,{size:"sm",variant:"outline",onClick:()=>{confirm("Are you sure you want to demote this moderator to user?")&&A(e.id,"demote")},disabled:y===e.id,children:"Demote to User"}):null]}),e.id===(null==t?void 0:t.id)&&(0,s.jsx)("span",{className:"text-sm text-gray-500 px-3 py-1 bg-gray-100 rounded-md",children:"You"}),y===e.id&&(0,s.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-green-600"})]})]})})},e.id))})]})]}):null}},6587:function(e,t,r){"use strict";r.d(t,{Rc:function(){return d},fc:function(){return u},u2:function(){return c},xw:function(){return n}}),r(7437);var s=r(2265),a=r(4033),i=r(3525);let n=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"/auth/login",{user:t,loading:r}=(0,i.useAuth)(),n=(0,a.useRouter)();return(0,s.useEffect)(()=>{if(!r&&!t){let t=window.location.pathname,r="".concat(e,"?redirect=").concat(encodeURIComponent(t));n.push(r)}},[t,r,n,e]),{user:t,loading:r,isAuthenticated:!!t}},l=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"/dashboard",{user:r,userProfile:n,loading:l}=(0,i.useAuth)(),d=(0,a.useRouter)();return(0,s.useEffect)(()=>{if(!l){if(r)n&&!e.includes(n.role)&&d.push(t);else{let e=window.location.pathname,t="/auth/login?redirect=".concat(encodeURIComponent(e));d.push(t)}}},[r,n,l,d,e,t]),{user:r,userProfile:n,loading:l,isAuthenticated:!!r,hasRequiredRole:!!n&&e.includes(n.role)}},d=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"/dashboard";return l(["admin"],e)},c=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"/dashboard";return l(["moderator","admin"],e)},o=(e,t)=>!!e&&t.includes(e.role),u=e=>o(e,["moderator","admin"])}},function(e){e.O(0,[358,139,682,680,396,496,878,69,971,938,744],function(){return e(e.s=673)}),_N_E=e.O()}]);