(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4178],{5721:function(e,r,t){Promise.resolve().then(t.bind(t,4635))},8811:function(e,r,t){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"default",{enumerable:!0,get:function(){return a}});let n=t(1024);t(2265);let s=n._(t(7075));function l(e){return{default:(null==e?void 0:e.default)||e}}function a(e,r){let t=s.default,n={loading:e=>{let{error:r,isLoading:t,pastDelay:n}=e;return null}};"function"==typeof e&&(n.loader=e),Object.assign(n,r);let a=n.loader;return t({...n,loader:()=>null!=a?a().then(l):Promise.resolve(l(()=>null))})}("function"==typeof r.default||"object"==typeof r.default&&null!==r.default)&&void 0===r.default.__esModule&&(Object.defineProperty(r.default,"__esModule",{value:!0}),Object.assign(r.default,r),e.exports=r.default)},9167:function(e,r,t){"use strict";function n(e){let{children:r}=e;return r}Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"NoSSR",{enumerable:!0,get:function(){return n}}),t(1283)},7075:function(e,r,t){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"default",{enumerable:!0,get:function(){return l}});let n=t(1024)._(t(2265)),s=t(9167),l=function(e){let r=Object.assign({loader:null,loading:null,ssr:!0},e);function t(e){let t=r.loading,l=n.default.createElement(t,{isLoading:!0,pastDelay:!0,error:null}),a=r.ssr?n.default.Fragment:s.NoSSR,i=r.lazy;return n.default.createElement(n.default.Suspense,{fallback:l},n.default.createElement(a,null,n.default.createElement(i,e)))}return r.lazy=n.default.lazy(r.loader),t.displayName="LoadableComponent",t}},6304:function(e,r,t){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"RouterContext",{enumerable:!0,get:function(){return n}});let n=t(1024)._(t(2265)).default.createContext(null)},4635:function(e,r,t){"use strict";t.r(r),t.d(r,{default:function(){return b}});var n=t(7437),s=t(2265),l=t(4033),a=t(2193),i=t(3089),o=t(1138),d=t(2130),c=t(4867),u=t(5797),m=t(6831),f=t(8071);async function x(e,r){if(!r.type.startsWith("image/"))throw Error("File must be an image");if(r.size>5242880)throw Error("Image must be less than 5MB");let t=Date.now(),n=r.name.split(".").pop(),s="".concat(e,"_").concat(t,".").concat(n),l=(0,f.ref)(m.t,"profile-images/".concat(s));return await (0,f.KV)(l,r),await (0,f.getDownloadURL)(l)}async function h(e){try{let r=new URL(e),t=decodeURIComponent(r.pathname.split("/o/")[1].split("?")[0]),n=(0,f.ref)(m.t,t);await (0,f.oq)(n)}catch(e){console.error("Error deleting profile image:",e)}}var g=t(6691),p=t.n(g);function b(){var e,r;let t=(0,l.useRouter)(),f=(0,l.useSearchParams)(),{user:g,userProfile:b}=(0,o.useAuth)(),[v,y]=(0,s.useState)(!1),[j,w]=(0,s.useState)(!1),[N,P]=(0,s.useState)(""),[k,C]=(0,s.useState)("account");(0,s.useEffect)(()=>{let e=f.get("tab");e&&["account","profile","security","preferences"].includes(e)&&C(e)},[f]);let[A,D]=(0,s.useState)({name:(null==b?void 0:b.name)||(null==g?void 0:g.displayName)||"",email:(null==g?void 0:g.email)||"",phone:(null==b?void 0:b.phone)||"",bio:(null==b?void 0:b.bio)||""}),[S,E]=(0,s.useState)({currentPassword:"",newPassword:"",confirmPassword:""});(0,s.useEffect)(()=>{b&&(console.log("\uD83D\uDD04 Syncing form data from userProfile:",{name:b.name,phone:b.phone,bio:null==b?void 0:b.bio,fullProfile:b}),D({name:b.name||(null==g?void 0:g.displayName)||"",email:(null==g?void 0:g.email)||"",phone:b.phone||"",bio:(null==b?void 0:b.bio)||""}))},[b,g]);let[z,L]=(0,s.useState)(!1),[V,U]=(0,s.useState)(!1),[R,_]=(0,s.useState)((null==b?void 0:b.photoURL)||(null==g?void 0:g.photoURL)||null);(0,s.useEffect)(()=>{(b||g)&&_((null==b?void 0:b.photoURL)||(null==g?void 0:g.photoURL)||null)},[b,g]);let M=async e=>{if(e.preventDefault(),g){y(!0),P(""),w(!1);try{console.log("\uD83D\uDCDD Updating profile with data:",{name:A.name,phone:A.phone,bio:A.bio}),A.name!==g.displayName&&await (0,c.ck)(g,{displayName:A.name});let e=(0,u.doc)(m.db,"users",g.uid);await (0,u.updateDoc)(e,{name:A.name,phone:A.phone,bio:A.bio,updatedAt:new Date}),console.log("✅ Profile updated successfully"),w(!0),setTimeout(()=>w(!1),3e3)}catch(e){console.error("❌ Error updating profile:",e),P(e.message||"Failed to update profile")}finally{y(!1)}}},O=async e=>{if(e.preventDefault(),g){if(S.newPassword!==S.confirmPassword){P("New passwords do not match."),setTimeout(()=>P(""),3e3);return}if(S.newPassword.length<6){P("New password must be at least 6 characters long."),setTimeout(()=>P(""),3e3);return}y(!0),P(""),w(!1);try{let e=c.w9.credential(g.email,S.currentPassword);await (0,c.aF)(g,e),await (0,c.gQ)(g,S.newPassword),w(!0),E({currentPassword:"",newPassword:"",confirmPassword:""}),setTimeout(()=>w(!1),3e3)}catch(r){console.error("Error updating password:",r);let e="Failed to update password.";"auth/wrong-password"===r.code&&(e="Current password is incorrect."),P(e)}finally{y(!1)}}},F=e=>{let r=e.target.name,t=e.target.value;"bio"===r&&console.log("✏️ Bio field changed:",t),D({...A,[r]:t})},I=async e=>{var r;let t=null===(r=e.target.files)||void 0===r?void 0:r[0];if(t&&g){U(!0),P("");try{R&&await h(R);let e=await x(g.uid,t);_(e);let r=(0,u.doc)(m.db,"users",g.uid);await (0,u.updateDoc)(r,{photoURL:e,updatedAt:new Date}),await (0,c.ck)(g,{photoURL:e}),w(!0),setTimeout(()=>w(!1),3e3)}catch(e){console.error("Error uploading image:",e),P(e.message||"Failed to upload image")}finally{U(!1)}}};return(s.useEffect(()=>{g||t.push("/auth/login")},[g,t]),g)?(0,n.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,n.jsx)(a.default,{}),(0,n.jsxs)("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[(0,n.jsxs)("div",{className:"mb-8",children:[(0,n.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Profile Settings"}),(0,n.jsx)("p",{className:"mt-2 text-gray-600",children:"Manage your account settings and preferences."})]}),(j||N)&&(0,n.jsx)("div",{className:"mb-6 p-4 rounded-lg ".concat(j?"bg-green-50 border border-green-200 text-green-800":"bg-red-50 border border-red-200 text-red-800"),children:j?"Changes saved successfully!":N}),(0,n.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:[(0,n.jsx)("div",{className:"border-b border-gray-200",children:(0,n.jsxs)("nav",{className:"-mb-px flex",children:[(0,n.jsx)("button",{onClick:()=>C("account"),className:"py-4 px-6 text-sm font-medium border-b-2 ".concat("account"===k?"border-green-500 text-green-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:"Account Status"}),(0,n.jsx)("button",{onClick:()=>C("profile"),className:"py-4 px-6 text-sm font-medium border-b-2 ".concat("profile"===k?"border-green-500 text-green-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:"Profile Information"}),(0,n.jsx)("button",{onClick:()=>C("security"),className:"py-4 px-6 text-sm font-medium border-b-2 ".concat("security"===k?"border-green-500 text-green-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:"Security"}),(0,n.jsx)("button",{onClick:()=>C("preferences"),className:"py-4 px-6 text-sm font-medium border-b-2 ".concat("preferences"===k?"border-green-500 text-green-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:"Preferences"})]})}),(0,n.jsxs)("div",{className:"p-6",children:["account"===k&&(0,n.jsxs)("div",{className:"space-y-6",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-6",children:"Account Status Overview"}),(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between p-4 bg-gray-50 rounded-lg",children:[(0,n.jsxs)("div",{className:"flex items-center",children:[(0,n.jsx)("div",{className:"w-12 h-12 mr-3 flex-shrink-0 flex items-center justify-center",children:(0,n.jsx)("svg",{className:"w-8 h-8 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})})}),(0,n.jsxs)("div",{children:[(0,n.jsx)("span",{className:"text-sm font-medium text-gray-900",children:"Account Type"}),(0,n.jsxs)("p",{className:"text-sm text-gray-500 capitalize",children:[(null==b?void 0:b.role)||"user"," Account"]})]})]}),(0,n.jsx)("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-blue-100 text-blue-800 capitalize",children:(null==b?void 0:b.role)||"User"})]}),(0,n.jsxs)("div",{className:"flex items-center justify-between p-4 bg-gray-50 rounded-lg",children:[(0,n.jsxs)("div",{className:"flex items-center",children:[(0,n.jsx)("div",{className:"w-12 h-12 mr-3 flex-shrink-0 flex items-center justify-center",children:(0,n.jsx)("svg",{className:"w-8 h-8 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 12a4 4 0 10-8 0 4 4 0 008 0zm0 0v1.5a2.5 2.5 0 005 0V12a9 9 0 10-9 9m4.5-1.206a8.959 8.959 0 01-4.5 1.207"})})}),(0,n.jsxs)("div",{children:[(0,n.jsx)("span",{className:"text-sm font-medium text-gray-900",children:"Email Verification"}),(0,n.jsx)("p",{className:"text-sm text-gray-500",children:g.emailVerified?"Your email is verified":"Please verify your email"})]})]}),(0,n.jsx)("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-sm font-medium ".concat(g.emailVerified?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:g.emailVerified?"Verified":"Unverified"})]}),(0,n.jsxs)("div",{className:"flex items-center justify-between p-4 bg-gray-50 rounded-lg",children:[(0,n.jsxs)("div",{className:"flex items-center",children:[(0,n.jsx)("div",{className:"w-12 h-12 mr-3 flex-shrink-0 flex items-center justify-center",children:(0,n.jsx)("svg",{className:"w-8 h-8 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"})})}),(0,n.jsxs)("div",{children:[(0,n.jsx)("span",{className:"text-sm font-medium text-gray-900",children:"Phone Verification"}),(0,n.jsx)("p",{className:"text-sm text-gray-500",children:(null==b||b.verifiedPhone,"Verify phone to create and sign petitions")})]})]}),(0,n.jsx)("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-sm font-medium ".concat((null==b?void 0:b.verifiedPhone)?"bg-green-100 text-green-800":"bg-yellow-100 text-yellow-800"),children:(null==b?void 0:b.verifiedPhone)?"Verified":"Pending"})]})]})]}),!(null==b?void 0:b.verifiedPhone)&&(0,n.jsxs)("div",{className:"border-t border-gray-200 pt-6",children:[(0,n.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Action Required"}),(0,n.jsxs)("div",{className:"flex items-center p-4 bg-yellow-50 border border-yellow-200 rounded-lg",children:[(0,n.jsx)("div",{className:"w-5 h-5 mr-3 flex-shrink-0",children:(0,n.jsx)("svg",{className:"w-5 h-5 text-yellow-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 16.5c-.77.833.192 2.5 1.732 2.5z"})})}),(0,n.jsxs)("div",{className:"flex-1",children:[(0,n.jsx)("p",{className:"text-sm font-medium text-yellow-800",children:"Phone Verification Required"}),(0,n.jsx)("p",{className:"text-sm text-yellow-600",children:"You must verify your phone number to create or sign petitions."})]}),(0,n.jsx)(i.z,{onClick:()=>L(!0),className:"ml-4 bg-yellow-600 hover:bg-yellow-700 flex-shrink-0",children:"Verify Phone"})]})]}),(0,n.jsxs)("div",{className:"border-t border-gray-200 pt-6",children:[(0,n.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Account Details"}),(0,n.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4 space-y-3",children:[(0,n.jsxs)("div",{className:"flex items-center",children:[(0,n.jsx)("svg",{className:"w-5 h-5 text-gray-500 mr-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})}),(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{className:"text-sm font-medium text-gray-900",children:"Member Since"}),(0,n.jsx)("p",{className:"text-sm text-gray-500",children:(null==b?void 0:null===(e=b.createdAt)||void 0===e?void 0:e.toLocaleDateString())||"Recently"})]})]}),(0,n.jsxs)("div",{className:"flex items-center",children:[(0,n.jsx)("svg",{className:"w-5 h-5 text-gray-500 mr-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 12a4 4 0 10-8 0 4 4 0 008 0zm0 0v1.5a2.5 2.5 0 005 0V12a9 9 0 10-9 9m4.5-1.206a8.959 8.959 0 01-4.5 1.207"})}),(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{className:"text-sm font-medium text-gray-900",children:"Email Address"}),(0,n.jsx)("p",{className:"text-sm text-gray-500",children:A.email})]})]})]})]})]}),"profile"===k&&(0,n.jsxs)("form",{onSubmit:M,className:"space-y-6",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Profile Picture"}),(0,n.jsxs)("div",{className:"flex items-center space-x-6",children:[(0,n.jsxs)("div",{className:"relative",children:[R?(0,n.jsx)("div",{className:"w-24 h-24 rounded-full overflow-hidden bg-gray-200",children:(0,n.jsx)(p(),{src:R,alt:"Profile",width:96,height:96,className:"object-cover"})}):(0,n.jsx)("div",{className:"w-24 h-24 rounded-full bg-green-100 flex items-center justify-center",children:(0,n.jsx)("span",{className:"text-green-600 font-bold text-3xl",children:null==g?void 0:null===(r=g.email)||void 0===r?void 0:r.charAt(0).toUpperCase()})}),V&&(0,n.jsx)("div",{className:"absolute inset-0 bg-black bg-opacity-50 rounded-full flex items-center justify-center",children:(0,n.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-white"})})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{htmlFor:"profile-image",className:"cursor-pointer inline-flex items-center px-4 py-2 border border-gray-300 rounded-lg shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500",children:V?"Uploading...":"Change Photo"}),(0,n.jsx)("input",{id:"profile-image",type:"file",accept:"image/*",onChange:I,disabled:V,className:"hidden"}),(0,n.jsx)("p",{className:"mt-2 text-xs text-gray-500",children:"JPG, PNG or GIF. Max 5MB."})]})]})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Basic Information"}),(0,n.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,n.jsxs)("div",{className:"md:col-span-2",children:[(0,n.jsx)("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700 mb-2",children:"Full Name"}),(0,n.jsx)("input",{type:"text",id:"name",name:"name",value:A.name,onChange:F,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent",required:!0})]}),(0,n.jsxs)("div",{className:"md:col-span-2",children:[(0,n.jsx)("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 mb-2",children:"Email Address"}),(0,n.jsx)("input",{type:"email",id:"email",name:"email",value:A.email,disabled:!0,className:"w-full px-4 py-2 border border-gray-300 rounded-lg bg-gray-50 text-gray-500 cursor-not-allowed"}),(0,n.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:"Email cannot be changed"})]}),(0,n.jsxs)("div",{className:"md:col-span-2",children:[(0,n.jsx)("label",{htmlFor:"phone",className:"block text-sm font-medium text-gray-700 mb-2",children:"Phone Number"}),(0,n.jsx)("input",{type:"tel",id:"phone",name:"phone",value:A.phone,onChange:F,placeholder:"+212 6XX XXX XXX",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent"})]})]})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Additional Information"}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{htmlFor:"bio",className:"block text-sm font-medium text-gray-700 mb-2",children:"Bio"}),(0,n.jsx)("textarea",{id:"bio",name:"bio",value:A.bio,onChange:F,rows:4,placeholder:"Tell us about yourself...",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent"})]})]}),(0,n.jsx)("div",{className:"flex justify-end",children:(0,n.jsx)(i.z,{type:"submit",disabled:v,children:v?"Saving...":"Save Changes"})})]}),"security"===k&&(0,n.jsxs)("form",{onSubmit:O,className:"space-y-6",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Change Password"}),(0,n.jsxs)("div",{className:"space-y-6",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{htmlFor:"currentPassword",className:"block text-sm font-medium text-gray-700 mb-2",children:"Current Password"}),(0,n.jsx)("input",{type:"password",id:"currentPassword",value:S.currentPassword,onChange:e=>E({...S,currentPassword:e.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent",required:!0})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{htmlFor:"newPassword",className:"block text-sm font-medium text-gray-700 mb-2",children:"New Password"}),(0,n.jsx)("input",{type:"password",id:"newPassword",value:S.newPassword,onChange:e=>E({...S,newPassword:e.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent",minLength:6,required:!0})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{htmlFor:"confirmPassword",className:"block text-sm font-medium text-gray-700 mb-2",children:"Confirm New Password"}),(0,n.jsx)("input",{type:"password",id:"confirmPassword",value:S.confirmPassword,onChange:e=>E({...S,confirmPassword:e.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent",minLength:6,required:!0})]})]})]}),(0,n.jsx)("div",{className:"flex justify-end",children:(0,n.jsx)(i.z,{type:"submit",disabled:v,children:v?"Updating...":"Update Password"})})]}),"preferences"===k&&(0,n.jsx)("div",{className:"space-y-8",children:(0,n.jsxs)("div",{children:[(0,n.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-6",children:"Account Actions"}),(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between p-4 border border-gray-200 rounded-lg",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("h4",{className:"font-medium text-gray-900",children:"Download Account Data"}),(0,n.jsx)("p",{className:"text-sm text-gray-600",children:"Export your account information"})]}),(0,n.jsx)(i.z,{variant:"outline",size:"sm",children:"Download"})]}),(0,n.jsxs)("div",{className:"flex items-center justify-between p-4 border border-red-200 rounded-lg bg-red-50",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("h4",{className:"font-medium text-red-900",children:"Delete Account"}),(0,n.jsx)("p",{className:"text-sm text-red-700",children:"Permanently delete your account and all data"})]}),(0,n.jsx)(i.z,{variant:"outline",size:"sm",className:"text-red-600 border-red-300 hover:bg-red-100",children:"Delete"})]})]})]})})]})]}),z&&(0,n.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,n.jsx)("div",{className:"bg-white rounded-lg max-w-md w-full",children:(0,n.jsx)(d.Z,{onVerified:async e=>{if(g)try{let r=(0,u.doc)(m.db,"users",g.uid);console.log("\uD83D\uDCF1 Updating user profile with verified phone:",{userId:g.uid,phoneNumber:e}),await (0,u.updateDoc)(r,{phone:e,verifiedPhone:!0,updatedAt:new Date}),console.log("✅ Phone verified and saved successfully"),w(!0),L(!1)}catch(e){console.error("❌ Error updating phone:",e),P("Failed to update phone number"),L(!1)}},onCancel:()=>L(!1)})})})]})]}):null}},1138:function(e,r,t){"use strict";t.r(r),t.d(r,{default:function(){return c},useAuth:function(){return d}});var n=t(7437),s=t(2265),l=t(4867),a=t(5797),i=t(6831);let o=(0,s.createContext)({user:null,userProfile:null,loading:!0,isAuthenticated:!1}),d=()=>{let e=(0,s.useContext)(o);if(!e)throw Error("useAuth must be used within an AuthProvider");return e};function c(e){let{children:r}=e,[t,d]=(0,s.useState)(null),[c,u]=(0,s.useState)(null),[m,f]=(0,s.useState)(!0);return(0,s.useEffect)(()=>{let e=null,r=(0,l.Aj)(i.auth,async r=>{if(console.log("\uD83D\uDD10 Auth state changed:",r?"User logged in":"User logged out"),d(r),f(!1),e&&(e(),e=null),r){let t=(0,a.doc)(i.db,"users",r.uid);e=(0,a.cf)(t,async e=>{if(e.exists()){var t,n,s,l,a,o,d,c;let m=e.data();if(console.log("\uD83D\uDC64 User profile updated from Firestore",{hasBio:!!m.bio,bio:m.bio,isActive:m.isActive}),!1===m.isActive){console.warn("⚠️ User account is inactive, logging out..."),await i.auth.signOut(),window.location.href="/auth/login?error=account-inactive";return}u({id:r.uid,name:m.name||r.displayName||"",email:m.email||r.email||"",phone:m.phone,photoURL:m.photoURL||r.photoURL,bio:m.bio,verifiedEmail:m.verifiedEmail||r.emailVerified||!1,verifiedPhone:m.verifiedPhone||!1,role:m.role||"user",creatorPageId:m.creatorPageId,fcmToken:m.fcmToken,fcmTokenUpdatedAt:null===(n=m.fcmTokenUpdatedAt)||void 0===n?void 0:null===(t=n.toDate)||void 0===t?void 0:t.call(n),createdAt:(null===(l=m.createdAt)||void 0===l?void 0:null===(s=l.toDate)||void 0===s?void 0:s.call(l))||new Date,updatedAt:null===(o=m.updatedAt)||void 0===o?void 0:null===(a=o.toDate)||void 0===a?void 0:a.call(o),lastLoginAt:null===(c=m.lastLoginAt)||void 0===c?void 0:null===(d=c.toDate)||void 0===d?void 0:d.call(c),isActive:!1!==m.isActive})}else u({id:r.uid,name:r.displayName||"",email:r.email||"",verifiedEmail:r.emailVerified,verifiedPhone:!1,role:"user",isActive:!0,createdAt:new Date})},e=>{console.error("Error listening to user profile:",e),u({id:r.uid,name:r.displayName||"",email:r.email||"",verifiedEmail:r.emailVerified,verifiedPhone:!1,role:"user",isActive:!0,createdAt:new Date})})}else u(null)});return()=>{r(),e&&e()}},[]),(0,n.jsx)(o.Provider,{value:{user:t,userProfile:c,loading:m,isAuthenticated:!!t},children:r})}},2130:function(e,r,t){"use strict";t.d(r,{Z:function(){return o}});var n=t(7437),s=t(2265),l=t(3089),a=t(6831),i=t(4867);function o(e){let{onVerified:r,onCancel:t}=e,[o,d]=(0,s.useState)(""),[c,u]=(0,s.useState)(""),[m,f]=(0,s.useState)("phone"),[x,h]=(0,s.useState)(!1),[g,p]=(0,s.useState)(""),[b,v]=(0,s.useState)(null),y=(0,s.useRef)(null);(0,s.useEffect)(()=>((()=>{try{y.current||(y.current=new i.lI(a.auth,"recaptcha-container",{size:"invisible",callback:()=>{console.log("✅ reCAPTCHA solved")},"expired-callback":()=>{console.log("⚠️ reCAPTCHA expired"),p("انتهت صلاحية التحقق. يرجى المحاولة مرة أخرى")}}))}catch(e){console.error("Error initializing reCAPTCHA:",e)}})(),()=>{if(y.current){try{y.current.clear()}catch(e){console.error("Error clearing reCAPTCHA:",e)}y.current=null}}),[]);let j=async()=>{if(!o.trim()){p("الرجاء إدخال رقم هاتف صحيح");return}let e=o.replace(/\s/g,"");if(!/^\+?[1-9]\d{1,14}$/.test(e)){p("رقم الهاتف غير صحيح. يجب أن يبدأ بـ + ورمز الدولة");return}h(!0),p("");try{if(!y.current)throw Error("reCAPTCHA not initialized");console.log("\uD83D\uDCF1 Sending SMS to:",e);let r=await (0,i.$g)(a.auth,e,y.current);v(r),f("code"),console.log("✅ SMS sent successfully")}catch(e){if(console.error("❌ Error sending SMS:",e),"auth/invalid-phone-number"===e.code?p("رقم الهاتف غير صحيح"):"auth/too-many-requests"===e.code?p("تم تجاوز عدد المحاولات. يرجى المحاولة لاحقًا"):"auth/quota-exceeded"===e.code?p("تم تجاوز حد الرسائل اليومي"):"auth/invalid-app-credential"===e.code?p("خطأ في إعدادات التحقق. يرجى التواصل مع الدعم الفني"):p("فشل إرسال رمز التحقق. يرجى المحاولة مرة أخرى"),y.current)try{y.current.clear(),y.current=new i.lI(a.auth,"recaptcha-container",{size:"invisible"})}catch(e){console.error("Error resetting reCAPTCHA:",e)}}finally{h(!1)}},w=async()=>{if(!c.trim()){p("الرجاء إدخال رمز التحقق");return}if(!b){p("خطأ في التحقق. يرجى إعادة إرسال الرمز");return}h(!0),p("");try{console.log("\uD83D\uDD0D Verifying code:",c),await b.confirm(c),console.log("✅ Phone number verified successfully"),r(o)}catch(e){console.error("❌ Error verifying code:",e),"auth/invalid-verification-code"===e.code?p("رمز التحقق غير صحيح"):"auth/code-expired"===e.code?p("انتهت صلاحية الرمز. يرجى إعادة إرسال الرمز"):p("فشل التحقق من الرمز. يرجى المحاولة مرة أخرى")}finally{h(!1)}};return(0,n.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,n.jsxs)("div",{className:"bg-white rounded-lg p-6 max-w-md w-full mx-4",children:[(0,n.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"التحقق من رقم الهاتف مطلوب"}),(0,n.jsx)("div",{id:"recaptcha-container"}),"phone"===m?(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsx)("p",{className:"text-gray-600",children:"الرجاء إدخال رقم هاتفك للتوقيع على هذه العريضة."}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"رقم الهاتف"}),(0,n.jsx)("input",{type:"tel",value:o,onChange:e=>d(e.target.value),placeholder:"+212 6XX XXX XXX",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500",dir:"ltr"}),(0,n.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"مثال: +212612345678 أو +34613658220"})]}),g&&(0,n.jsx)("p",{className:"text-red-600 text-sm",children:g}),(0,n.jsxs)("div",{className:"flex gap-3",children:[(0,n.jsx)(l.z,{onClick:j,disabled:x,className:"flex-1",children:x?"جاري الإرسال...":"إرسال الرمز"}),(0,n.jsx)(l.z,{variant:"outline",onClick:t,disabled:x,children:"إلغاء"})]})]}):(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsxs)("p",{className:"text-gray-600",children:["أدخل الرمز المكون من 6 أرقام المرسل إلى ",o]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"رمز التحقق"}),(0,n.jsx)("input",{type:"text",value:c,onChange:e=>{u(e.target.value.replace(/\D/g,""))},placeholder:"123456",maxLength:6,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500 text-center text-lg tracking-widest",dir:"ltr"})]}),g&&(0,n.jsx)("p",{className:"text-red-600 text-sm",children:g}),(0,n.jsxs)("div",{className:"flex gap-3",children:[(0,n.jsx)(l.z,{onClick:w,disabled:x,className:"flex-1",children:x?"جاري التحقق...":"تحقق"}),(0,n.jsx)(l.z,{variant:"outline",onClick:()=>{f("phone"),u(""),p(""),v(null)},disabled:x,children:"رجوع"})]}),(0,n.jsx)("button",{onClick:j,disabled:x,className:"w-full text-sm text-green-600 hover:text-green-700 underline",children:"إعادة إرسال الرمز"})]})]})})}},2193:function(e,r,t){"use strict";t.r(r);var n=t(8811);let s=t.n(n)()(()=>Promise.all([t.e(4358),t.e(139),t.e(7895),t.e(8326),t.e(745),t.e(8607),t.e(9798),t.e(1690)]).then(t.bind(t,1690)),{loadableGenerated:{webpack:()=>[1690]},ssr:!1,loading:()=>null});r.default=s},3089:function(e,r,t){"use strict";t.d(r,{z:function(){return d}});var n=t(7437),s=t(2265),l=t(4949),a=t(6061),i=t(345);let o=(0,a.j)("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),d=s.forwardRef((e,r)=>{let{className:t,variant:s,size:a,asChild:d=!1,...c}=e,u=d?l.g7:"button";return(0,n.jsx)(u,{className:(0,i.cn)(o({variant:s,size:a,className:t})),ref:r,...c})});d.displayName="Button"},6831:function(e,r,t){"use strict";t.d(r,{auth:function(){return o},db:function(){return d},t:function(){return c}});var n=t(607),s=t(4867),l=t(5797),a=t(8071);let i=0===(0,n.getApps)().length?(0,n.initializeApp)({apiKey:"AIzaSyAhYUelLCS8ItJwaltcjtUl8HHJwp605T0".trim(),authDomain:"arida-c5faf.firebaseapp.com".trim(),projectId:"arida-c5faf".trim(),storageBucket:"arida-c5faf.firebasestorage.app".trim(),messagingSenderId:"446881275370".trim(),appId:"1:446881275370:web:283f0360cfab3556a32693".trim()}):(0,n.Mq)(),o=(0,s.getAuth)(i),d=(0,l.getFirestore)(i),c=(0,a.getStorage)(i);r.Z=i},345:function(e,r,t){"use strict";t.d(r,{cn:function(){return l}});var n=t(7042),s=t(4769);function l(){for(var e=arguments.length,r=Array(e),t=0;t<e;t++)r[t]=arguments[t];return(0,s.m6)((0,n.W)(r))}},4033:function(e,r,t){e.exports=t(94)},4949:function(e,r,t){"use strict";t.d(r,{g7:function(){return a}});var n=t(2265);function s(e,r){if("function"==typeof e)return e(r);null!=e&&(e.current=r)}var l=t(7437),a=function(e){let r=function(e){let r=n.forwardRef((e,r)=>{let{children:t,...l}=e;if(n.isValidElement(t)){let e,a;let i=(e=Object.getOwnPropertyDescriptor(t.props,"ref")?.get)&&"isReactWarning"in e&&e.isReactWarning?t.ref:(e=Object.getOwnPropertyDescriptor(t,"ref")?.get)&&"isReactWarning"in e&&e.isReactWarning?t.props.ref:t.props.ref||t.ref,o=function(e,r){let t={...r};for(let n in r){let s=e[n],l=r[n];/^on[A-Z]/.test(n)?s&&l?t[n]=(...e)=>{let r=l(...e);return s(...e),r}:s&&(t[n]=s):"style"===n?t[n]={...s,...l}:"className"===n&&(t[n]=[s,l].filter(Boolean).join(" "))}return{...e,...t}}(l,t.props);return t.type!==n.Fragment&&(o.ref=r?function(...e){return r=>{let t=!1,n=e.map(e=>{let n=s(e,r);return t||"function"!=typeof n||(t=!0),n});if(t)return()=>{for(let r=0;r<n.length;r++){let t=n[r];"function"==typeof t?t():s(e[r],null)}}}}(r,i):i),n.cloneElement(t,o)}return n.Children.count(t)>1?n.Children.only(null):null});return r.displayName=`${e}.SlotClone`,r}(e),t=n.forwardRef((e,t)=>{let{children:s,...a}=e,i=n.Children.toArray(s),d=i.find(o);if(d){let e=d.props.children,s=i.map(r=>r!==d?r:n.Children.count(e)>1?n.Children.only(null):n.isValidElement(e)?e.props.children:null);return(0,l.jsx)(r,{...a,ref:t,children:n.isValidElement(e)?n.cloneElement(e,void 0,s):null})}return(0,l.jsx)(r,{...a,ref:t,children:s})});return t.displayName=`${e}.Slot`,t}("Slot"),i=Symbol("radix.slottable");function o(e){return n.isValidElement(e)&&"function"==typeof e.type&&"__radixId"in e.type&&e.type.__radixId===i}},6061:function(e,r,t){"use strict";t.d(r,{j:function(){return a}});var n=t(7042);let s=e=>"boolean"==typeof e?`${e}`:0===e?"0":e,l=n.W,a=(e,r)=>t=>{var n;if((null==r?void 0:r.variants)==null)return l(e,null==t?void 0:t.class,null==t?void 0:t.className);let{variants:a,defaultVariants:i}=r,o=Object.keys(a).map(e=>{let r=null==t?void 0:t[e],n=null==i?void 0:i[e];if(null===r)return null;let l=s(r)||s(n);return a[e][l]}),d=t&&Object.entries(t).reduce((e,r)=>{let[t,n]=r;return void 0===n||(e[t]=n),e},{});return l(e,o,null==r?void 0:null===(n=r.compoundVariants)||void 0===n?void 0:n.reduce((e,r)=>{let{class:t,className:n,...s}=r;return Object.entries(s).every(e=>{let[r,t]=e;return Array.isArray(t)?t.includes({...i,...d}[r]):({...i,...d})[r]===t})?[...e,t,n]:e},[]),null==t?void 0:t.class,null==t?void 0:t.className)}}},function(e){e.O(0,[4358,139,7895,745,6691,2971,2472,1744],function(){return e(e.s=5721)}),_N_E=e.O()}]);