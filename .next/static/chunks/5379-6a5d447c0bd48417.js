"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5379],{3525:function(e,t,r){r.r(t),r.d(t,{default:function(){return c},useAuth:function(){return d}});var n=r(7437),i=r(2265),o=r(7065),a=r(8121),l=r(1221);let s=(0,i.createContext)({user:null,userProfile:null,loading:!0,isAuthenticated:!1}),d=()=>{let e=(0,i.useContext)(s);if(!e)throw Error("useAuth must be used within an AuthProvider");return e};function c(e){let{children:t}=e,[r,d]=(0,i.useState)(null),[c,u]=(0,i.useState)(null),[h,m]=(0,i.useState)(!0);return(0,i.useEffect)(()=>{let e=null,t=(0,o.Aj)(l.auth,async t=>{if(console.log("\uD83D\uDD10 Auth state changed:",t?"User logged in":"User logged out"),d(t),m(!1),e&&(e(),e=null),t){let r=(0,a.doc)(l.db,"users",t.uid);e=(0,a.cf)(r,async e=>{if(e.exists()){var r,n,i,o,a,s,d,c;let h=e.data();if(console.log("\uD83D\uDC64 User profile updated from Firestore",{hasBio:!!h.bio,bio:h.bio,isActive:h.isActive}),!1===h.isActive){console.warn("⚠️ User account is inactive, logging out..."),await l.auth.signOut(),window.location.href="/auth/login?error=account-inactive";return}u({id:t.uid,name:h.name||t.displayName||"",email:h.email||t.email||"",phone:h.phone,photoURL:h.photoURL||t.photoURL,bio:h.bio,verifiedEmail:h.verifiedEmail||t.emailVerified||!1,verifiedPhone:h.verifiedPhone||!1,role:h.role||"user",creatorPageId:h.creatorPageId,fcmToken:h.fcmToken,fcmTokenUpdatedAt:null===(n=h.fcmTokenUpdatedAt)||void 0===n?void 0:null===(r=n.toDate)||void 0===r?void 0:r.call(n),createdAt:(null===(o=h.createdAt)||void 0===o?void 0:null===(i=o.toDate)||void 0===i?void 0:i.call(o))||new Date,updatedAt:null===(s=h.updatedAt)||void 0===s?void 0:null===(a=s.toDate)||void 0===a?void 0:a.call(s),lastLoginAt:null===(c=h.lastLoginAt)||void 0===c?void 0:null===(d=c.toDate)||void 0===d?void 0:d.call(c),isActive:!1!==h.isActive})}else u({id:t.uid,name:t.displayName||"",email:t.email||"",verifiedEmail:t.emailVerified,verifiedPhone:!1,role:"user",isActive:!0,createdAt:new Date})},e=>{console.error("Error listening to user profile:",e),u({id:t.uid,name:t.displayName||"",email:t.email||"",verifiedEmail:t.emailVerified,verifiedPhone:!1,role:"user",isActive:!0,createdAt:new Date})})}else u(null)});return()=>{t(),e&&e()}},[]),(0,n.jsx)(s.Provider,{value:{user:r,userProfile:c,loading:h,isAuthenticated:!!r},children:t})}},9479:function(e,t,r){r.d(t,{Z:function(){return d}});var n=r(7437),i=r(2265),o=r(6691),a=r.n(o),l=r(282),s=r(8063);function d(e){let{petition:t,size:r=256,variant:o="default",branded:d=!1,downloadable:c=!0,shareable:u=!0,className:h="",onShare:m,onDownload:f}=e,[g,x]=(0,i.useState)(""),[p,w]=(0,i.useState)(!0),[v,b]=(0,i.useState)(""),[j,y]=(0,i.useState)(!1);(0,i.useEffect)(()=>{(async()=>{try{if(w(!0),b(""),t.qrCodeUrl&&!d)x(t.qrCodeUrl);else{let e=await (0,l.w1)(t.id,{size:r,branded:d,includeAnalytics:!0});x(e)}}catch(e){console.error("Error generating QR code:",e),b("Failed to generate QR code")}finally{w(!1)}})()},[t.id,t.qrCodeUrl,r,d]);let N=async()=>{if(g)try{await (0,l.bw)(t.id,t.title,"png",{size:512,branded:d}),await (0,s.$l)(t.id),f&&f()}catch(e){console.error("Error downloading QR code:",e)}},k=async()=>{if(g)try{if(navigator.share){let e=await fetch(g),r=await e.blob(),n=new File([r],"".concat(t.title,"_qr_code.png"),{type:"image/png"});await navigator.share({title:"".concat(t.title," - QR Code"),text:"Scan this QR code to support: ".concat(t.title),files:[n]})}else{let e="".concat(window.location.origin,"/petitions/").concat(t.id);await navigator.clipboard.writeText(e),alert("Petition link copied to clipboard!")}await (0,s.$l)(t.id),m&&m()}catch(e){console.error("Error sharing QR code:",e)}},C=()=>{"default"===o&&y(!0)},R=()=>{y(!1)};return"default"===o?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"text-center ".concat(h),children:[p?(0,n.jsx)("div",{className:"flex items-center justify-center bg-gray-100 rounded-lg",style:{width:r,height:r},children:(0,n.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-green-600"})}):v?(0,n.jsx)("div",{className:"flex items-center justify-center bg-red-50 border border-red-200 rounded-lg text-red-600 text-sm",style:{width:r,height:r},children:v}):(0,n.jsx)("div",{className:"inline-block cursor-pointer",onClick:C,children:(0,n.jsx)(a(),{src:g,alt:"QR Code for ".concat(t.title),width:r,height:r,className:"rounded-lg shadow-md hover:shadow-lg transition-shadow"})}),!p&&!v&&(c||u)&&(0,n.jsxs)("div",{className:"flex gap-2 justify-center mt-3",children:[c&&(0,n.jsxs)("button",{onClick:N,className:"px-4 py-2 text-sm bg-gray-800 hover:bg-gray-900 text-white rounded-md transition-colors flex items-center gap-2 font-medium",children:[(0,n.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),"Download"]}),u&&(0,n.jsxs)("button",{onClick:k,className:"px-4 py-2 text-sm bg-green-600 hover:bg-green-700 text-white rounded-md transition-colors flex items-center gap-2 font-medium",children:[(0,n.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.367 2.684 3 3 0 00-5.367-2.684z"})}),"Share"]})]})]}),j&&(0,n.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",onClick:R,children:(0,n.jsxs)("div",{className:"bg-white rounded-lg max-w-md w-full p-6",onClick:e=>e.stopPropagation(),children:[(0,n.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,n.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Petition QR Code"}),(0,n.jsx)("button",{onClick:R,className:"text-gray-400 hover:text-gray-600 p-1",children:(0,n.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,n.jsxs)("div",{className:"text-center",children:[p?(0,n.jsx)("div",{className:"flex items-center justify-center bg-gray-100 rounded-lg mx-auto",style:{width:300,height:300},children:(0,n.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-green-600"})}):v?(0,n.jsx)("div",{className:"flex items-center justify-center bg-red-50 border border-red-200 rounded-lg text-red-600 text-sm mx-auto",style:{width:300,height:300},children:v}):(0,n.jsx)("div",{className:"inline-block mb-4",children:(0,n.jsx)(a(),{src:g,alt:"QR Code for ".concat(t.title),width:300,height:300,className:"rounded-lg shadow-md"})}),(0,n.jsxs)("div",{className:"text-sm text-gray-600 mb-6",children:[(0,n.jsx)("p",{className:"font-medium text-gray-900",children:t.title}),(0,n.jsx)("p",{children:"Scan to view and support this petition"})]}),!p&&!v&&(0,n.jsxs)("div",{className:"flex gap-3",children:[c&&(0,n.jsxs)("button",{onClick:N,className:"flex-1 px-4 py-2 bg-gray-800 hover:bg-gray-900 text-white rounded-md transition-colors flex items-center justify-center gap-2 font-medium",children:[(0,n.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),"Download"]}),u&&(0,n.jsxs)("button",{onClick:k,className:"flex-1 px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-md transition-colors flex items-center justify-center gap-2 font-medium",children:[(0,n.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.367 2.684 3 3 0 00-5.367-2.684z"})}),"Share"]})]})]})]})})]}):"card"===o?(0,n.jsx)("div",{className:"bg-white rounded-lg shadow-md p-6 ".concat(h),children:(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Share this Petition"}),(0,n.jsx)("p",{className:"text-sm text-gray-600 mb-4",children:"Scan the QR code to view and support this petition"}),p?(0,n.jsx)("div",{className:"flex items-center justify-center bg-gray-100 rounded-lg mx-auto",style:{width:r,height:r},children:(0,n.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-green-600"})}):v?(0,n.jsx)("div",{className:"flex items-center justify-center bg-red-50 border border-red-200 rounded-lg text-red-600 text-sm mx-auto",style:{width:r,height:r},children:v}):(0,n.jsx)("div",{className:"inline-block mb-4 cursor-pointer",onClick:C,children:(0,n.jsx)(a(),{src:g,alt:"QR Code for ".concat(t.title),width:r,height:r,className:"rounded-lg shadow-md hover:shadow-lg transition-shadow"})}),(0,n.jsxs)("div",{className:"text-sm text-gray-600 mb-4",children:[(0,n.jsx)("p",{className:"font-medium",children:t.title}),(0,n.jsx)("p",{children:"Created by User"})]}),!p&&!v&&(0,n.jsxs)("div",{className:"flex gap-2 justify-center",children:[c&&(0,n.jsxs)("button",{onClick:N,className:"flex-1 px-4 py-2 bg-gray-800 hover:bg-gray-900 text-white rounded-md transition-colors flex items-center justify-center gap-2",children:[(0,n.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),"Download"]}),u&&(0,n.jsxs)("button",{onClick:k,className:"flex-1 px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-md transition-colors flex items-center justify-center gap-2",children:[(0,n.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.367 2.684 3 3 0 00-5.367-2.684z"})}),"Share"]})]})]})}):null}},5671:function(e,t,r){r.d(t,{Ol:function(){return l},Zb:function(){return a},aY:function(){return d},ll:function(){return s}});var n=r(7437),i=r(2265),o=r(2169);let a=i.forwardRef((e,t)=>{let{className:r,...i}=e;return(0,n.jsx)("div",{ref:t,className:(0,o.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",r),...i})});a.displayName="Card";let l=i.forwardRef((e,t)=>{let{className:r,...i}=e;return(0,n.jsx)("div",{ref:t,className:(0,o.cn)("flex flex-col space-y-1.5 p-6",r),...i})});l.displayName="CardHeader";let s=i.forwardRef((e,t)=>{let{className:r,...i}=e;return(0,n.jsx)("h3",{ref:t,className:(0,o.cn)("text-2xl font-semibold leading-none tracking-tight",r),...i})});s.displayName="CardTitle",i.forwardRef((e,t)=>{let{className:r,...i}=e;return(0,n.jsx)("p",{ref:t,className:(0,o.cn)("text-sm text-muted-foreground",r),...i})}).displayName="CardDescription";let d=i.forwardRef((e,t)=>{let{className:r,...i}=e;return(0,n.jsx)("div",{ref:t,className:(0,o.cn)("p-6 pt-0",r),...i})});d.displayName="CardContent",i.forwardRef((e,t)=>{let{className:r,...i}=e;return(0,n.jsx)("div",{ref:t,className:(0,o.cn)("flex items-center p-6 pt-0",r),...i})}).displayName="CardFooter"},6587:function(e,t,r){r.d(t,{Rc:function(){return s},fc:function(){return u},u2:function(){return d},xw:function(){return a}}),r(7437);var n=r(2265),i=r(4033),o=r(3525);let a=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"/auth/login",{user:t,loading:r}=(0,o.useAuth)(),a=(0,i.useRouter)();return(0,n.useEffect)(()=>{if(!r&&!t){let t=window.location.pathname,r="".concat(e,"?redirect=").concat(encodeURIComponent(t));a.push(r)}},[t,r,a,e]),{user:t,loading:r,isAuthenticated:!!t}},l=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"/dashboard",{user:r,userProfile:a,loading:l}=(0,o.useAuth)(),s=(0,i.useRouter)();return(0,n.useEffect)(()=>{if(!l){if(r)a&&!e.includes(a.role)&&s.push(t);else{let e=window.location.pathname,t="/auth/login?redirect=".concat(encodeURIComponent(e));s.push(t)}}},[r,a,l,s,e,t]),{user:r,userProfile:a,loading:l,isAuthenticated:!!r,hasRequiredRole:!!a&&e.includes(a.role)}},s=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"/dashboard";return l(["admin"],e)},d=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"/dashboard";return l(["moderator","admin"],e)},c=(e,t)=>!!e&&t.includes(e.role),u=e=>c(e,["moderator","admin"])},282:function(e,t,r){r.d(t,{bv:function(){return s},bw:function(){return c},w1:function(){return l}});var n=r(5298),i=r(955),o=r(8121),a=r(1221);let l=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{size:r=256,branded:i=!1,includeAnalytics:o=!0}=t;try{let t=window.location.origin,a="".concat(t,"/petitions/").concat(e).concat(o?"?utm_source=qr":""),l=await n.toDataURL(a,{width:r,height:r,margin:2,color:{dark:"#000000",light:"#FFFFFF"},errorCorrectionLevel:"M"});if(i)return await d(l,r);return l}catch(e){throw console.error("Error generating QR code:",e),Error("Failed to generate QR code")}},s=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{size:r=512,branded:n=!1,updatePetition:s=!0}=t;try{let t=await l(e,{size:r,branded:n,includeAnalytics:!0}),d=await fetch(t),c=await d.blob(),u="qr-codes/".concat(e,"-").concat(Date.now(),".png"),h=(0,i.ref)(a.t,u);await (0,i.KV)(h,c);let m=await (0,i.getDownloadURL)(h);if(s){let t=(0,o.doc)(a.db,"petitions",e);await (0,o.updateDoc)(t,{qrCodeUrl:m,hasQrCode:!0,updatedAt:o.Timestamp.fromDate(new Date)})}return m}catch(e){throw console.error("Error generating and storing QR code:",e),Error("Failed to generate and store QR code")}},d=async(e,t)=>{try{let r=document.createElement("canvas"),n=r.getContext("2d");if(!n)throw Error("Could not get canvas context");r.width=t,r.height=t+60;let i=new Image;return await new Promise((t,r)=>{i.onload=t,i.onerror=r,i.src=e}),n.drawImage(i,0,0,t,t),n.fillStyle="#000000",n.font="".concat(Math.floor(.04*t),"px Arial, sans-serif"),n.textAlign="center",n.fillText("3arida.ma",t/2,t+30),n.fillText("Petition Platform",t/2,t+50),r.toDataURL("image/png")}catch(t){return console.error("Error adding branding to QR code:",t),e}},c=async function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"png",n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};try{let{size:i=512,branded:o=!0}=n;if("png"===r){let r=await l(e,{size:i,branded:o,includeAnalytics:!0}),n=document.createElement("a");n.href=r,n.download="".concat(t.replace(/[^a-z0-9]/gi,"_").toLowerCase(),"_qr_code.png"),document.body.appendChild(n),n.click(),document.body.removeChild(n)}else"pdf"===r&&await c(e,t,"png",n)}catch(e){throw console.error("Error downloading QR code:",e),Error("Failed to download QR code")}}}}]);